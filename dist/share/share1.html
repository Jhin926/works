<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
    <meta name = "format-detection" content = "telephone=no">
    <title>分享</title>
    <script>
      var deviceWidth = document.documentElement.clientWidth;
      if(deviceWidth > 640) deviceWidth = 640;
      document.documentElement.style.fontSize = deviceWidth/6.4 + 'px';
    </script>
    <style rel="stylesheet">
      * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: Arial, Helvetica, sans-serif, '微软雅黑';
      }
      html,body {
        max-width: 640px;
        margin: auto;
        width: 100%;
        height: 100%;
      }
      input {
        border: none;
        outline: none;
      }
      button {
        border: none;
        background: none;
      }
      #container {
        width: 100%;
        height: 100%;
        padding-top: .3rem;
        background: url('./img/bg-share.png') no-repeat;
        background-size: 100% auto;
        position: relative;
      }
      .inviter {
        font-size: .24rem;
        color: #fff;
      }
      .inviter p {
        display: inline-block;
        padding: .08rem .2rem .08rem .25rem;
        background-color: rgba(0, 0, 0, .4);
        border-bottom-right-radius: .8rem;
        border-top-right-radius: .8rem;
        -webkit-border-bottom-right-radius: .8rem;
        -webkit-border-top-right-radius: .8rem;
        -moz-border-bottom-right-radius: .8rem;
        -moz-border-top-right-radius: .8rem;
        margin-left: -.15rem;
      }
      .inviter span {
        color: #ffb600;
      }
      .invite-input {
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100%;
        padding: 2rem 0 .5rem 0;
        background: url("./img/bg-bag.png") no-repeat;
        background-size: 100%;
      }
      .input-box {
        text-align: center;
        font-size: .24rem;
      }
      .input-box input {
        width: 4.6rem;
        height: .7rem;
        padding-left: .15rem;
        background-color: #fff;
        border-radius: 5px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        font-size: .24rem;
      }
      .input-btn {
        margin-top: .2rem;
        text-align: center;
        font-size: .24rem;
      }
      .input-btn button {
        width: 4.6rem;
        height: .7rem;
        background-color: #ffc200;
        border-radius: 5px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        font-size: .24rem;
        color: #e52e2e;
      }
      .remark {
        margin-top: .4rem;
        font-size: .24rem;
        color: #fff;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div class="inviter"><p><span></span>邀您</p></div>
      <div class="invite-input">
        <p class="input-box"><input class="phone" type="tel" placeholder="请输入您的手机号" /></p>
        <p class="input-btn"><button>注册领取</button></p>
        <p class="remark">活动最终解释权归三口布袋所有</p>
      </div>
    </div>
    <script src="./js/jquery-3.0.0.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>
      $(function(){
        var ser = location.search.substring(1);
        var wxName = '', mobile = '';
        var serArr = ser.split('&')
        for (var i = 0; i < serArr.length; i++) {
          var oneSer = serArr[i].split('=')
          if(oneSer[0] === 'name'){
            wxName = decodeURI(oneSer[1])
            $('.inviter span').text(decodeURI(oneSer[1]));
          } else if (oneSer[0] === 'mobile') {
            mobile = oneSer[1]
          }
        }
        $.get('/api/wx/config', function (res) {
          if (res.code === 0) {
            const infoObj = res.data
            wx.config({
              debug: false,
              appId: infoObj.appId,
              timestamp: infoObj.timestamp,
              nonceStr: infoObj.nonceStr,
              signature: infoObj.signature,
              jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage']
            })
            wx.ready(function () {
              wx.onMenuShareTimeline({
                title: wxName + '邀请您喝茶', // 分享标题
                link: 'http://ns.sankoubudai.com/share/share1.html?mobile=' + mobile + '&name=' + wxName, // 分享链接
                imgUrl: 'http://ns.sankoubudai.com/share/img/share.png', // 分享图标
                success: function () {
                  // window.alert('分享成功!!!!!!!!!')
                },
                cancel: function () {
                  // window.alert('取消分享')
                }
              })
              wx.onMenuShareAppMessage({
                title: wxName + '邀请您喝茶', // 分享标题
                desc: '', // 分享描述
                link: 'http://ns.sankoubudai.com/share/share1.html?mobile=' + mobile + '&name=' + wxName, // 分享链接
                imgUrl: 'http://ns.sankoubudai.com/share/img/share.png', // 分享图标
                success: function () {
                },
                cancel: function () {
                  // window.alert('取消分享')
                }
              })
            })
          }
        })
        $('.input-btn button').click(function(){
          var myreg = /^1[34578]\d{9}$/;
          if(!myreg.test($('.phone').val())) {
            alert('请输入有效的手机号码！');
            return false;
          }else{
            location.href='share2.html?phone='+$('.phone').val() + "&"+ser;
          }
        });
      })
    </script>
  </body>
</html>
