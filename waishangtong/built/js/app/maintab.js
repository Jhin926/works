define(["common","jquery"],function(){var e=function(){me=this,me.sPop="",me.tab="",me.toWidth=910,me.html='<div id="sPop" class="spop-wrap"><div class="maintab-wrap"><a class="spop-hide" data-maintab-hide href="javascript:;"><i class="s-spop-close"></i></a><a class="spop-show" data-maintab-show href="javascript:;"><i class="fa fa-chevron-left"></i></a><ul class="maintap" id="mainTab"></ul></div><div id="iframeWrap" class="iframe-wrap"></div></div>'};return e.prototype.init=function(){0===$("#sPop").length&&$("body").append(me.html),me.sPop=$("#sPop"),me.tab=$("#mainTab"),me.frameWrap=$("#iframeWrap"),parent.document.getElementById("iframeWrap")&&(me.sPop=$("#sPop",parent.document),me.tab=$("#mainTab",parent.document),me.frameWrap=$("#iframeWrap",parent.document));this.tab.on("click","a.text",function(){if(!$(this).hasClass("currentClass"))return me.showTab($(this).attr("href"),$(this).text(),!1),!1}),this.tab.on("click","i.remove-icon",function(){var e=$(this).parent().index();if($(this).prev().attr("href").indexOf("pop-email-newOut.html")>=0){var i='<div id="confirm_Modal" class="modal" aria-hidden="true" role="basic" tabindex="-1" style="z-index:100001!important;"><div class="modal-dialog" style="width: 300px;margin-top:140px;"><div class="modal-content"><div class="modal-header">  <h4 class="modal-title" style="text-align:left;">提示</h4></div><div class="modal-body">是否要将此邮件保存草稿？</div><div class="modal-footer"><button class="btn btn-primary" data-dismiss="modal" id="okDopConfirmButton1" type="button">是</button><button class="btn btn-primary" data-dismiss="modal" id="destoryDopConfirmButton1" type="button">否</button><button class="btn default" type="button" id="cotinueEdit">取消</button></div></div></div></div>';$("#confirm_Modal").remove(),$("body").append(i),$("#confirm_Modal").modal("show"),$("#okDopConfirmButton1").click(function(){$("#iframeWrap").find(".iframe-page").eq(e)[0].contentWindow.window.saveDraft()}),$("#cotinueEdit").click(function(){$("#confirm_Modal").modal("hide")}),$("#destoryDopConfirmButton1").click(function(){$("#confirm_Modal").modal("hide"),me.closeOne(e)})}else me.closeOne(e)}),$("body").on("click","a[data-maintab]",function(){var e=$(this).prop("href"),i=$(this).prop("title")||$(this).text();return me.showTab(e,i),parent.$.disNone(),!1}),$("body").on("click","[data-maintab-show]",function(){return parent.$.disNone(),me.showPop(),!1}),$("body").on("click","[data-maintab-hide]",function(){return me.hidePop(),!1})},e.prototype.isShowing=function(){return me.sPop.width()>50},e.prototype.showPop=function(){me.sPop.addClass("active").find(".spop-show").hide().siblings(".spop-hide").show(),me.sPop.animate({width:me.toWidth,height:$(".i-content-wrapper").height()},"1000")},e.prototype.hidePop=function(){me.sPop.animate({width:0},"500",function(){me.tab.empty(),me.frameWrap.empty(),parent.$.disBlock()})},e.prototype.addTab=function(e,i){this.isShowing()||this.showPop(),me.tab.find("li").removeClass("currentClass").end().append("<li title='"+i+"' class='currentClass'><a class='text' href='"+e+"'>"+i+"</a><i class='remove-icon'></i>"),me.frameWrap.find("iframe").hide().end().append("<iframe class='iframe-page' src='"+e+"' frameborder='0' width='100%'></iframe>")},e.prototype.isTabExit=function(e){var i=!1;return me.tab.find("li").each(function(t,a){var r=$(a).find("a").attr("href");r===e&&(i=t)}),i},e.prototype.isAlikeTabExit=function(e){var i=!1;return me.tab.find("li").each(function(t,a){var r=$(a).find("a").attr("href");r.indexOf(e)>=0&&(i=t)}),i},e.prototype.showTab=function(e,i,t){if(void 0!=e&&void 0!=i){this.isShowing()||this.showPop();var a=me.isTabExit(e);if(a!==!1){var r=me.frameWrap.find("iframe").eq(a);me.tab.find("li").eq(a).addClass("currentClass").siblings().removeClass("currentClass"),r.show().siblings().hide(),t===!0?r.attr("src",r.attr("src")):"part"===t&&$(r[0].contentWindow.document).find(".box-customer-detail .tabs-menu>li.active").removeClass("active").trigger("click")}else{if(8==me.tab.find("li").size())return void $.Alert("最多只能显示8个选项卡");me.tab.find("li").removeClass("currentClass").end().append("<li title='"+i+"' class='currentClass'><a class='text' href='"+e+"'>"+i+"</a><i class='remove-icon'></i></li>"),e.indexOf("?")>=0?e.indexOf("&v=")>=0?me.frameWrap.find("iframe").hide().end().append("<iframe class='iframe-page' src='"+e+"' frameborder='0' width='100%'></iframe>"):me.frameWrap.find("iframe").hide().end().append("<iframe class='iframe-page' src='"+e+"&v="+window.ver+"' frameborder='0' width='100%'></iframe>"):me.frameWrap.find("iframe").hide().end().append("<iframe class='iframe-page' src='"+e+"?v="+window.ver+"' frameborder='0' width='100%'></iframe>")}return!1}},e.prototype.showOnAlikeTab=function(e,i,t){var a=me.isAlikeTabExit(e);if(this.isShowing()||this.showPop(),a!==!1){var r=me.frameWrap.find("iframe").eq(a);me.tab.find("li").eq(a).addClass("currentClass").siblings().removeClass("currentClass"),me.tab.find("li").eq(a).find("a").text(t).attr({href:i,title:t}),r.attr("src",i).show().siblings().hide()}else me.addTab(i,t)},e.prototype.destroy=function(){me.tab.find("li.currentClass > i.fa-times").trigger("click")},e.prototype.refresh=function(e){var i=void 0==e?window.location.href:e,t=me.isTabExit(i),a=0==t?me.frameWrap.find("iframe:visible"):me.frameWrap.find("iframe").eq(t);a.attr("src",a.attr("src"))},e.prototype.refresh2=function(e,i){var t=me.tab.find("li").eq(e).children("a.text");i?me.showTab(t.attr("href"),t.text(),i):me.showTab(t.attr("href"),t.text(),!0)},e.prototype.tabIdx=function(){var e=me.tab.find("li.currentClass").index();return e},e.prototype.closeOne=function(e,i){if(me.tab.find("li").eq(e).remove(),me.frameWrap.find("iframe").eq(e).remove(),0==me.tab.find("li").length&&me.hidePop(),!i){var t=me.tab.find("li:last").children("a.text");me.showTab(t.attr("href"),t.text(),!1)}},new e});