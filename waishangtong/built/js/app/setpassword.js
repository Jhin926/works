define(["common","cookiehandle"],function(e,t){return{init:function(){$(".data-accout").text(t.getCookie("account"));var e=$("#setPsdBtn"),a=$("#setPsdBtn").closest("form");a.validate(),e.on("click",function(t){t.preventDefault();var n=($(this),$.trim($('[name="oldpsd"]').val())),s=$.trim($('[name="newpsd"]').val()),o=$.trim($('[name="renewpsd"]').val());a.valid()&&(e.prop("disabled",!0).text("正在提交..."),$.ajax({url:Base.sitUrl+"/security/public_key.jhtml",type:"GET",dataType:"json",cache:!1,success:function(t){var c=new RSAKey;c.setPublic(b64tohex(t.data.modulus),b64tohex(t.data.exponent));var i=hex2b64(c.encrypt(n)),r=hex2b64(c.encrypt(s)),l=hex2b64(c.encrypt(o));$.ajax({url:Base.reqUrl,type:"POST",data:{_mt:"user_resetAccountPassword",oldPwd:i,newPwd:r,reNewPwd:l},dataType:"json",success:function(t){t.success?$.Alert("密码修改成功！","",function(){a.find("input").val(""),e.prop("disabled",!1).text("提交"),location.href=Base.builtUrl+"/login.html"}):($.Alert(t.message),a.find("input").val(""),e.prop("disabled",!1).text("提交"))}})}}))})}}});