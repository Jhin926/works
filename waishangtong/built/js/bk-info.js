require(["common"],function(){require(["jquery","countries"],function(){function e(){$.ajax({type:"POST",url:Base.sitUrl+"/api/sys/v1/vendor/get",dataType:"json",success:function(e){if(!e.success)return void $.Alert(e.message);var t=e.data,a=t.sysVendorAccount;if(null!==a||""!==a){var i="",n=a.edmTotal-a.edmUse,l=Date.parse(new Date),o=a.expireDate-l,p=o/1e3/60/60/24;p=p.toFixed(0),p=parseInt(p)+1,$("#name").text(t.name).attr("data-id",t.id),$("#address").text(t.address);for(var r=0;r<s.length;r++)s[r].id==t.countries&&($("#countriesInput").find("option[value="+s[r].id+"]").attr("selected",!0),$("#countries").text(s[r].cn));$("#telephone").text(t.telephone),$("#email").text(t.email),$("#homepage").text(t.homepage),$("#faxes").text(t.faxes),$("#masterUserEmail").text(a.masterUserEmail),$("#expireDate").text(new Date(a.expireDate).format("yyyy-MM-dd")),$("#expireDay").text(p),$("#subAccountUse").text(a.subAccountUse),$("#subAccountTotal").text(a.subAccountTotal),$("#edm").text(n),$("#storageUse").text(a.storageUse),$("#storageTotal").text(a.storageTotal);for(var r=0;r<t.params.length;r++)i+='<li class="list-group-item list-group-itemNew"><label class="labelLeft labelSet" style="display:inline-block;"><span class="set">'+t.params[r].name+'</span>：</label><input type="text" name="" class="inputInfo0 labelLeft" style="display:none;margin-right:24px;width:38%;" value="'+t.params[r].name+'"> <label class="labelRight" style="display:inline-block;">'+t.params[r].value+'</label><input type="text" name="" class="inputInfo" style="display:none;" value="'+t.params[r].value+'"><a href="javascript:void[0]" class="delete" style="display:none;"><i class="group-remove"></i></a></li>';$("#infoCompany li:last-child").before(i)}else $("#name").text(t.name),$("#address").text(t.address),$("#countries").text(t.countries),$("#telephone").text(t.telephone),$("#email").text(t.email),$("#homepage").text(t.homepage),$("#faxes").text(t.faxes),$("#masterUserEmail").text("0"),$("#expireDate").text("0"),$("#expireDay").text("0"),$("#subAccountUse").text("0"),$("#subAccountTotal").text("0"),$("#edm").text("0"),$("#storageUse").text("0"),$("#storageTotal").text("0")}})}for(var t=countries,a='<option value="0">请选择国家</option>',i=0;i<t.length;i++)a+='<option value="'+t[i].id+'">'+t[i].cn+" - "+t[i].en+"</option>";$("#countriesInput").empty().append(a);var s=countries;$("#space").on("click",function(){$("#nameInput").val(""),$("#addressInput").val(""),$("#countriesInput").find("option").eq(0).attr("selected",!0),$("#telephoneInput").val(""),$("#emailInput").val(""),$("#homepageInput").val(""),$("#faxesInput").val("")}),$("#edit").on("click",function(){$("#space").show(),$(this).hide(),$(".inputInfo").show(),$(".inputInfo0").show(),$(".selectInfo").show(),$(".labelRight").hide(),$(".buttonSet").show(),$("#addList").show(),$(".labelSet").hide(),$(".delete").show(),$(".list-group-item").each(function(){var e=$(this).find(".labelRight").text(),t=$(this).find(".set").text();$(this).find(".inputInfo").val(e),$(this).find("input.labelLeft").val(t)})}),$("#save").on("click",function(){for(var e=$("#name").attr("data-id"),t=$("#nameInput").val(),a=$("#addressInput").val(),i=$("#countriesInput option:selected").val(),s=$("#telephoneInput").val(),n=$("#emailInput").val(),l=$("#homepageInput").val(),o=$("#faxesInput").val(),p="",r=0;r<$(".list-group-itemNew").length;r++){if(""===$(".list-group-itemNew").eq(r).find("input[type=text]").eq(0).val())return void $.Alert("请填写自定义字段名称");var u={name:$(".list-group-itemNew").eq(r).find("input[type=text]").eq(0).val(),value:$(".list-group-itemNew").eq(r).find("input[type=text]").eq(1).val()};u=JSON.stringify(u),p+=u+","}p=p.substring(0,p.length-1);var d={id:e,name:t,address:a,countries:i,telephone:s,email:n,homepage:l,faxes:o};d=JSON.stringify(d),d=d.substring(0,d.length-1)+',"params":['+p+"]}",$.ajax({type:"POST",url:Base.sitUrl+"/api/sys/v1/vendor/edit",dataType:"json",data:{data:d},success:function(e){return e.success?void window.location.reload():void $.Alert(e.message)}}),$(".inputInfo").hide(),$(".inputInfo0").hide(),$(".labelRight").show(),$(".selectInfo").hide(),$(".buttonSet").hide(),$("#addList").hide(),$(".labelSet").show(),$(".delete").hide(),$("#space").hide(),$("#edit").show(),$(".list-group-item").each(function(){var e=$(this),t=$(this).find(".inputInfo").val(),a=$(this).find("input.labelLeft").val();$(this).find(".labelRight").text(t),$(this).find(".set").text(a),""==a&&e.remove()})}),$("#cancel").on("click",function(){$("#space").hide(),$("#edit").show(),$(".inputInfo").hide(),$(".inputInfo0").hide(),$(".selectInfo").hide(),$(".labelRight").show(),$(".buttonSet").hide(),$("#addList").hide(),$(".labelSet").show(),$(".delete").hide()}),$(document).on("click",".delete",function(){$(this).parents("li.list-group-item").remove()}),$(".addList").on("click",function(){var e='<li class="list-group-item list-group-itemNew"><label class="labelLeft labelSet" style="display:none;"><span class="set">自定义字段</span>：</label><input type="text" name="" class="inputInfo0 labelLeft" style="display:inline-block;margin-right:24px;width:38%;"> <label class="labelRight" style="display:none;">自定义属性</label><input type="text" name="" class="inputInfo" style="display:inline-block;"><a href="javascript:void[0]" class="delete" style="display:inline-block;"><i class="group-remove"></i></a></li>';$(this).parents("li.list-group-item").before(e)}),e()})});