require(["common"],function(){require(["maintab","blockUI","ztree"],function(e){function a(){$.ajax({type:"GET",url:Base.sitUrl+"/api/org/v1/org/role/list",success:function(e){for(var a="",t=0;t<e.data.length;t++)a+='<option value="'+e.data[t].id+'">'+e.data[t].name+"</option>";$("#popRole").append(a)}})}function t(){var e;return $.ajax({type:"POST",url:Base.sitUrl+"/api/org/v1/org/organization/list",dataType:"json",async:!1,success:function(a){return a.success?void(e=a.data):void $.Alert(a.message)}}),e}function n(e,a){return!1}function d(e,a){var t=l;$("#treeDemo").find("a");if(!a.parentNode||2==a.parentNode.id)for(var n=$("#"+a.tId+c),d=0;d<t.length;d++)if(a.id==t[d].id){var i="<span class='ztreepopNum' id='diyBtn_"+a.id+"' title='"+a.name+"'>"+t[d].staffSum+"</span>";n.after(i)}}function i(){var e=$.fn.zTree.getZTreeObj("treeDemo");e.setting.edit.editNameSelectAll=$("#selectAll").attr("checked")}var o=document.getElementById("div1"),r=document.getElementById("div2"),s=1;r.onclick=function(){o.className="close1"==o.className?"open1":"close1",r.className="close2"==r.className?"open2":"close2",1==s?($("#div2").attr("data-num",0),s=0):($("#div2").attr("data-num",1),s=1)},a(),$("#pop-add-save").on("click",function(){var e=$("#popAddName").val(),a=$("#popAddEmail").val(),t=$("#popRole").find("option:selected").val(),n=$("#div2").attr("data-num");$(".gender").find("input[type=radio]").each(function(){$(this).is(":checked")&&(popAddGender=$(this).data("num"))}),$(".gender1").find("input[type=radio]").each(function(){$(this).is(":checked")&&(popAddGender1=$(this).data("num"))});var d=$.fn.zTree.getZTreeObj("treeDemoAdd"),i=d.getSelectedNodes();""==e||""==a||""==i?$.Alert("请填写带星号的内容"):$.ajax({type:"POST",url:Base.sitUrl+"/api/org/v1/org/staff/save",dataType:"json",data:{name:e,email:a,gender:popAddGender,isAdmin:popAddGender1,roleId:t,isInvite:n,department:i[0].id},success:function(e){return e.success?(parent.location.reload(),void $.DestroyPopInPop()):void $.Alert(e.message)}})});for(var l=t(),c="_a",p={view:{addDiyDom:d,selectedMulti:!1},edit:{enable:!0,editNameSelectAll:!0},data:{simpleData:{enable:!0}},callback:{beforeDrag:n}},u=new Array,m=l,f=0;f<m.length;f++)u[f]={id:m[f].id,pId:m[f].pid,name:m[f].name,open:!0};$.fn.zTree.init($("#treeDemoAdd"),p,u),$("#selectAll").on("click",i)})});