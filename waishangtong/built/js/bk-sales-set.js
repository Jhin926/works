require(["common"],function(){require(["maintab"],function(t){$.ajax({url:Base.sitUrl+"/api/org/v1/org/staff/limit/edm/list",dataType:"json",type:"POST",success:function(t){if(!t.success)return void $.Alert(t.message);for(var e=t.data,a=0;a<e.length;a++){var d=(e[a].totalNumber-e[a].usedNumber,'<tr data-id="'+e[a].id+'"><td width="20%" data-uerId="'+e[a].userId+'"><label class="blue">'+e[a].userName+'</label></td><td width="20%" data-dep="'+e[a].department+'"><label>'+e[a].departmentName+'</label></label></td><td width="20%"><label>'+e[a].usedNumber+'</label></td><td width="20%"><input type="text" class="table-input" value="'+e[a].totalNumber+'"></td></tr>');$(".table tbody").append(d)}}}),$("#save").unbind("click").on("click",function(){for(var t=$(".table tbody").children("tr"),e="",a="",d=0;d<t.length;d++){var i=t.eq(d).find("input[type=text]").val(),l=parseInt(t.eq(d).find("td:nth-child(3)").text());if(isNaN(i))return $.Alert("请填写数字"),void t.eq(d).find("input[type=text]").css("border","1px solid red");e+='{"key":"'+t.eq(d).data("id")+'","value":"'+i+'","valueI":"'+l+'","type":"3"},'}e=e.substr(0,e.length-1),a='{"keyValueTypes":['+e+"]}",$.Confirm("确认修改？","",function(){$.ajax({url:Base.sitUrl+"/api/org/v1/org/staff/limit/edm/edit",dataType:"json",type:"POST",data:{data:a},success:function(t){return t.success?void window.location.reload():void $.Alert(t.message)}})})})})});