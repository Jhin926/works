require(["common"],function(){require(["maintab","ueditorLang","blockUI"],function(t){function e(t,e){var s="";$.each(t,function(t,e){var a,r="",d="";a=e.emailSum>0?100*(e.deliverySum/e.emailSum).toFixed(2)+"%":"0.00",0==e.status?(r="发送中",d="sending-icon"):1==e.status?(r="发送中",d="sending-icon"):2==e.status?(r="已发送",d="sended-icon"):r="已发送";var i=e.createTime.substring(0,e.createTime.length-2);s+='<tr data-id="'+e.id+'"><td><i class="pub-icon '+d+'" title="'+r+'"></i></td><td><a class="link-l-detal" href="pop-letter-detail.html?id='+e.id+"&v="+window.ver+'" data-maintab>'+e.subject+'</a></td><td class="text-center">'+e.emailSum+'</td><td class="text-center"><span class="send-rate">'+a+'</span></td><td class="text-center"><span class="open-num">'+e.openSum+'</span></td><td class="text-right send-time"><span class="sortsTime">'+i+"</span></td></tr>"}),$(".trNone").remove(),$(".page_info>table>tbody").empty().append(s);var d=e,i=a.pageSize,n=Math.ceil(d/i);a.lastpage=n,$.Page({total:d,_class:".page",nowNum:a.currentPage,allNum:n,callback:function(t,e){a.currentPage=t,r.filter()}})}t.init();var a={homepage:1,currentPage:1,lastpage:null,pageSize:10},r={filter:function(){var t={currentPage:a.currentPage,pageSize:a.pageSize};$.ajax({url:Base.sitUrl+"/api/edm/v1/list",data:{data:JSON.stringify(t)},type:"POST",dataType:"json",async:!1,success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results,r=t.data.totalItem;if(a.length>0)e(a,r);else{var s='<div style="text-align:center;"><img src="../images/devNone.png" /><div style="margin-top:20px"><a href="pop-letter-new.html" class="btn btn-primary" id="addEmail-none" data-maintab=""><i class="pub-icon newemail-icon"></i>&nbsp;<span>新建营销信</span></a></div></div>';$(".page_info>table").after(s)}}})}};$.reHtml=function(){var t={currentPage:a.currentPage,pageSize:a.pageSize};$.ajax({url:Base.sitUrl+"/api/edm/v1/list",data:{data:JSON.stringify(t)},type:"POST",dataType:"json",async:!1,success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results,r=t.data.totalItem;if(a.length>0)e(a,r);else{var s='<div style="text-align:center;"><img src="../images/devNone.png" /><div style="margin-top:20px"><a href="pop-letter-new.html" class="btn btn-primary" id="addEmail-none" data-maintab=""><i class="pub-icon newemail-icon"></i>&nbsp;<span>新建营销信</span></a></div></div>';$(".page_info>table").after(s)}}})},r.filter();var s=$("#new-develop").attr("href")+"?v="+window.ver;$("#new-develop").attr("href",s),$(".table thead th").unbind("click").on("click",function(){function t(t,e){return t-e}function t(t,e){return t-e}function t(t,e){return t-e}for(var e=new Array,a=new Array,r=new Array,s=$(".table tbody tr"),d="",i="",n="",l=0;l<s.length;l++){var o=Date.parse(new Date($(".table tbody tr").eq(l).find(".sortsTime").text()));d+=o+$(".table tbody tr").eq(l).attr("data-id")+","}d=d.substring(0,d.length-1),e=d.split(","),e=e.sort(t);var b;if("sortsTime"==$(this).attr("id")){if($("#sortsTime").find(".s-orderList").addClass("s-reorderList"),$("#sortsTime").find(".s-reorderList").removeClass("s-orderList"),""==$("#sortsTime").attr("class")||void 0==$("#sortsTime").attr("class")){$("#sortsTime").addClass("up");for(var l=0;l<s.length;l++)for(var p=0;p<s.length;p++){var u=e[l].substring(13,e[l].length);$(".table tbody tr").eq(p).attr("data-id")==u&&(b+='<tr data-id="'+$(".table tbody tr").eq(p).attr("data-id")+'">'+$(".table tbody tr").eq(p).html()+"</tr>")}$(".table tbody").empty(),$(".table tbody").append(b)}else if("up"==$("#sortsTime").attr("class")){$("#sortsTime").find(".s-reorderList").addClass("s-orderList"),$("#sortsTime").find(".s-orderList").removeClass("s-reorderList"),$("#sortsTime").removeClass("up");for(var m=s.length,l=0;l<m;l++)for(var p=0;p<m;p++){var c=m-l,u=e[c-1].substring(13,e[c-1].length);$(".table tbody tr").eq(p).attr("data-id")==u&&(b+='<tr data-id="'+$(".table tbody tr").eq(p).attr("data-id")+'">'+$(".table tbody tr").eq(p).html()+"</tr>")}$(".table tbody").empty(),$(".table tbody").append(b)}}else if("open-num"==$(this).attr("id")){for(var l=0;l<s.length;l++){var f=$(".table tbody tr").eq(l).find(".open-num").text();i+=f+"."+$(".table tbody tr").eq(l).attr("data-id")+","}i=i.substring(0,i.length-1),r=i.split(","),r=r.sort(t);var m=s.length;if($("#open-num").find(".s-orderList").addClass("s-reorderList"),$("#open-num").find(".s-reorderList").removeClass("s-orderList"),$("#open-num").hasClass("up")){if($("#open-num").hasClass("up")){$("#open-num").find(".s-reorderList").addClass("s-orderList"),$("#open-num").find(".s-orderList").removeClass("s-reorderList"),$("#open-num").removeClass("up");for(var l=0;l<m;l++)for(var p=0;p<m;p++){var c=m-l,v=r[c-1].substring(r[c-1].search(/\./)+1,r[c-1].length);$(".table tbody tr").eq(p).attr("data-id")==v&&(b+='<tr data-id="'+$(".table tbody tr").eq(p).attr("data-id")+'">'+$(".table tbody tr").eq(p).html()+"</tr>")}$(".table tbody").empty().append(b)}}else{$("#open-num").addClass("up");for(var l=0;l<m;l++)for(var p=0;p<m;p++){var c=m-l,v=r[l].substring(r[l].search(/\./)+1,r[l].length);$(".table tbody tr").eq(p).attr("data-id")==v&&(b+='<tr data-id="'+$(".table tbody tr").eq(p).attr("data-id")+'">'+$(".table tbody tr").eq(p).html()+"</tr>")}$(".table tbody").empty(),$(".table tbody").append(b)}}else if("send-rate"==$(this).attr("id")){for(var l=0;l<s.length;l++){var g=$(".table tbody tr").eq(l).find(".send-rate").text();g=g.replace(/\%/i,"0"),n+=g+"."+$(".table tbody tr").eq(l).attr("data-id")+","}n=n.substring(0,n.length-1),a=n.split(","),a=a.sort(t);var m=s.length;if($("#send-rate").find(".s-orderList").addClass("s-reorderList"),$("#send-rate").find(".s-reorderList").removeClass("s-orderList"),$("#send-rate").hasClass("up")){if($("#send-rate").hasClass("up")){$("#send-rate").find(".s-reorderList").addClass("s-orderList"),$("#send-rate").find(".s-orderList").removeClass("s-reorderList"),$("#send-rate").removeClass("up");for(var l=0;l<m;l++)for(var p=0;p<m;p++){var c=m-l,v=a[c-1].substring(a[c-1].search(/\./)+1,a[c-1].length);$(".table tbody tr").eq(p).attr("data-id")==v&&(b+='<tr data-id="'+$(".table tbody tr").eq(p).attr("data-id")+'">'+$(".table tbody tr").eq(p).html()+"</tr>")}$(".table tbody").empty(),$(".table tbody").append(b)}}else{$("#send-rate").addClass("up");for(var l=0;l<m;l++)for(var p=0;p<m;p++){var c=m-l,v=a[l].substring(a[l].search(/\./)+1,a[l].length);$(".table tbody tr").eq(p).attr("data-id")==v&&(b+='<tr data-id="'+$(".table tbody tr").eq(p).attr("data-id")+'">'+$(".table tbody tr").eq(p).html()+"</tr>")}$(".table tbody").empty(),$(".table tbody").append(b)}}}),$(document).on("click","tr",function(){$(this).find("a").click()})})});