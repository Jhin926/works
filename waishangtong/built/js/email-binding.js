require(["common"],function(){require(["maintab","blockUI"],function(e,s){window.ZeroClipboard=s,$("#setting-btn").on("click",function(){$("#email-binding").hide(),$("#setting").show();var e=$("#email-binding .emailAddress").val(),s=$("#email-binding .password").val();$("#setting .emailAddress").val(e),$("#setting .password").val(s),addressNum=e.search("@"),addressPostfix=e.substring(addressNum+1,e.length),""!==addressPostfix&&addressNum>0&&($("#receiveHost").val("imap."+addressPostfix),$("#smtpHost").val("smtp."+addressPostfix));var t=$("#setting .emailAddress").val();r.test(t)||""===t?($("#setting .emailAddress").css("border","1px solid #ccc"),$("#setting .emailAddress").parent().next(".errorEmail").hide()):($("#setting .emailAddress").css("border","1px solid red"),$("#setting .emailAddress").parent().next(".errorEmail").show())}),$("#back").on("click",function(){$("#email-binding").show(),$("#setting").hide()}),$("#receiveServerType").on("change",function(){var e=$("#email-binding .emailAddress").val();addressNum=e.search("@"),addressPostfix=e.substring(addressNum+1,e.length);var s=$(this).find("option:selected").attr("data-kind");""!==addressPostfix&&$("#receiveHost").val(s+"."+addressPostfix)}),$("#receiveSsl").on("click",function(){"checked"==$("#receiveSsl").parent().attr("class")?$("#receivePort").val(993):$("#receivePort").val(143)}),$("#smtpSsl").on("click",function(){"checked"==$("#smtpSsl").parent().attr("class")?($("#smtpPort").val(456),$("#startTls").attr("disabled",!0),$("#startTls").parents(".erroMes").css("color","#ccc")):($("#smtpPort").val(25),$("#startTls").attr("disabled",!1),$("#startTls").parents(".erroMes").css("color","#333"))});var r=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;$("#email-binding .emailAddress,#setting .emailAddress").on("change",function(){$("#errorCont").hide();var e=$(this).val();r.test(e)?($(this).css("border","1px solid #ccc"),$(this).parent().next(".errorEmail").hide()):($(this).css("border","1px solid red"),$(this).parent().next(".errorEmail").show())}),$("#setting input[type!=checkbox]").on("input",function(){""!==$(this).val()&&$(this).css("border-color","#ccc")}),$("#create-btn").on("click",function(){var e=$("#email-binding .emailAddress").val(),s=$("#email-binding .password").val(),t={simple:1,emailAddress:e,password:s};t=JSON.stringify(t),""!==e&&""!==s&&r.test(e)?$.ajax({url:Base.sitUrl+"/api/user/email/v1/binding",type:"POST",dataType:"json",data:{data:t},beforeSend:function(){$.BlockUI()},success:function(e){return 400003==e.code?($("#errorCont").show(),void $(".blockUI").remove()):e.success?void(e.success?(parent.location.reload(),$.DestroyPopInPop()):$.Alert(e.message)):($(".blockUI").remove(),$("#errorCont").show(),$("#errorCont").children().remove(),void $("#errorCont").text(e.message))}}):""==e?$.Alert("请输入邮箱地址！"):""==s&&$.Alert("请输入密码！")}),$("#create-btn-detail").on("click",function(){var e=$("#setting .emailAddress").val(),s=$("#setting .password").val(),t=$("#smtpHost").val(),i=parseInt($("#smtpPort").val()),a="checked"==$("#smtpSsl").parent().attr("class")?1:0,o=parseInt($("#receiveServerType option:selected").val()),n=$("#receiveHost").val(),d=parseInt($("#receivePort").val()),c="checked"==$("#receiveSsl").parent().attr("class")?1:0,l="checked"==$("#startTls").parent().attr("class")?1:0,v={simple:0,emailAddress:e,password:s,smtpHost:t,smtpPort:i,smtpSsl:a,receiveServerType:o,receiveHost:n,receivePort:d,receiveSsl:c,startTls:l};v=JSON.stringify(v),""!==e&&""!==s&&r.test(e)?$.ajax({url:Base.sitUrl+"/api/user/email/v1/binding",type:"POST",dataType:"json",data:{data:v},beforeSend:function(){$.BlockUI()},success:function(e){return 400003==e.code?($("#errorContS").show(),void $(".blockUI").remove()):e.success?void(e.success?(parent.location.reload(),$.DestroyPopInPop()):$.Alert(e.message)):($(".blockUI").remove(),$("#errorContS").show(),$("#errorContS").children().remove(),void $("#errorContS").text(e.message))}}):($.Alert("请填写完整！"),$("#setting").find("input[type!=checkbox]").each(function(e){""==$(this).val()&&$(this).css("border-color","red")}))})})});