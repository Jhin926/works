require(["common"],function(){require(["maintab","blockUI","datetimepickerCN"],function(t){function a(){$(".modals").removeClass("active"),$("#assigns").val(""),$("#btn-assign").hide()}function e(){$("#tableSort").find("input[name='batch']").each(function(){$(this).attr("checked",!1),$(this).parent("span").removeClass("checked")})}var i=top.funcList;$("[data-code]").each(function(){for(var t=0;t<i.length;t++)i[t].code==$(this).attr("data-code")&&$(this).removeClass("none")}),t.init(),$(".r-titles").hide(),jQuery().datetimepicker&&$(".datetime-picker").datetimepicker({language:"zh-CN",todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,format:"yyyy-mm-dd",bootcssVer:3});var n=$("#filterModal"),s={};n.on("click","#reset",function(t){$("#keyword").val(""),$("#addresser").val(""),$("#recipient").val("");for(var a=$("#attachment input:radio").parent(),e=0;e<a.length;e++)a.eq(e).removeClass("checked");$("#proDateBeg").val(""),$("#proDateEnd").val("")}),n.on("click","#screen",function(t){l.currentPage=1;var a=$("#keyword"),e=$("#addresser"),i=$("#recipient"),n=$("#proDateBeg"),o=$("#proDateEnd"),r={};""!=a.val()&&""!=$.trim(a.val())&&(r.keyword=a.val()),""!=e.val()&&""!=$.trim(e.val())&&(r.sender=e.val()),""!=i.val()&&""!=$.trim(i.val())&&(r.receiver=i.val()),""!=n.val()&&""!=$.trim(n.val())&&(r.startDate=n.val()),""!=o.val()&&""!=$.trim(o.val())&&(r.endDate=o.val()),r.hasAttachment=-1;for(var c=$("#attachment input:radio").parent(),u=0;u<c.length;u++)c.eq(u).hasClass("checked")&&(r.hasAttachment=u-1);r.filtrate=1,s=r,d.filter(s),$("#filterModal").modal("hide")}),$("#addEmail").click(function(){$("#mainIframe",parent.document).attr("src","./pop-email-new.html?&v="+window.ver)}),$(".page_info").on("click","tbody>tr .btn-privateCust",function(t){$.EventFn(t);var a=$(this).closest("tr").find("input[name=batch]").attr("data-id"),e={id:a},i=$(this);$.ajax({url:Base.sitUrl+"/api/customer/v1/into/private/seas",type:"POST",dataType:"json",data:{data:JSON.stringify(e)},success:function(t){i.text("查看客户"),i.addClass("company-name").removeClass("btn-privateCust")}})}),$("#btn-addLabel").click(function(t){$.EventFn(t);var a=$("#labelName").val();if(""!=a){var e={name:a,tagType:3};$.ajax({url:Base.sitUrl+"/api/user/v1/user/tag/save",data:e,success:function(t){return t.success?(d.inboxMenu(e.tags),void $(".emailcreatgroup").removeClass("active")):void $.unLogin(t)}})}else $.Alert("请输入标签内容")}),$(".page_info").on("click","tbody>tr .btn-privateCont",function(t){$.EventFn(t);var a=$(this).closest("tr").find("input[name=batch]").attr("data-id"),e={id:a},i=$(this);$.ajax({url:Base.sitUrl+"/api/customer/contacts/v1/into/private/seas",type:"POST",dataType:"json",data:{data:JSON.stringify(e)},success:function(t){i.text("查看联系人").addClass("btn-blockDetail").removeClass("btn-privateCont")}})}),$(".page_info").on("click","tbody>tr .xiegenjin",function(a){$.EventFn(a);var e=$(this).parents("li").attr("data-customer"),i=$(this).parents("li").attr("data-cont");t.showTab(Base.url+"/html/pop-upload.html?type=1&id="+e+"&contId="+i+"&v="+window.ver,"写跟进")}),$(".page_info").on("click",".newtongxunlu",function(a){$.EventFn(a);var e=$(this).parents(".sender-condition").find(".sender-condition-name").text();t.showTab(Base.url+"/html/pop-statistics-new.html?name="+e+"&v="+window.ver,"新建通讯录")}),$(".page_info").on("click",".tongxunlu",function(a){$.EventFn(a);$(this).closest("tr").find("input[name=batch]").attr("data-id");t.showTab(Base.url+"/html/email-statistics.html?&v="+window.ver,"通讯录")}),$(".page_info").on("click","tbody>tr .fayoujian",function(t){$.EventFn(t);var a=$(this).closest("tr").find("input[name=batch]").attr("data-id");$("#mainIframe",parent.document).attr("src",Base.url+"/html/pop-email-new.html?type=0&id="+a+"&v="+window.ver)}),$(".page_info").on("click","tbody>tr .come-go",function(a){$.EventFn(a);var e=$(this).parents("td").attr("data-email");t.showTab(Base.url+"/html/pop-come-go-email.html?email="+e+"&v="+window.ver,"往来邮件")}),$(".page_info").on("click",".sender-condition",function(t){$.EventFn(t)}),$(".page_info").on("click","tbody>tr",function(a){$.EventFn(a);var e=$(this).find("input[name=batch]").attr("data-id"),i=$(this).find(".inboxContent").find("a").text();$.GetLength(i)>10&&(i=$.autoAddEllipsis(i,8)),$(this).removeClass("noRead"),t.showTab(Base.url+"/html/pop-email-detail.html?id="+e+"&uri=/api/email/inbox/v1/detail&v="+window.ver,i)}),$(".btn-about").on("click","#btn-fetch",function(t){$.EventFn(t),d.getting()}),$(".m_batch").on("click","#btn-groups",function(){$("#groupsModal").addClass("active").siblings(".modals").removeClass("active")}),$("#groupsModal").on("click",".mbody>.group-list>li",function(t){$.EventFn(t);var i=d.getAllChecked().ids,n=$(this).attr("data-id");d.distributionGroup(i,n),a(),$(this).parent(".mhead").parent(".modals").removeClass("active"),e(),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$("#btn-tags").on("click",function(){$("#tagsModal").addClass("active").css("left",$(this).position().left).siblings(".modals").removeClass("active")}),$("#tagsModal").on("click",".mbody>.label-list>li",function(t){$.EventFn(t);var i=d.getAllChecked().ids,n=$(this).attr("data-id"),s=$(this).attr("data-accountId");d.distributionTag(i,n,s),a(),$(this).parent(".mhead").parent(".modals").removeClass("active"),e(),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$(".page_info").on("mouseenter",".mark-p",function(t){$.EventFn(t);var a=$(this).children(".close-icon");"none"==a.css("display")&&a.show()}),$(".page_info").on("mouseleave",".mark-p",function(t){$.EventFn(t);var a=$(this).children(".close-icon");"block"==a.css("display")&&a.hide()}),$(".page_info").on("click",".close-icon",function(t){$.EventFn(t);var a=$(this),e=a.parent(".mark-p").attr("data-id");"block"==a.css("display")&&(a.hide(),a.parent(".mark-p").remove(),d.deleteTag(e))}),$(".m_batch").on("click","#btn-dels",function(t){$.EventFn(t),$.Confirm("确认删除？","",function(){var t=d.getAllChecked().ids;d.deleteEmail(t),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})})}),$(".m_batch").on("click",".mclose",function(t){$.EventFn(t),a(),$(this).parent(".mhead").parent(".modals").removeClass("active"),e(),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$("#delsModal").on("click","#btn-del-no",function(t){$.EventFn(t);d.getAllChecked().ids;a(),$(this).parent(".mhead").parent(".modals").removeClass("active"),e(),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$(".page_info").on("click",".btn-blockAdd",function(a){$.EventFn(a);var e=$(this).parents(".sender-condition").find(".sender-condition-name").text();t.showTab(Base.url+"/html/pop-contacts-add.html?name="+e+"&v="+window.ver,"添加联系人")}),$(".page_info").on("click",".btn-blockDetail",function(a){$.EventFn(a);var e=$(this).parents("li").attr("data-cont");t.showTab(Base.url+"/html/pop-relation-detail.html?id="+e+"&v="+window.ver,"联系人详情")}),$(".page_info").on("click",".company-name",function(a){$.EventFn(a);var e=$(this).parents("li").attr("data-customer");t.showTab(Base.url+"/html/pop-customer-detail.html?id="+e+"&v="+window.ver,"客户详情")}),$(".page_info").on("mouseenter",".sender-condition-td",function(t){$.EventFn(t),$(this).find(".sender-condition-style").show()}),$(".page_info").on("mouseleave",".sender-condition-td",function(t){$.EventFn(t),$(this).children(".sender-condition-style").hide()}),$("#emailFilter").on("click",".s-up2",function(t){$.EventFn(t),$(this).addClass("s-down2").removeClass("s-up2"),$(this).removeClass("s-add").removeClass("s-close")}),$("#emailFilter").on("click",".s-down2",function(t){$.EventFn(t),$(this).addClass("s-up2").removeClass("s-down2").removeClass("s-add").removeClass("s-close"),$(this).parents("li").find("ul").removeClass("active")}),$("#emailFilter").on("click",">li",function(t){$.EventFn(t),$(this).addClass("activeFilter").siblings("li").removeClass("activeFilter");var a=$(this).index();if(a>0&&a<5){if($(this).hasClass("active"))return;$(this).addClass("active").siblings("li").removeClass("active")}else $(this).siblings("li").removeClass("active");if(0==a)d.filter();else if(1==a){var e=$(this).children("a").children("i.s-updownBg"),i=$(".group-list"),n=$(".group-list>li");e.hasClass("s-up2")?(e.removeClass("s-up2").addClass("s-down2"),i.addClass("active"),0==n.length&&d.inboxMenu(i),i.addClass("active")):(e.removeClass("s-down2").addClass("s-up2"),i.removeClass("active"))}else if(2==a){if(l.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.filter(null,null,1);else{var s=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(s,null,null,1)}$(".page-left").animate({left:"-160px"})}else if(3==a){if(l.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,1);else{var s=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(s,null,null,null,1)}$(".page-left").animate({left:"-160px"})}else if(4==a){if(l.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,null,1);else{var s=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(s,null,null,null,null,1)}$(".page-left").animate({left:"-160px"})}else if(5==a){if(l.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,null,null,1);else{var s=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(s,null,null,null,null,null,1)}$(".page-left").animate({left:"-160px"})}else if(6==a){var e=$(this).children("a").children("span").children("i.s-updownBg").eq(1),o=$(this).children("ul.label-list");e.hasClass("s-up2")?(e.removeClass("s-up2").addClass("s-down2"),o.addClass("active")):(e.removeClass("s-down2").addClass("s-up2"),o.removeClass("active"))}}),$("#emailFilter").on("click",".s-add",function(t){$.EventFn(t);var a=$(this);a.parents("li").find("ul").hasClass("active")?a.parents("li").find("ul").addClass("active"):a.parents("li").find("ul").removeClass("active"),a.hasClass("s-add")?($(this).find(".s-add").removeClass("s-add").addClass("s-close"),$(this).parents("li").find(".emailcreatgroup").addClass("active"),a.addClass("s-close").removeClass("s-add")):($(this).find(".s-close").removeClass("s-close").addClass("s-add"),$(this).parents("li").find(".emailcreatgroup").removeClass("active"),a.addClass("s-add").removeClass("s-close"))}),$("#emailFilter").on("click",".s-close",function(t){$.EventFn(t);var a=$(this);a.parents("li").find("ul").hasClass("active")?a.parents("li").find("ul").addClass("active"):a.parents("li").find("ul").removeClass("active"),a.hasClass("s-add")?($(this).find(".s-add").removeClass("s-add").addClass("s-close"),$(this).parents("li").find(".emailcreatgroup").addClass("active"),a.addClass("s-close").removeClass("s-add")):($(this).find(".s-close").removeClass("s-close").addClass("s-add"),$(this).parents("li").find(".emailcreatgroup").removeClass("active"),a.addClass("s-add").removeClass("s-close"))}),$("#emailFilter").on("click",".group-list>li",function(t){$.EventFn(t),l.currentPage=1,$(this).addClass("groupLi").siblings().removeClass("groupLi");var a=$(this).attr("data-id");if("none"==$("#btn-underling-pop").css("display"))d.filter(null,a);else{var e=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(e,null,a)}}),$("#emailFilter").on("click",".label-list>li",function(t){$.EventFn(t),l.currentPage=1,$(this).addClass("labelLi").siblings().removeClass("labelLi");var a=$(this).attr("data-id");if("none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,null,null,null,a);else{var e=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(e,null,null,null,null,null,null,a)}}),$(".page_info").on("click",".star",function(t){$.EventFn(t),$(this).hasClass("star-icon")?($(this).removeClass("star-icon").addClass("stared-icon"),listVal=$(this).attr("data-value"),0==listVal&&(listVal=1),listId=$(this).attr("data-id"),d.starChange(listId,1)):($(this).removeClass("stared-icon").addClass("star-icon"),listVal=$(this).attr("data-value"),1==listVal&&(listVal=0),listId=$(this).attr("data-id"),d.starChange($(this).attr("data-id"),0))}),$(".page_info").on("click","tbody>tr",function(t){$.EventFn(t);var a=$(this).find("input[name=batch]").attr("data-id"),e=$(this).attr("isRead");0==e&&(d.isRead(a,1),$(this).attr("isRead","1").css("font-weight","400"))}),$(".page_info").on("click",">table>thead>tr>th",function(t){$.EventFn(t);var a=[];"sender"==$(this).attr("id")?"0"==$(this).attr("data-type")?(a=d.sortName.sort(function(t,a){return t.emailAddress.charCodeAt()-a.emailAddress.charCodeAt()}),$(this).attr("data-type","1"),d.shujuzhanshi(a,d.total)):(a=d.sortName.sort(function(t,a){return a.emailAddress.charCodeAt()-t.emailAddress.charCodeAt()}),$(this).attr("data-type","0"),d.shujuzhanshi(a,d.total)):"sortTime"==$(this).attr("id")&&("0"==$(this).attr("data-type")?(a=d.sortName.sort(function(t,a){return new Date(t.sendTime).getTime()-new Date(a.sendTime).getTime()}),$(this).attr("data-type","1"),d.shujuzhanshi(a,d.total)):(a=d.sortName.sort(function(t,a){return new Date(a.sendTime).getTime()-new Date(t.sendTime).getTime()}),$(this).attr("data-type","0"),d.shujuzhanshi(a,d.total)))}),$(".page-content").on("keyup","#inputQuick",function(t){if($.EventFn(t),"none"==$("#btn-underling-pop").css("display"))var a={filtrate:1,keyword:$("#inputQuick").val()||"",attachmentName:""};else var e=$("#btn-underling-pop").attr("data-id"),a={filtrate:1,keyword:$("#inputQuick").val()||"",attachmentName:"",id:e};13==event.keyCode&&(a.addressType!=-1||""!=a.emailTime||""!=a.keyword||""!=a.attachmentName?d.filter(a):d.filter())});var l={homepage:1,lastpage:null,currentPage:1,pageSize:20},d={lastpage:null,currentPage:1,sortName:[],total:0,page:{pageSize:l.pageSize,currentPage:l.currentPage},filter:function(t,a,e,i,n,s,o,r,c){var u={group:a||0,unread:e||0,star:i||0,deleted:n||0,spam:s||0,tag:o||"",subject:r||"",content:c||"",currentPage:l.currentPage,pageSize:l.pageSize};t&&$.extend(u,t),$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/search",data:{data:JSON.stringify(u)},type:"POST",beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results;d.sortName=a,d.total=t.data.totalItem,d.shujuzhanshi(a,d.total)}})},getting:function(t,a,e,i,n,s,o,r){var c={group:t||0,unread:a||0,star:e||0,deleted:i||0,spam:n||0,tag:s||"",subject:o||"",content:r||"",currentPage:l.currentPage,pageSize:l.pageSize};$.ajax({data:{data:JSON.stringify(c)},url:Base.sitUrl+"/api/email/inbox/v1/fetch",beforeSend:function(t){$(".getting").animate({opacity:"1"})},complete:function(t,a){$(".getting").animate({opacity:"0"})},success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results,e="";return 0==a.length?(e='<tr><td colspan="6" style="text-align: center;">还没有收到邮件</td></tr>',void $(".page_info>table>tbody").empty().append(e)):(d.sortName=a,d.total=t.data.totalItem,void d.shujuzhanshi(a,d.total))}})},shujuzhanshi:function(t,a){var e="",i="";if(t.length>0)for(var n=0;n<t.length;n++){var s=t[n].hasAttachment,o=$.dateObj(new Date(t[n].sendTime).getTime())._getDatetime(),r=t[n].isStar,c=t[n].isRead,u="";if(null!=t[n].visitingCard&&""!=t[n].visitingCard){var p=t[n].visitingCard.status,m=t[n].visitingCard.isHighSeas,v=t[n].visitingCard.customerName;userimg="";var b="";if(1==m&&(b="<span>公海</span>"),null!==t[n].visitingCard.customerStatusName)var g=t[n].visitingCard.customerStatusName.substring(0,1);else var g="";switch(p){case 1:userimg='<i class="pub-icon sender4-icon"></i>',i='<ul><li data-id="'+t[n].id+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockAdd">添加为联系人</button><div class="btn-group condition-cz-btn" role="group" style="margin-left:-118px;"><button type="button" class="btn btn-default newtongxunlu">添加通讯录</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 2:userimg='<i class="pub-icon sender4-icon"></i>',i='<ul><li data-id="'+t[n].id+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockAdd">添加为联系人</button><div class="btn-group condition-cz-btn" role="group" style="margin-left:-118px;"><button type="button" class="btn btn-default tongxunlu">通讯录好友</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 3:userimg='<i class="pub-icon sender1-icon"></i>',i='<ul><li data-id="'+t[n].id+'" data-customer="'+t[n].visitingCard.customerId+'" data-cont="'+t[n].visitingCard.customerContactsId+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[n].visitingCard.customerStatusColour+';">'+g+'</span><span class="ellipsis company-name name-blue">'+v+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[n].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockDetail">查看联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin">写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 4:userimg='<i class="pub-icon sender1-icon"></i>',i='<ul><li data-id="'+t[n].id+'" data-customer="'+t[n].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[n].visitingCard.customerStatusColour+';">'+g+'</span><span class="ellipsis company-name name-blue">'+v+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[n].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockAdd">添加为联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 5:userimg='<i class="pub-icon sender3-icon"></i>',i='<ul><li data-id="'+t[n].id+'" data-customer="'+t[n].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender3-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[n].visitingCard.customerStatusColour+';">'+g+'</span><span class="ellipsis company-name name-blue">'+v+'</span></div><div class="belong-yewuy"><label>所属业务员：</label>'+b+'</div><button type="button" class="btn btn-primary btn-lg btn-block btn-privateCont">添加到私海</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 6:userimg='<i class="pub-icon sender3-icon"></i>',i='<ul><li data-id="'+t[n].id+'" data-customer="'+t[n].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender3-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[n].visitingCard.customerStatusColour+';">'+g+'</span><span class="ellipsis company-name name-blue">'+v+'</span></div><div class="belong-yewuy"><label>所属业务员：</label>'+b+'</div><button type="button" class="btn btn-primary btn-lg btn-block btn-privateCust">添加到私海</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 7:userimg='<i class="pub-icon sender2-icon"></i>',i='<ul><li data-id="'+t[n].id+'" data-customer="'+t[n].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender2-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[n].visitingCard.customerStatusColour+';">'+g+'</span><span class="ellipsis company-name name-blue">'+v+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[n].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-default btn-lg btn-block btn-blockDetail btn-gray" disabled>查看联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go" disabled>往来邮件</button></div></div></li></ul>';break;case 8:userimg='<i class="pub-icon sender2-icon"></i>',i='<ul><li data-id="'+t[n].id+'" data-customer="'+t[n].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender2-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[n].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[n].visitingCard.customerStatusColour+';">'+g+'</span><span class="ellipsis company-name name-blue">'+v+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[n].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-default btn-lg btn-block btn-gray btn-blockAdd" disabled>添加联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go" disabled>往来邮件</button></div></div></li></ul>'}}1==s&&(u='<i class="pub-icon list-fujian-icon"></i>');var f='<div class="sender-condition-style">'+i+"</div>",h="";if(null!=t[n].tags&&""!=t[n].tags)if(t[n].tags.length>2){for(var y=0;y<2;y++)h+='<li class="mark-p" style="margin-top:5px;margin-right:5px;color:#ff7200;border:1px solid #ff7200;border-radius:8px;" data-id="'+t[n].tags[y].id+'"><span class="mark ellipsis">'+t[n].tags[y].name+'</span><i class="pub-icon close-icon"></i></li>';$("#inboxContent>.marks-group").append(h)}else{for(var y=0;y<t[n].tags.length;y++)h+='<li class="mark-p" style="margin-top:5px;margin-right:5px;color:#ff7200;border:1px solid #ff7200;border-radius:8px;" data-id="'+t[n].tags[y].id+'"><span class="mark ellipsis">'+t[n].tags[y].name+'</span><i class="pub-icon close-icon"></i></li>';$("#inboxContent>.marks-group").append(h)}var C=t[n].content;C&&(C=t[n].content.replace(/</,"&lt;")),C.length>28&&t[n].subject.length>28&&(t[n].subject=t[n].subject.substring(0,14)+"...",C=C.substring(0,14)+"...");var k='<a class="email-content-info ellipsis" href="pop-email-detail.html?v='+window.ver+'" data-maintab><span style="max-width:665px;"class="pull-left">'+u+t[n].subject+'<span style="margin:0 5px;">-</span></span><span class="list-content ellipsis">'+C+'</span></a><ul class="marks-group" style="display: inline-block;overflow: hidden;height: 25px;margin:0;float:right">'+h+"</ul>",x="";x=1==r?'<i class="pub-icon star stared-icon" data-id="'+t[n].id+'" data-value="1"></i>':'<i class="pub-icon star star-icon" data-id="'+t[n].id+'" data-value="0"></i>',t[n].visitingCard.title.length>28&&(t[n].visitingCard.title=t[n].visitingCard.title.substring(0,27)+"..."),1==c&&null!=t[n].emailAddress&&""!=t[n].emailAddress?e+='<tr isRead="1">                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[n].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[n].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis">'+t[n].visitingCard.title+"</span></div>"+f+'</td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+o+"</div></td>                                        <td>"+x+"</td>                                    </tr>":0==c&&null!=t[n].emailAddress&&""!=t[n].emailAddress?e+='<tr isRead="0" class="noRead" style="font-weight:700;">                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[n].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[n].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis">'+t[n].visitingCard.title+"</span></div>"+f+'</td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+o+"</div></td>                                        <td>"+x+"</td>                                    </tr>":1==c&&null==t[n].emailAddress&&""==t[n].emailAddress?e+='<tr isRead="1">                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[n].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[n].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis">匿名用户</span></div></td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+o+"</div></td>                                        <td>"+x+"</td>                                    </tr>":0==c&&null==t[n].emailAddress&&""==t[n].emailAddress&&(e+='<tr isRead="0" class="noRead" style="font-weight:700;">                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[n].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[n].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis">匿名用户</span></div></td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+o+"</div></td>                                        <td>"+x+"</td>                                    </tr>")}else e='<tr><td colspan="6" style="text-align: center;">还没有收到邮件</td></tr>';$(".page_info>table>tbody").empty().append(e);var a=a,w=Math.ceil(a/l.pageSize);$.Page({total:a,_class:".page",nowNum:l.currentPage,allNum:w,callback:function(t,a){l.currentPage=t;var e=$(".activeFilter").attr("data-index");if("3"==e)if("none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,null,1);else{var i=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(i,null,null,null,null,1)}else if("1"==e)if("none"==$("#btn-underling-pop").css("display"))d.filter(null,null,1);else{var i=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(i,null,null,1)}else if("2"==e)if("none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,1);else{var i=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(i,null,null,null,1)}else if("4"==e)if("none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,null,null,1);else{var i=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(i,null,null,null,null,null,1)}else if("0"==e){var n=$(".activeFilter").find(".groupLi").attr("data-id");d.filter(null,n)}else if("5"==e){var n=$(".activeFilter").find(".labelLi").attr("data-id");d.filter(null,n)}else if($("#sx-condition").is(":hidden"))if("none"==$("#btn-underling-pop").css("display"))d.filter();else{var i=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(i)}else{if("none"==$("#btn-underling-pop").css("display"))var s={filtrate:1};else var i=$("#btn-underling-pop").attr("data-id"),s={filtrate:1,id:i};s.addressType!=-1||""!=s.emailTime||""!=s.keyword||""!=s.attachmentName?d.filter(s):d.filter()}}})},inboxMenu:function(){$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/menus",type:"GET",success:function(t){if(!t.success)return void $.unLogin(t);for(var a=t.data,e=a.emailGroup,i=a.tags,n='<li data-id="" data-accountId="">全部分组</li>',s="",l="("+a.unreadEmailCount+")",d="("+a.starEmailCount+")",o="("+a.deletedEmailCount+")",r="("+a.spamEmailCount+")",c=0;c<e.length;c++)n+='<li data-id="'+e[c].id+'" data-accountId="'+e[c].name+'">'+e[c].name+"</li>";for(var c=0;c<i.length;c++){var u=i[c].name;u=$.autoAddEllipsis(u,8),s+='<li data-id="'+i[c].id+'" data-accountId="'+i[c].name+'">'+u+"</li>"}$("#emailFilter>li>a>span.wdNum").empty().append(l),$("#emailFilter>li>a>span.starNum").empty().append(d),$("#emailFilter>li>a>span.delNum").empty().append(o),$("#emailFilter>li>a>span.rubNum").empty().append(r),$("#emailFilter>li>.group-list").empty().append(n),$("#groupsModal>.mbody>.group-list").empty().append(n),$("#emailFilter>li>.label-list").empty().append(s),$("#tagsModal>.mbody>.label-list").empty().append(s),e.length<1&&$("#emailFilter>li>.group-list").remove(),i.length<1&&$("#emailFilter>li>.label-list").remove()}})},starChange:function(t,a){var e={ids:[t],value:a},i="data="+JSON.stringify(e);$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/star",type:"POST",data:i,success:function(t){return t.success?void d.inboxMenu():void $.unLogin(t)}})},deleteEmail:function(t){var a=Base.sitUrl+"/api/email/inbox/v1/delete",e=$(".activeFilter").attr("data-index");"3"==e&&(a=Base.sitUrl+"/api/email/inbox/v1/delete/force");var i={ids:t},n="data="+JSON.stringify(i);$.ajax({url:a,type:"POST",data:n,beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);var a=$(".activeFilter").attr("data-index");if("3"==a)d.filter(null,null,null,null,1);else if("1"==a)d.filter(null,null,1);else if("2"==a)d.filter(null,null,null,1);else if("4"==a)d.filter(null,null,null,null,null,1);else if("0"==a){$(".activeFilter").find(".groupLi").attr("data-id");d.filter(null,id)}else if("5"==a){$(".activeFilter").find(".labelLi").attr("data-id");d.filter(null,id)}else d.filter()}})},distributionGroup:function(t,a){var e={ids:t,value:a},i="data="+JSON.stringify(e);$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/group",type:"POST",data:i,success:function(t){if(!t.success)return void $.unLogin(t)}})},distributionTag:function(t,a,e){var i={ids:t,value:a,name:e},n="data="+JSON.stringify(i);$.ajax({url:Base.sitUrl+"/api/email/v1/tag/add",type:"POST",data:n,beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){return t.success?void $.reHtml():void $.unLogin(t)}})},deleteTag:function(t){var a={id:t},e="data="+JSON.stringify(a);$.ajax({url:Base.sitUrl+"/api/email/v1/tag/delete",type:"POST",data:e,success:function(t){if(!t.success)return void $.unLogin(t)}})},isRead:function(t,a){var e={ids:[t],value:a},i="data="+JSON.stringify(e);
$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/read",type:"POST",data:i,success:function(t){if(!t.success)return void $.unLogin(t)}})},getAllChecked:function(){var t={ids:[],dist:"",del:"",arry:[]};return $("input[name=batch]:checked").each(function(){var a=$(this).attr("data-id");t.ids.push(parseInt(a)),t.dist+=$(this).attr("data-dist")+";",t.del+=$(this).attr("data-del")+";"}),t}};d.filter(),d.inboxMenu(),$.reInboxMenu=function(t){if(t)var a="POST";else var a="GET";var e={id:t};return $.ajax({url:Base.sitUrl+"/api/email/inbox/v1/menus",type:a,data:{data:JSON.stringify(e)},success:function(t){if(!t.success)return void $.unLogin(t);for(var a=t.data,e=a.emailGroup,i=a.tags,n='<li data-id="" data-accountId="">全部分组</li>',s="",l="("+a.unreadEmailCount+")",d="("+a.starEmailCount+")",o="("+a.deletedEmailCount+")",r="("+a.spamEmailCount+")",c=0;c<e.length;c++)n+='<li data-id="'+e[c].id+'" data-accountId="'+e[c].name+'">'+e[c].name+"</li>";for(var c=0;c<i.length;c++){var u=i[c].name;u=$.autoAddEllipsis(u,8),s+='<li data-id="'+i[c].id+'" data-accountId="'+i[c].name+'">'+u+"</li>"}$("#emailFilter>li>a>span.wdNum").empty().append(l),$("#emailFilter>li>a>span.starNum").empty().append(d),$("#emailFilter>li>a>span.delNum").empty().append(o),$("#emailFilter>li>a>span.rubNum").empty().append(r),$("#emailFilter>li>.group-list").empty().append(n),$("#groupsModal>.mbody>.group-list").empty().append(n),$("#emailFilter>li>.label-list").empty().append(s),$("#tagsModal>.mbody>.label-list").empty().append(s),e.length<1&&$("#emailFilter>li>.group-list").remove(),i.length<1&&$("#emailFilter>li>.label-list").remove()}}),e},$("#btn-underling").on("click",function(){$.ajax({url:Base.sitUrl+"/api/customer/v1/underling/customer",type:"GET",success:function(t){for(var a=t.data,e="",i=0;i<a.length;i++)e+='<li data-id="'+a[i].id+'">'+a[i].name+"</li>";$("#myModal .modal-body>ul").empty().append(e)}})}),$("#myModal .modal-body>ul").on("click",">li",function(){$(this).addClass("active").siblings("li").removeClass("active");var t=$("#myModal .modal-body>ul>li.active").attr("data-id"),a=$("#myModal .modal-body>ul>li.active").text();$("#btn-underling").attr({"data-toggle":"","data-target":"",id:"btn-underling-active"}),$("#btn-underling-pop").text(a).attr("data-id",t).show(),$("#underling-close").click(),$.reInboxMenu(t),$.reHtml(t)}),$("body").on("click","#btn-underling-active",function(){window.location.reload()}),$.reHtml=function(t,a,e,i,n,s,o,r,c,u){if(t)var p={group:e||0,unread:i||0,star:n||0,deleted:s||0,spam:o||0,tag:r||"",subject:c||"",content:u||"",currentPage:l.currentPage,pageSize:l.pageSize,id:t};else var p={group:e||0,unread:i||0,star:n||0,deleted:s||0,spam:o||0,tag:r||"",subject:c||"",content:u||"",currentPage:l.currentPage,pageSize:l.pageSize};$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/search",data:{data:JSON.stringify(p)},type:"POST",success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results;d.sortName=a,d.total=t.data.totalItem,d.shujuzhanshi(a,d.total)}})}})});