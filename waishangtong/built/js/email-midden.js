require(["common"],function(){require(["maintab","blockUI","datetimepickerCN"],function(e){function a(e){var a=c;e&&$.extend(a,e),$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/search",data:{data:JSON.stringify(a)},type:"POST",beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data.results;i(a,e.data)}})}function i(e,i){for(var s="sender4-icon",t="",n=0;n<e.length;n++){var l=e[n].sendTime.substring(0,e[n].sendTime.lastIndexOf(".")),o=e[n].visitingCard.status;1==o||2==o?s="sender4-icon":3==o||4==o?s="sender1-icon":5==o||6==o?s="sender3-icon":7!=o&&8!=o||(s="sender2-icon");var r="";if(null!=e[n].tags&&""!=e[n].tags){var d=e[n].tags.length;d=d>2?2:d;for(var u=0;u<d;u++)r+='<span class="tag-item" data-id="'+e[n].tags[u].id+'">                            <span class="tag-name ellipsis">'+e[n].tags[u].name+'</span>                            <i class="pub-icon tag-close"></i>                            </span>'}t+='<li class="list-item" data-id="'+e[n].id+'">                <div class="email-check"><input name="check" type="checkbox" /></div>                <div class="addressee"><i class="pub-icon '+s+'"></i>                <span class="addressee-name ellipsis">'+e[n].visitingCard.title+'</span></div>                <div class="email">                <span class="email-subject ellipsis">'+e[n].subject+'</span>                <span class="email-content ellipsis">- '+e[n].content+'</span>                <div class="tags-list">'+r+'</div></div>                <div class="time">'+l+'</div>                <div class="clear"></div>                </li>'}$(".email-list").empty().append(t),$(".email-list").find(":checkbox").uniform();var p=i.totalItem,h=Math.ceil(p/c.pageSize);$.Page({total:p,_class:".page",nowNum:c.currentPage,allNum:h,callback:function(e,i){c.currentPage=e,a()}})}function s(e,a){$.ajax({url:Base.sitUrl+"/api/email/v1/tag/delete",type:"POST",data:"data="+JSON.stringify({id:e}),success:function(e){return e.success?void(a&&"function"==typeof a&&a()):void $.unLogin(e)}})}function t(e){var i="data="+JSON.stringify({ids:e});$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/delete",type:"POST",data:i,beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){return e.success?void a():void $.unLogin(e)}})}e.init(),jQuery().datetimepicker&&$(".emailTime").datetimepicker({format:"yyyy-mm-dd hh:ii",todayBtn:!1,language:"zh-CN",startDate:new Date,pickerPosition:"bottom",autoclose:!0});var c={homepage:1,lastpage:null,currentPage:1,pageSize:20,group:0,unread:0,star:0,deleted:0,spam:1,tag:"",subject:"",content:""};$(".close-side-handle").click(function(){$(".side-handle").css("left","-101%")}),$("input[name=allCheck]").change(function(){$(this).prop("checked")?($(".side-handle").css("left",0),$("input[name=check]").prop("checked",!0).parent().addClass("checked")):($(".side-handle").css("left","-101%"),$("input[name=check]").prop("checked",!1).parent().removeClass("checked"))}),$(".email-list").on("click","input[name=check]",function(e){e.stopPropagation();var a=$(this);if(a.prop("checked"))$(".side-handle").css("left",0),a.parent().addClass("checked"),a.closest("li").addClass("active");else{a.parent().removeClass("checked");var i=$(".email-list input[name=check]:checked");i.length<=0&&$(".side-handle").css("left","-101%"),a.closest("li").removeClass("active")}}),$(".email-list").on("click",".list-item",function(){e.showTab(Base.url+"/html/pop-email-detail.html?id="+$(this).attr("data-id")+"&v="+window.ver,"详情")}),$(".email-list").on("click",".tag-close",function(e){$.EventFn(e);var a=this,i=$(this).parent().attr("data-id");s(i,function(){$(a).parent().remove()})}),$("#btn-del").click(function(){var e=$("input[type=checkbox][name=check]:checked"),a=[];if(e.length>0){for(var i=0;i<e.length;i++)a.push(e.eq(i).closest(".list-item").attr("data-id"));t(a)}else $.Alert("请至少勾选一封邮件！")}),$("#quikSearch").on("input",function(){var e=$(this);""!=e.val()?e.next().removeClass("ico-search").addClass("ico-search-clear"):e.next().addClass("ico-search").removeClass("ico-search-clear")}),$("#quikSearch").keyup(function(e){if(13==e.keyCode&&""!=$(this).val()){var i={filtrate:1,keyword:$(this).val(),attachmentName:""};a(i)}}),$(".search").on("click",".ico-search-clear",function(){$("#quikSearch").val(""),$(this).addClass("ico-search").removeClass("ico-search-clear")}),a()})});