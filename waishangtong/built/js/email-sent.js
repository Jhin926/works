require(["common"],function(){require(["maintab","blockUI","datetimepickerCN"],function(t){function a(t){return null==t||void 0==t||""==t?"":t}function e(){$(".modals").removeClass("active"),$("#assigns").val(""),$("#btn-assign").hide()}function i(){$("#tableSort").find("input[name='batch']").each(function(){$(this).attr("checked",!1),$(this).parent("span").removeClass("checked")})}var n=top.funcList;$("[data-code]").each(function(){for(var t=0;t<n.length;t++)n[t].code==$(this).attr("data-code")&&$(this).removeClass("none")}),t.init(),$(".r-titles").hide(),jQuery().datetimepicker&&$(".datetime-picker").datetimepicker({language:"zh-CN",todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,format:"yyyy-mm-dd",bootcssVer:3});var s=$("#filterModal"),l={};s.on("click","#reset",function(t){$("#keyword").val(""),$("#addresser").val(""),$("#recipient").val("");for(var a=$("#attachment input:radio").parent(),e=0;e<a.length;e++)a.eq(e).removeClass("checked");$("#proDateBeg").val(""),$("#proDateEnd").val("")}),s.on("click","#screen",function(t){o.currentPage=1;var a=$("#keyword"),e=$("#addresser"),i=$("#recipient"),n=$("#proDateBeg"),s=$("#proDateEnd"),r={};""!=a.val()&&""!=$.trim(a.val())&&(r.keyword=a.val()),""!=e.val()&&""!=$.trim(e.val())&&(r.sender=e.val()),""!=i.val()&&""!=$.trim(i.val())&&(r.receiver=i.val()),""!=n.val()&&""!=$.trim(n.val())&&(r.startDate=n.val()),""!=s.val()&&""!=$.trim(s.val())&&(r.endDate=s.val()),r.hasAttachment=-1;for(var c=$("#attachment input:radio").parent(),u=0;u<c.length;u++)c.eq(u).hasClass("checked")&&(r.hasAttachment=u-1);r.filtrate=1,l=r,d.filter(l),$("#filterModal").modal("hide")}),$("#addEmail").click(function(){$("#mainIframe",parent.document).attr("src","./pop-email-new.html?&v="+window.ver)}),$(".page_info").on("click","tbody>tr .btn-privateCust",function(t){$.EventFn(t);var a=$(this).closest("tr").find("input[name=batch]").attr("data-id"),e={id:a},i=$(this);$.ajax({url:Base.sitUrl+"/api/customer/v1/into/private/seas",type:"POST",dataType:"json",data:{data:JSON.stringify(e)},success:function(t){i.text("查看客户"),i.addClass("company-name").removeClass("btn-privateCust")}})}),$(".page_info").on("click","tbody>tr .btn-privateCont",function(t){$.EventFn(t);var a=$(this).closest("tr").find("input[name=batch]").attr("data-id"),e={id:a},i=$(this);$.ajax({url:Base.sitUrl+"/api/customer/contacts/v1/into/private/seas",type:"POST",dataType:"json",data:{data:JSON.stringify(e)},success:function(t){i.text("查看联系人"),i.addClass("btn-blockDetail").removeClass("btn-privateCont")}})}),$(".page_info").on("click","tbody>tr .xiegenjin",function(a){$.EventFn(a);var e=$(this).closest("tr").find("input[name=batch]").attr("data-cont");t.showTab(Base.url+"/html/pop-upload.html?id="+e+"&v="+window.ver,"写跟进")}),$(".page_info").on("click",".newtongxunlu",function(a){$.EventFn(a);var e=$(this).parents(".sender-condition").find(".sender-condition-name").text();t.showTab(Base.url+"/html/pop-statistics-new.html?name="+e+"&v="+window.ver,"新建通讯录")}),$(".page_info").on("click",".tongxunlu",function(a){$.EventFn(a);$(this).closest("tr").find("input[name=batch]").attr("data-id");t.showTab(Base.url+"/html/email-statistics.html?&v="+window.ver,"通讯录")}),$(".page_info").on("click","tbody>tr .fayoujian",function(t){$.EventFn(t);var a=$(this).closest("tr").find("input[name=batch]").attr("data-id");$("#mainIframe",parent.document).attr("src",Base.url+"/html/pop-email-newOut.html?type=0&id="+a+"&v="+window.ver)}),$(".page_info").on("click","tbody>tr .come-go",function(a){$.EventFn(a);var e=$(this).parents("td").attr("data-email");t.showTab(Base.url+"/html/pop-come-go-emailOut.html?email="+e+"&v="+window.ver,"往来邮件")}),$(".page_info").on("click",".sender-condition",function(t){$.EventFn(t)}),$(".page_info").on("click","tbody>tr",function(a){$.EventFn(a);var e=$(this).find("input[name=batch]").attr("data-id"),i=$(this).find(".inboxContent").find("a").text(),n=$(this).attr("data-type");$.GetLength(i)>10&&(i=$.autoAddEllipsis(i,8)),"000"==n?t.showTab(Base.url+"/html/pop-email-newOut.html?type=5&id="+e+"&v="+window.ver,i):t.showTab(Base.url+"/html/pop-email-detailOut.html?id="+e+"&uri=/api/email/outbox/v1/detail&v="+window.ver,i)}),$(".page_info").on("click",".btn-blockAdd",function(a){$.EventFn(a);var e=$(this).parents(".sender-condition").find(".sender-condition-name").text();t.showTab(Base.url+"/html/pop-contacts-add.html?name="+e+"&v="+window.ver,"添加联系人")}),$(".page_info").on("click",".btn-blockDetail",function(a){$.EventFn(a);var e=$(this).parents("li").attr("data-cont");t.showTab(Base.url+"/html/pop-relation-detail.html?id="+e+"&v="+window.ver,"联系人详情")}),$(".page_info").on("click",".company-name",function(a){$.EventFn(a);var e=$(this).parents("li").attr("data-customer");t.showTab(Base.url+"/html/pop-customer-detail.html?id="+e+"&v="+window.ver,"客户详情")}),$(".page_info").on("click",".btn-newStatistics",function(a){$.EventFn(a);$(this).parents("li").attr("data-customer");t.showTab(Base.url+"/html/pop-statistics-new.html?id=","添加通讯录")}),$(".page_info").on("click",".btn-privateCont",function(t){$.EventFn(t);var a=$(this).parents("li").attr("data-customer"),e={id:a};$.ajax({url:Base.sitUrl+"/api/customer/contacts/v1/into/private/seas",type:"POST",dataType:"json",data:{data:JSON.stringify(e)},success:function(t){t.success||$.unLogin(t)}})}),$(".page_info").on("click",".btn-privateCust",function(t){$.EventFn(t);var a=$(this).parents("li").attr("data-customer"),e={id:a};$.ajax({url:Base.sitUrl+"/api/customer/v1/into/private/seas",type:"POST",dataType:"json",data:{data:JSON.stringify(e)},success:function(t){if(!t.success)return void $.unLogin(t)}})}),$("#batchClose").on("mouseenter",function(){$(this).addClass("s-updownBg s-dels4").removeClass("fa fa-times")}),$("#batchClose").on("mouseleave",function(){$(this).addClass("fa fa-times").removeClass("s-updownBg s-dels4")}),$(".m_batch").on("click","#btn-groups",function(){$("#groupsModal").addClass("active").siblings(".modals").removeClass("active")}),$(".m_batch").on("click","#groupsModal>.mbody>.group-list>li",function(t){$.EventFn(t);var a=d.getAllChecked().ids,i=$(this).attr("data-id");d.distributionGroup(a,i),e(),$(this).parent(".mhead").parent(".modals").removeClass("active"),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$("#btn-tags").on("click",function(){$("#tagsModal").addClass("active").css("left",$(this).position().left).siblings(".modals").removeClass("active")}),$(".m_batch").on("click","#tagsModal>.mbody>.label-list>li",function(t){$.EventFn(t);var a=d.getAllChecked().ids,i=$(this).attr("data-id"),n=$(this).attr("data-accountId");d.distributionTag(a,i,n),e(),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$(".table").on("mouseenter",".mark-p",function(t){$.EventFn(t),$(this).find(".close-icon").show();var a=$(this).children(".close-icon");"none"==a.css("display")&&a.show()}),$(".table").on("mouseleave",".mark-p",function(t){$.EventFn(t),$(this).find(".close-icon").hide();var a=$(this).children(".close-icon");"block"==a.css("display")&&a.hide()}),$(".table").on("click",".close-icon",function(t){$.EventFn(t);var a=$(this).parent(),e=$(this).closest("li").attr("data-id"),i={id:e};$.ajax({url:Base.sitUrl+"/api/email/v1/tag/delete",type:"POST",dataType:"json",data:{data:JSON.stringify(i)},success:function(t){return t.success?void a.remove():void $.unLogin(t)}})}),$(".m_batch").on("click","#btn-dels",function(t){$.EventFn(t),$.Confirm("确认删除？","",function(){var t=d.getAllChecked().ids;d.deleteEmail(t),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})})}),$(".m_batch").on("click",".mclose",function(t){$.EventFn(t),e(),$(this).parent(".mhead").parent(".modals").removeClass("active"),i(),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$("#delsModal").on("click","#btn-del-no",function(t){$.EventFn(t);d.getAllChecked().ids;i(),$(".m_batch").stop().animate({left:"-100%"},function(){$(this).removeClass("active")})}),$(document).on("click",function(t){$.EventFn(t),$(this).find(".new-built-task").hide()}),$(".page_info").on("click",".renwuShow>.new-built-task>.btn-group>.btn-cancel",function(t){$.EventFn(t);var a=$(this).closest(".new-built-task");"block"==a.css("display")&&a.hide()}),$(".page_info").on("click",".renwuShow>.new-built-task>.btn-group>.btn-sure",function(t){$.EventFn(t);var a=$(this).closest(".new-built-task"),e=a.children(".new-built-task-c").find("textarea").val(),i=a.children(".new-built-task-time").find("input").val(),n=a.parent(".renwuShow").children("i").attr("data-task"),s=a.parents("tr").find("td:first-child").find("input[type=checkbox]").attr("data-id");null!=i&&""!=i&&null!=e&&""!=e?(n=1,d.creatTask(null,null,e,null,null,null,i,s),"block"==a.css("display")&&a.hide(),a.parent(".renwuShow").children(".pub-icon").removeClass("task-icon").addClass("tasked-icon")):confirm("请输入任务时间或内容！")}),$(".page_info").on("mouseenter",".sender-condition-td",function(t){$.EventFn(t),$(this).find(".sender-condition-style").show()}),$(".page_info").on("mouseleave",".sender-condition-td",function(t){$.EventFn(t),$(this).children(".sender-condition-style").hide()}),$("#emailFilter").unbind("click").on("click",".s-up2",function(t){$.EventFn(t),$(this).addClass("s-down2").removeClass("s-up2")}),$("#emailFilter").unbind("click").on("click",".s-down2",function(t){$.EventFn(t),$(this).addClass("s-up2").removeClass("s-down2"),$(this).parents("li").find("ul").removeClass("active")}),$("#emailFilter").on("click",">li",function(t){$.EventFn(t),$("#btn-groups,#btn-tags,#btn-assigns").show(),$(this).addClass("activeFilter").siblings("li").removeClass("activeFilter");var a=$(this).index();if(a>0&&a<3){if($(this).hasClass("active"))return;$(this).addClass("active").siblings("li").removeClass("active")}else $(this).siblings("li").removeClass("active");if(0==a)d.filter();else if(1==a){var e=$(this).children("a").children("i.s-updownBg"),i=$(".group-list"),n=$(".group-list>li");e.hasClass("s-up2")?(e.removeClass("s-up2").addClass("s-down2"),i.addClass("active"),0==n.length&&d.inboxMenu(i),i.addClass("active")):(e.removeClass("s-down2").addClass("s-up2"),i.removeClass("active"))}else if(2==a)if(o.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,1);else{var s=$("#btn-underling-pop").attr("data-id");$.reHtml(s,null,null,null,1)}else if(3==a){if(o.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.caogao();else{var s=$("#btn-underling-pop").attr("data-id");$.reCaogao(s)}$("#btn-groups,#btn-tags,#btn-assigns").hide()}else if(4==a){var l=t.target,e=$(this).children("a").children("span").children("i.s-updownBg").eq(1),r=$(this).children("a")[0],c=$(this).children("ul.label-list");$(this).children(".emailcreatgroup");e[0]!=l&&r!=l||(e.hasClass("s-up2")?(e.removeClass("s-up2").addClass("s-down2"),c.addClass("active")):(e.removeClass("s-down2").addClass("s-up2"),c.removeClass("active")))}}),$("#emailFilter").on("click",".s-add",function(t){$.EventFn(t);var a=$(this);a.parents("li").find("ul").hasClass("active")?a.parents("li").find("ul").addClass("active"):a.parents("li").find("ul").removeClass("active"),a.hasClass("s-add")?($(this).find(".s-add").removeClass("s-add").addClass("s-close"),$(this).parents("li").find(".emailcreatgroup").addClass("active"),a.addClass("s-close").removeClass("s-add")):($(this).find(".s-close").removeClass("s-close").addClass("s-add"),$(this).parents("li").find(".emailcreatgroup").removeClass("active"),a.addClass("s-add").removeClass("s-close"))}),$("#emailFilter").on("click",".s-close",function(t){$.EventFn(t);var a=$(this);a.parents("li").find("ul").hasClass("active")?a.parents("li").find("ul").addClass("active"):a.parents("li").find("ul").removeClass("active"),a.hasClass("s-add")?($(this).find(".s-add").removeClass("s-add").addClass("s-close"),$(this).parents("li").find(".emailcreatgroup").addClass("active"),a.addClass("s-close").removeClass("s-add")):($(this).find(".s-close").removeClass("s-close").addClass("s-add"),$(this).parents("li").find(".emailcreatgroup").removeClass("active"),a.addClass("s-add").removeClass("s-close"))}),$("#emailFilter").on("click",".group-list>li",function(t){$.EventFn(t),$(this).addClass("groupLi").siblings().removeClass("groupLi");var a=$(this).attr("data-id");if(o.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.filter(null,a);else{var e=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(e,null,a)}}),$("#emailFilter").on("click",".label-list>li",function(t){$.EventFn(t),$(this).addClass("labelLi").siblings("li").removeClass("labelLi");var a=$(this).attr("data-id");if(o.currentPage=1,"none"==$("#btn-underling-pop").css("display"))d.filter(null,null,null,null,null,null,null,a);else{var e=$("#myModal .modal-body>ul>li.active").attr("data-id");$.reHtml(e,null,null,null,null,null,null,a)}}),$(".page_info").on("click",".star",function(t){$.EventFn(t),$(this).hasClass("star-icon")?($(this).removeClass("star-icon").addClass("stared-icon"),listVal=$(this).attr("data-value"),0==listVal&&(listVal=1),listId=$(this).attr("data-id"),d.starChange(listId,1)):($(this).removeClass("stared-icon").addClass("star-icon"),listVal=$(this).attr("data-value"),1==listVal&&(listVal=0),listId=$(this).attr("data-id"),d.starChange($(this).attr("data-id"),0))}),$(".page_info").on("click","tbody>tr",function(t){$.EventFn(t);var a=$(this).find("input[name=batch]").attr("data-id"),e=$(this).attr("isRead");0==e&&(d.isRead(a,1),$(this).attr("isRead","1"),$(this).css("font-weight","400"))}),$(".page_info").on("click",">table>thead>tr>th",function(t){$.EventFn(t);var a=[];if("sender"==$(this).attr("id"))a=d.sortName.sort(function(t,a){return t.emailAddress.charCodeAt()-a.emailAddress.charCodeAt()}),d.shujuzhanshi(a,d.total);else{if("sortTime"!=$(this).attr("id"))return;"0"==$(this).attr("data-type")?(a=d.sortName.sort(function(t,a){return new Date(t.sendTime).getTime()-new Date(a.sendTime).getTime()}),$(this).attr("data-type","1"),d.shujuzhanshi(a,d.total)):(a=d.sortName.sort(function(t,a){return new Date(a.sendTime).getTime()-new Date(t.sendTime).getTime()}),$(this).attr("data-type","0"),d.shujuzhanshi(a,d.total))}}),$(".page-content").on("keyup","#inputQuick",function(t){if($.EventFn(t),"none"==$("#btn-underling-pop").css("display"))var a={filtrate:1,keyword:$("#inputQuick").val()||""};else var e=$("#btn-underling-pop").attr("data-id"),a={filtrate:1,keyword:$("#inputQuick").val()||"",id:e};13==event.keyCode&&(a.addressType!=-1||""!=a.emailTime||""!=a.keyword||""!=a.attachmentName?d.filter(a):d.filter())});var o={homepage:1,lastpage:null,currentPage:1,pageSize:20},d={lastpage:null,currentPage:1,sortName:[],total:0,page:{pageSize:o.pageSize,currentPage:o.currentPage},filter:function(t,a,e,i,n,s,l,r,c,u){var p={group:a||0,unread:e||0,star:i||0,deleted:n||0,spam:s||0,draft:l||0,tag:r||"",subject:c||"",content:u||"",currentPage:o.currentPage,pageSize:o.pageSize};t&&$.extend(p,t),$.ajax({data:{data:JSON.stringify(p)},type:"POST",url:Base.sitUrl+"/api/email/outbox/v1/search",beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results;d.sortName=a,d.total=t.data.totalItem,d.shujuzhanshi(a,d.total)}})},caogao:function(t,a,e,i,n,s,l,r,c,u){var p={group:a||0,unread:e||0,star:i||0,deleted:n||0,spam:s||0,draft:l||0,tag:r||"",subject:c||"",content:u||"",currentPage:o.currentPage,pageSize:o.pageSize};t&&(p.filtrate=t.filtrate,p.addressType=t.addressType,p.adress=t.adress,p.keyword=t.keyword,p.attachmentName=t.attachmentName,p.emailTimeComparator=t.emailTimeComparator,p.emailTime=t.emailTime),$.ajax({data:{data:JSON.stringify(p)},type:"POST",url:Base.sitUrl+"/api/email/draft/v1/search",beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results,e="";if(0==a.length)return e='<tr><td colspan="6" style="text-align: center;">还没有收到邮件</td></tr>',$(".page_info>table>tbody").empty(),void $(".page_info>table>tbody").append(e);d.sortName=a,d.total=t.data.totalItem;var i="000";d.shujuzhanshi(a,d.total,i)}})},shujuzhanshi:function(t,e,i){var n="",s="";if(t.length<=0)n='<tr><td colspan="6" style="text-align: center;">还没有收到邮件</td></tr>';else for(var l=0;l<t.length;l++){var r=t[l].hasAttachment,c=$.dateObj(new Date(t[l].sendTime).getTime())._getDatetime(),u=t[l].isStar,p=t[l].isRead,m="";if(null!=t[l].visitingCard&&""!=t[l].visitingCard){var b=t[l].visitingCard.status,v=t[l].visitingCard.isHighSeas,g=t[l].visitingCard.customerName;1==r&&(m='<i class="pub-icon list-fujian-icon"></i>'),userimg="";var f="";if(1==v&&(f="<span>公海</span>"),null!==t[l].visitingCard.customerStatusName)var h=t[l].visitingCard.customerStatusName.substring(0,1);else var h="";switch(b){case 1:userimg='<i class="pub-icon sender4-icon"></i>',s='<ul><li data-id="'+t[l].id+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockAdd">添加为联系人</button><div class="btn-group condition-cz-btn" role="group" style="margin-left:-118px;"><button type="button" class="btn btn-default newtongxunlu">添加通讯录</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 2:userimg='<i class="pub-icon sender4-icon"></i>',s='<ul><li data-id="'+t[l].id+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockAdd">添加为联系人</button><div class="btn-group condition-cz-btn" role="group" style="margin-left:-118px;"><button type="button" class="btn btn-default tongxunlu">通讯录好友</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 3:userimg='<i class="pub-icon sender1-icon"></i>',s='<ul><li data-id="'+t[l].id+'" data-customer="'+t[l].visitingCard.customerId+'" data-cont="'+t[l].visitingCard.customerContactsId+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[l].visitingCard.customerStatusColour+';">'+h+'</span><span class="ellipsis company-name name-blue">'+g+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[l].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockDetail">查看联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin">写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 4:userimg='<i class="pub-icon sender1-icon"></i>',s='<ul><li data-id="'+t[l].id+'" data-customer="'+t[l].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[l].visitingCard.customerStatusColour+';">'+h+'</span><span class="ellipsis company-name name-blue">'+g+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[l].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-primary btn-lg btn-block btn-blockAdd">添加为联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 5:userimg='<i class="pub-icon sender3-icon"></i>',s='<ul><li data-id="'+t[l].id+'" data-customer="'+t[l].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender3-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[l].visitingCard.customerStatusColour+';">'+h+'</span><span class="ellipsis company-name name-blue">'+g+'</span></div><div class="belong-yewuy"><label>所属业务员：</label>'+f+'</div><button type="button" class="btn btn-primary btn-lg btn-block btn-privateCont">添加到私海</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 6:userimg='<i class="pub-icon sender3-icon"></i>',s='<ul><li data-id="'+t[l].id+'" data-customer="'+t[l].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender3-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[l].visitingCard.customerStatusColour+';">'+h+'</span><span class="ellipsis company-name name-blue">'+g+'</span></div><div class="belong-yewuy"><label>所属业务员：</label>'+f+'</div><button type="button" class="btn btn-primary btn-lg btn-block btn-privateCust">添加到私海</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go">往来邮件</button></div></div></li></ul>';break;case 7:userimg='<i class="pub-icon sender2-icon"></i>',s='<ul><li data-id="'+t[l].id+'" data-customer="'+t[l].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender2-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[l].visitingCard.customerStatusColour+';">'+h+'</span><span class="ellipsis company-name name-blue">'+g+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[l].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-default btn-lg btn-block btn-blockDetail btn-gray" disabled>查看联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go" disabled>往来邮件</button></div></div></li></ul>';break;case 8:userimg='<i class="pub-icon sender2-icon"></i>',s='<ul><li data-id="'+t[l].id+'" data-customer="'+t[l].visitingCard.customerId+'"><div class="sender-condition"><div class="sender-condition-img"><i class="pub-icon sender2-icon" style="top:0;"></i><span class="ellipsis sender-condition-name">'+t[l].visitingCard.title+'</span></div><div class="company-info"><span class="s-status" style="background-color: '+t[l].visitingCard.customerStatusColour+';">'+h+'</span><span class="ellipsis company-name name-blue">'+g+'</span></div><div class="belong-yewuy"><label>所属业务员：</label><span>'+t[l].visitingCard.salesmanName+'</span></div><button type="button" class="btn btn-default btn-lg btn-block btn-gray btn-blockAdd" disabled>添加联系人</button><div class="btn-group condition-cz-btn" role="group"><button type="button" class="btn btn-default xiegenjin" disabled>写跟进</button><button type="button" class="btn btn-default fayoujian">发邮件</button><button type="button" class="btn btn-default come-go" disabled>往来邮件</button></div></div></li></ul>'}var y='<div class="sender-condition-style">'+s+"</div>",C="",k='<a class="email-content-info ellipsis"href="pop-email-detail.html" data-maintab><span class="pull-left">'+m+t[l].subject+'<span style="margin:0 5px;">-</span></span><span class="list-content ellipsis">'+t[l].content+'</span></a><ul class="marks-group">'+C+"</ul>",w="";if(w=1==u?'<i class="pub-icon star stared-icon" data-id="'+t[l].id+'" data-value="1"></i>':'<i class="pub-icon star star-icon" data-id="'+t[l].id+'" data-value="0"></i>',null!=t[l].tags&&""!=t[l].tags)if(t[l].tags.length>2){for(var x=0;x<2;x++)C+='<li class="mark-p" style="margin-top:5px;margin-right:5px;color:#ff7200;border:1px solid #ff7200;border-radius:8px;" data-id="'+t[l].tags[x].id+'"><span class="mark ellipsis">'+t[l].tags[x].name+'</span><i class="pub-icon close-icon"></i></li>';$("#inboxContent>.marks-group").append(C)}else{for(var x=0;x<t[l].tags.length;x++)C+='<li class="mark-p" style="margin-top:5px;margin-right:5px;color:#ff7200;border:1px solid #ff7200;border-radius:8px;" data-id="'+t[l].tags[x].id+'"><span class="mark ellipsis">'+t[l].tags[x].name+'</span><i class="pub-icon close-icon"></i></li>';$("#inboxContent>.marks-group").append(C)}var T=t[l].content;T&&(T=t[l].content.replace(/</,"&lt;")),T.length>28&&t[l].subject.length>28?(t[l].subject=t[l].subject.substring(0,14)+"...",T=T.substring(0,14)+"..."):T.length>28?T=T.substring(0,27)+"...":t[l].subject.length>28&&(t[l].subject=t[l].subject.substring(0,27)+"...");var k='<a class="email-content-info ellipsis"href="pop-email-detail.html"data-maintab><span style="max-width:665px;" class="pull-left">'+m+t[l].subject+'<span style="margin:0 5px;">-</span></span><span class="list-content ellipsis">'+T+'</span></a><ul class="marks-group" style="display: inline-block;overflow: hidden;height: 25px;margin:0;float:right">'+C+"</ul>";n+=1==p?'<tr isRead="1" data-type='+i+'>                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[l].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[l].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis">'+a(t[l].visitingCard.title)+"</span></div>"+y+'</td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+c+"</div></td>                                        <td>"+w+"</td>                                    </tr>":'<tr isRead="0" style="font-weight:700;"  data-type='+i+"data-type="+i+' class="isRead">                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[l].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[l].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis">'+a(t[l].visitingCard.title)+"</span></div>"+y+'</td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+c+"</div></td>                                        <td>"+w+"</td>                                    </tr>"}else n+=1==p?'<tr isRead="1" data-type='+i+'>                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[l].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[l].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis"></span></div>'+y+'</td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+c+"</div></td>                                        <td>"+w+"</td>                                    </tr>":'<tr isRead="0" style="font-weight:700;" data-type='+i+' class="isRead">                                        <td><div class="checker"><span><input type="checkbox" data-id="'+t[l].id+'" name="batch"></span></div></td>                                        <td class="sender-condition-td" data-email="'+t[l].emailAddress+'" data-count="0"><div class="sender">'+userimg+'<span class="span-name ellipsis"></span></div>'+y+'</td>                                        <td class="inboxContent">'+k+'</td>                                        <td><div class="inbox-time">'+c+"</div></td>                                        <td>"+w+"</td>                                    </tr>"}$(".page_info>table>tbody").empty().append(n);var e=e,S=Math.ceil(e/o.pageSize);$.Page({total:e,_class:".page",nowNum:o.currentPage,allNum:S,callback:function(t,a){o.currentPage=t;var e=$(".activeFilter").attr("data-index");if("1"==e)d.filter(null,null,null,1);else if("2"==e)d.caogao();else if("0"==e){var i=$(".activeFilter").find(".groupLi").attr("data-id");d.filter(null,i)}else if("3"==e){var i=$(".activeFilter").find(".labelLi").attr("data-id");d.filter(null,i)}else if($("#sx-condition").is(":hidden"))d.filter();else{if("none"==$("#btn-underling-pop").css("display"))var n={filtrate:1};else var s=$("#btn-underling-pop").attr("data-id"),n={filtrate:1,id:s};n.addressType!=-1||""!=n.emailTime||""!=n.keyword||""!=n.attachmentName?d.filter(n):d.filter()}}})},inboxMenu:function(){$.ajax({url:Base.sitUrl+"/api/email/outbox/v1/menus",type:"GET",success:function(t){if(!t.success)return void $.unLogin(t);for(var a=t.data,e=a.emailGroup,i=a.tags,n='<li data-id="" data-accountId="">全部分组</li>',s="",l="("+a.starEmailCount+")",o="("+a.draftEmailCount+")",d=0;d<e.length;d++)n+='<li data-id="'+e[d].id+'" data-accountId="'+e[d].name+'">'+e[d].name+"</li>";for(var d=0;d<i.length;d++){var r=i[d].name;r=$.autoAddEllipsis(r,8),s+='<li data-id="'+i[d].id+'" data-accountId="'+i[d].name+'">'+r+"</li>"}$("#emailFilter>li>a>span.starNum").empty().append(l),$("#emailFilter>li>a>span.caogaoNum").empty().append(o),$("#emailFilter>li>.group-list").empty().append(n),$("#groupsModal>.mbody>.group-list").empty().append(n),$("#emailFilter>li>.label-list").empty().append(s),$("#tagsModal>.mbody>.label-list").empty().append(s),e.length<1&&$("#emailFilter>li>.group-list").remove(),i.length<1&&$("#emailFilter>li>.label-list").remove()}})},starChange:function(t,a){var e={ids:[t],value:a},i="data="+JSON.stringify(e);$.ajax({url:Base.sitUrl+"/api/email/outbox/v1/star",type:"POST",data:i,success:function(t){return t.success?void d.inboxMenu():void $.unLogin(t)}})},deleteEmail:function(t){var a="/api/email/outbox/v1/delete",e={ids:t},i="data="+JSON.stringify(e);$.ajax({url:Base.sitUrl+a,type:"POST",data:i,beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);var a=$(".activeFilter").attr("data-index");"1"==a?d.filter(null,null,null,1):"2"==a?d.caogao():"0"==a?d.filter(null,id):"3"==a?d.filter(null,id):d.filter()}})},distributionGroup:function(t,a){var e={ids:t,value:a},i="data="+JSON.stringify(e);$.ajax({url:Base.sitUrl+"/api/email/outbox/v1/group",type:"POST",data:i,beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){return t.success?void $.reHtml():void $.unLogin(t)}})},distributionTag:function(t,a,e){var i={ids:t,value:a,name:e},n="data="+JSON.stringify(i);$.ajax({url:Base.sitUrl+"/api/email/v1/tag/add",type:"POST",data:n,beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){return t.success?void $.reHtml():void $.unLogin(t)}})},isRead:function(t,a){var e={ids:[t],value:a},i="data="+JSON.stringify(e);$.ajax({url:Base.sitUrl+"/api/email/outbox/v1/read",type:"POST",data:i,success:function(t){if(!t.success)return void $.unLogin(t);
}})},creatTask:function(t,a,e,i,n,s,l){var o={name:t,customerId:a,desc:e,createUse:i,remindTime:n,executionTimeType:s,executionTime:l,emailId:id,emailBoxType:2},d="data="+JSON.stringify(o);$.ajax({url:Base.sitUrl+"/api/task/v1/task/save",type:"POST",data:d,success:function(t){if(!t.success)return void $.unLogin(t)}})},getAllChecked:function(){var t={ids:[],dist:"",del:"",arry:[]};d.currentData;return $("input[name=batch]:checked").each(function(){var a=$(this).attr("data-id");t.ids.push(parseInt(a)),t.dist+=$(this).attr("data-dist")+";",t.del+=$(this).attr("data-del")+";"}),t}};d.filter(),d.inboxMenu(),$.reInboxMenu=function(t){if(t)var a="POST";else var a="GET";var e={id:t};$.ajax({url:Base.sitUrl+"/api/email/outbox/v1/menus",type:a,data:{data:JSON.stringify(e)},success:function(t){if(!t.success)return void $.unLogin(t);for(var a=t.data,e=a.emailGroup,i=a.tags,n='<li data-id="" data-accountId="">全部分组</li>',s="",l="("+a.starEmailCount+")",o="("+a.draftEmailCount+")",d=0;d<e.length;d++)n+='<li data-id="'+e[d].id+'" data-accountId="'+e[d].name+'">'+e[d].name+"</li>";for(var d=0;d<i.length;d++){var r=i[d].name;r=$.autoAddEllipsis(r,8),s+='<li data-id="'+i[d].id+'" data-accountId="'+i[d].name+'">'+r+"</li>"}$("#emailFilter>li>a>span.starNum").empty().append(l),$("#emailFilter>li>a>span.caogaoNum").empty().append(o),$("#emailFilter>li>.group-list").empty().append(n),$("#groupsModal>.mbody>.group-list").empty().append(n),$("#emailFilter>li>.label-list").empty().append(s),$("#tagsModal>.mbody>.label-list").empty().append(s),e.length<1&&$("#emailFilter>li>.group-list").remove(),i.length<1&&$("#emailFilter>li>.label-list").remove()}})},$("#btn-underling").on("click",function(){$.ajax({url:Base.sitUrl+"/api/customer/v1/underling/customer",type:"GET",success:function(t){for(var a=t.data,e="",i=0;i<a.length;i++)e+='<li data-id="'+a[i].id+'">'+a[i].name+"</li>";$("#myModal .modal-body>ul").empty().append(e)}})}),$("#myModal .modal-body>ul").on("click",">li",function(){$(this).addClass("active").siblings("li").removeClass("active");var t=$("#myModal .modal-body>ul>li.active").attr("data-id"),a=$("#myModal .modal-body>ul>li.active").text();$("#btn-underling").attr({"data-toggle":"","data-target":"",id:"btn-underling-active"}),$("#btn-underling-pop").text(a).attr("data-id",t).show(),$("#underling-close").click(),$.reInboxMenu(t),$.reHtml(t)}),$("body").on("click","#btn-underling-active",function(){window.location.reload()}),$.reHtml=function(t,a,e,i,n,s,l,r,c,u,p){if(t)var m={group:e||0,unread:i||0,star:n||0,deleted:s||0,spam:l||0,draft:r||0,tag:c||"",subject:u||"",content:p||"",currentPage:o.currentPage,pageSize:o.pageSize,id:t};else var m={group:e||0,unread:i||0,star:n||0,deleted:s||0,spam:l||0,draft:r||0,tag:c||"",subject:u||"",content:p||"",currentPage:o.currentPage,pageSize:o.pageSize};$.ajax({data:{data:JSON.stringify(m)},type:"POST",url:Base.sitUrl+"/api/email/outbox/v1/search",success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results,e="";return 0==a.length?(e='<tr><td colspan="6" style="text-align: center;">还没有收到邮件</td></tr>',$(".page_info>table>tbody").empty(),void $(".page_info>table>tbody").append(e)):(d.sortName=a,d.total=t.data.totalItem,void d.shujuzhanshi(a,d.total))}})},$.reCaogao=function(t,a,e,i,n,s,l,r,c,u,p){var m={group:e||0,unread:i||0,star:n||0,deleted:s||0,spam:l||0,draft:r||0,tag:c||"",subject:u||"",content:p||"",currentPage:o.currentPage,pageSize:o.pageSize,id:t};a&&(m.filtrate=a.filtrate,m.addressType=a.addressType,m.adress=a.adress,m.keyword=a.keyword,m.attachmentName=a.attachmentName,m.emailTimeComparator=a.emailTimeComparator,m.emailTime=a.emailTime),$.ajax({data:{data:JSON.stringify(m)},type:"POST",url:Base.sitUrl+"/api/email/draft/v1/search",beforeSend:function(t){$.BlockUI()},complete:function(t,a){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results,e="";if(0==a.length)return e='<tr><td colspan="6" style="text-align: center;">还没有收到邮件</td></tr>',$(".page_info>table>tbody").empty(),void $(".page_info>table>tbody").append(e);d.sortName=a,d.total=t.data.totalItem;var i="000";d.shujuzhanshi(a,d.total,i)}})}})});