require(["common"],function(){require(["maintab","blockUI","datetimepickerCN"],function(t){function e(){var t={ids:""};return $("input[name=batch]:checked").each(function(){var e=$(this).attr("data-id");t.ids+=parseInt(e)+","}),t.ids=t.ids.substring(0,t.ids.length-1),t}t.init(),jQuery().datetimepicker&&$(".emailTime").datetimepicker({format:"yyyy-mm-dd hh:ii",todayBtn:!1,language:"zh-CN",startDate:new Date,pickerPosition:"bottom",autoclose:!0}),$(".page-content").on("input","#inputQuick",function(t){$.EventFn(t);for(var e=$(this).val(),a=i.sortName,n=[],s=[],o="",l=0;l<a.length;l++)a[l].email.indexOf(e)!=-1&&n.push(a[l]);if(0==n.length)return o='<tr><td colspan="6" style="text-align: center;">还没有收到邮件</td></tr>',$(".page_info>table>tbody").empty(),void $(".page_info>table>tbody").append(o);if(n.length>0){for(var r=0;r<n.length;r++)s.push(n[r]);i.contactList(s,s.length)}}),$("#batchClose").on("mouseenter",function(){$(this).addClass("s-updownBg s-dels4").removeClass("fa fa-times")}),$("#batchClose").on("mouseleave",function(){$(this).addClass("fa fa-times").removeClass("s-updownBg s-dels4")}),$(".page_info").on("click","tbody>tr",function(e){$.EventFn(e);var a=$(this).find("input[name=batch]").attr("data-id");t.showTab(Base.url+"/html/pop-statistics-detail.html?id="+a+"&v="+window.ver,"通讯录详情")}),$(".btn-about").on("click","#btn-filter",function(t){$("#sx-condition").slideToggle("slow")}),$("#shaixuan-btn").on("click",function(t){$.EventFn(t);var e={filedName:"name",operateType:"like",filedValue:$("#contactType").val()},a={filedName:"email",operateType:"like",filedValue:$("#filter-keyword").val()},n=$("#filter-emailTimeC option:selected").val(),s={filedName:"createTime",operateType:n,filedValue:$("#filter-emailTime").val()},o={filedName:"company",operateType:"like",filedValue:$("#filter-company").val()};e=JSON.stringify(e),a=JSON.stringify(a),s=JSON.stringify(s),o=JSON.stringify(o);var l="["+e+","+a+","+o+","+s+"]";i.statistics(null,null,l)}),$(".page_info").on("click",">table>thead>tr>th",function(t){$.EventFn(t);var e=[];if("contacter"==$(this).attr("id"))"0"==$(this).attr("data-type")?(e=i.sortName.sort(function(t,e){return t.name.charCodeAt()-e.name.charCodeAt()}),$(this).attr("data-type","1"),i.contactList(e,i.total)):(e=i.sortName.sort(function(t,e){return e.name.charCodeAt()-t.name.charCodeAt()}),$(this).attr("data-type","0"),i.contactList(e,i.total));else{if("sortTime"!=$(this).attr("id"))return;"0"==$(this).attr("data-type")?(e=i.sortName.sort(function(t,e){return new Date(t.updateTime).getTime()-new Date(e.updateTime).getTime()}),$(this).attr("data-type","1"),i.contactList(e,i.total)):(e=i.sortName.sort(function(t,e){return new Date(e.updateTime).getTime()-new Date(t.updateTime).getTime()}),$(this).attr("data-type","0"),i.contactList(e,i.total))}}),$("#btn-dels").on("click",function(){$("#delsModal").show()}),$("#btn-del-ok").on("click",function(){var t=e();$.ajax({url:Base.sitUrl+"/api/addressList/v1/email/address/delete",data:{data:JSON.stringify(t)},type:"POST",dataType:"json",success:function(t){return t.success?($(".modals").removeClass("active"),$("#delsModal").hide(),$(".m_batch").stop().animate({left:"-100%"}),void i.statistics()):void $.unLogin(t,"删除失败,")}})}),$("#btn-del-no").on("click",function(){$("#delsModal").hide()});var a={homepage:1,lastpage:null,currentPage:1,pageSize:20},i={lastpage:null,currentPage:1,sortName:[],total:0,statistics:function(t,e,n){void 0==n?conditionsNew="":conditionsNew='"conditions":'+n;var s='{"currentPage":'+a.currentPage+',"pageSize":'+a.pageSize+","+conditionsNew+"}";$.ajax({url:Base.sitUrl+"/api/addressList/v1/email/address/list",data:{data:s},type:"POST",success:function(t){if(!t.success)return void $.unLogin(t);var e=t.data,a=e.results;i.sortName=a,i.total=t.data.totalItem,i.contactList(a,i.total)}})},contactList:function(t,e){var n="";if(!(t.length>0))return void(n='<tr><td colspan="6" style="text-align: center;">通讯录空空如也</td></tr>');for(var s=0;s<t.length;s++)n+='<tr>                                    <td><div class="checker"><span><input type="checkbox" data-id="'+t[s].id+'" name="batch"></span></div></td>                                    <td>                                        <div class="sender">                                            <i class="pub-icon sender1-icon"></i>                                            <span class="span-name ellipsis">'+t[s].name+'</span>                                        </div>                                    </td>                                    <td>                                        <div class="email">'+t[s].email+'</div>                                    </td>                                    <td>                                        <div class="email">'+t[s].company+'</div>                                    </td>                                    <td>                                        <div class="inbox-time">'+t[s].updateTime+"</div>                                    </td>                                </tr>";$(".page_info>table>tbody").empty().append(n);var e=e,o=Math.ceil(e/a.pageSize);$.Page({total:e,_class:".page",nowNum:a.currentPage,allNum:o,callback:function(t,e){a.currentPage=t,i.statistics()}})}};i.statistics()})});