require(["common"],function(){require(["validationLang","cookiehandle","setpassword","rsa"],function(e,i,a){var t=$("#loginFrom"),n=t.find('[name="username"]'),o=t.find('[name="password"]'),r=$("#remember");$(document).ready(function(){localStorage.getItem("_account")&&(n.val(localStorage.getItem("_account")),r.prop("checked",!0),r.parent().addClass("checked"))}),$("body").bind("keyup",function(e){13==e.keyCode&&$("#loginBtn").click()}),$(".change-img").on("click","a",function(){$(".verification-code img").attr("src",'/api/verify/v1/code?data={"codeType":1,"length":4,"bizType":1}&v='+Math.random())}),$("input[name=username]").bind("blur",function(){var e=$(this).val();$.ajax({type:"post",url:Base.sitUrl+"/api/org/v1/org/user/is/enable",data:{data:JSON.stringify({name:e})},success:function(e){if(!e.success)if(200062==e.code)$(".identifying-code").show();else if(200063==e.code)return void $(".identifying-code").hide()}})});var c;$("#loginBtn").on("click",function(){r.prop("checked")?localStorage.setItem("_account",n.val()):localStorage.clear();var e=t,a=$(this);if(null!=e.attr("method")&&"post"==e.attr("method").toLowerCase()&&0==e.find("input[name='token']").size()){var d=i.getCookie("token");null!=d&&e.append('<input type="hidden" name="token" value="'+d+'" />')}if(""==n.val()||""==o.val())return void $.Alert("账号或密码不能为空");var s=$(".verification-content").val();if("block"==$(".identifying-code").css("display")){if(""==s)return void $.Alert("请输入验证码");c=s}return a.prop("disabled",!0).text("登录中..."),$.ajax({url:Base.sitUrl+"/api/user/v1/login",type:"POST",data:{email:$.trim(n.val()),password:o.val(),code:c},cache:!1,success:function(e){if(!e.success)return 200062==e.code?($(".identifying-code").show(),void a.prop("disabled",!1).text("登录")):(200063==e.code&&$(".identifying-code").hide(),$.unLogin(e),void a.prop("disabled",!1).text("登录"));var i=e.data;localStorage.setItem("__userInfo",i.name+";"+i.id+";"+i.isMaster),location.href="./main.html"}}),!1})})});