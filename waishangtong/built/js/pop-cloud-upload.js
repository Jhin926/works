require(["common"],function(){require(["maintab","blockUI","ztree","jqform"],function(e){function a(){var e=new Array,a={view:"0"};return $.ajax({type:"POST",url:Base.sitUrl+"/api/disk/v1/folder/list/all",dataType:"json",async:!1,data:{data:JSON.stringify(a)},success:function(a){if(!a.success)return void $.Alert(a.message);for(var n=a.data,t=0;t<n.length;t++)0==n[t].type&&e.push(n[t])}}),e}function n(e,a){$("#form_file").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(n){if(!n.success)return void $.unLogin(n);var t="http://"+n.data;$("#Newfilename").val(e).attr({"data-url":t,"data-size":a})}}).submit()}function t(e){var a=!0,n=e.prop("files"),t=n[0].size;return{flag:a,name:n[0].name,size:t}}function i(e,a,n){r("[ "+getTime()+" onRename ]&nbsp;&nbsp;&nbsp;&nbsp; "+n.name)}function r(e){log||(log=$("#log")),log.append("<li class='"+className+"'>"+e+"</li>"),log.children("li").length>8&&log.get(0).removeChild(log.children("li")[0])}$.GetQueryString("userId");$("#savenewFile").on("click",function(){var e=$.fn.zTree.getZTreeObj("treeDemoAdd"),a=e.getSelectedNodes();if(""==a)var n="0";else var n=a[0].id;for(var t=$("#Newfilename").val(),i=$("#Newfilename").attr("data-size"),r=$("#Newfilename").attr("data-url"),l=i.split(","),o=r.split(","),s=t.split(","),c=new Array,d=0;d<l.length;d++){var u={pid:n,name:s[d],file:o[d],size:l[d],type:"1",shareType:"1",operateType:"0",userType:"0"};c.push(u)}var f={diskfiles:c};$.ajax({url:Base.sitUrl+"/api/disk/v1/file/save/batch",type:"POST",dataType:"json",data:{data:JSON.stringify(f)},beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){return e.success?($.DestroyPopInPop(),void parent.location.reload()):void $.unLogin(e)}})}),$("#up-files").on("change",function(e){$.EventFn(e);var a=t($(this)),i=document.getElementById("up-files").files;if(a.flag){for(var r="",l="",o=0;o<i.length;o++)r+=i[o].name+",",l+=i[o].size+",";r=r.substring(0,r.length-1),l=l.substring(0,l.length-1),n(r,l)}});var l=a(),o={view:{selectedMulti:!1},edit:{enable:!0,editNameSelectAll:!0},data:{simpleData:{enable:!0}},callback:{beforeDrag:!1}};$(document).ready(function(){for(var e=new Array,a=l,n=0;n<a.length;n++)e[n]={id:a[n].id,pId:a[n].pid,name:a[n].name,open:!0};$.fn.zTree.init($("#treeDemoAdd"),o,e)});var s=$("#navInput",parent.document).attr("data-pid"),c=$.fn.zTree.getZTreeObj("treeDemoAdd"),d=c.getNodeByParam("id",s);c.selectNode(d),o.callback.onClick=i})});