require(["common"],function(){require(["maintab","blockUI"],function(t){t.init();var i=$.GetQueryString("email");$(".come-go-email").on("click","ul>li",function(i){$.EventFn(i);var e=$(this).attr("data-id"),s=$(this).attr("isRead");$(this).attr("data-type");if(0==s){$(this).attr("isRead","1"),a.isRead(e,1),$(this).find(".dot-icon").hide()}$(this).find(".pub-icon").hasClass("go-icon")?t.showTab(Base.url+"/html/pop-email-detailOut.html?id="+e+"&uri=","邮件详情"):$(this).find(".pub-icon").hasClass("come-icon")&&t.showTab(Base.url+"/html/pop-email-detail.html?id="+e+"&uri=","邮件详情")});var e={currentPage:1,pageSize:20},a={comeGoList:function(t){var i={email:t,currentPage:e.currentPage,pageSize:e.pageSize};return $.ajax({url:Base.sitUrl+"/api/email/v1/history",data:{data:JSON.stringify(i)},type:"GET",success:function(t){if(!t.success)return void $.unLogin(t);var i=t.data,e=i.results,a="";if(0==e.length)return a='<li style="text-align:center;">没有往来邮件！</li>',$(".come-go-email-list").empty(),void $(".come-go-email-list").append(a);if(e.length>0){for(var s=0;s<e.length;s++)1==e[s].type&&0==e[s].isRead?a+='<li data-id="'+e[s].id+'" isRead="'+e[s].isRead+'" data-type="'+e[s].type+'">\t\t\t\t\t\t\t\t                <h4><i class="dot-icon"></i>'+e[s].name+'<span class="come-go-time">'+e[s].sendTime+'</span></h4>\t\t\t\t\t\t\t\t                <div class="list-email-info">\t\t\t\t\t\t\t\t                    <div class="list-email-info-title"><i class="pub-icon come-icon"></i>'+e[s].subject+'</div>\t\t\t\t\t\t\t\t                    <div class="list-email-info-content">'+e[s].content+"</div>\t\t\t\t\t\t\t\t                </div>\t\t\t\t\t\t\t\t            </li>":2==e[s].type&&0==e[s].isRead?a+='<li data-id="'+e[s].id+'" isRead="'+e[s].isRead+'" data-type="'+e[s].type+'">\t\t\t\t\t\t\t\t                <h4><i class="dot-icon"></i>'+e[s].name+'<span class="come-go-time">'+e[s].sendTime+'</span></h4>\t\t\t\t\t\t\t\t                <div class="list-email-info">\t\t\t\t\t\t\t\t                    <div class="list-email-info-title"><i class="pub-icon go-icon"></i>'+e[s].subject+'</div>\t\t\t\t\t\t\t\t                    <div class="list-email-info-content">'+e[s].content+"</div>\t\t\t\t\t\t\t\t                </div>\t\t\t\t\t\t\t\t            </li>":1==e[s].type&&1==e[s].isRead?a+='<li data-id="'+e[s].id+'" isRead="'+e[s].isRead+'" data-type="'+e[s].type+'">\t\t\t\t\t\t\t\t                <h4>'+e[s].name+'<span class="come-go-time">'+e[s].sendTime+'</span></h4>\t\t\t\t\t\t\t\t                <div class="list-email-info">\t\t\t\t\t\t\t\t                    <div class="list-email-info-title"><i class="pub-icon come-icon"></i>'+e[s].subject+'</div>\t\t\t\t\t\t\t\t                    <div class="list-email-info-content">'+e[s].content+"</div>\t\t\t\t\t\t\t\t                </div>\t\t\t\t\t\t\t\t            </li>":2==e[s].type&&1==e[s].isRead&&(a+='<li data-id="'+e[s].id+'" isRead="'+e[s].isRead+'" data-type="'+e[s].type+'">\t\t\t\t\t\t\t\t                <h4>'+e[s].name+'<span class="come-go-time">'+e[s].sendTime+'</span></h4>\t\t\t\t\t\t\t\t                <div class="list-email-info">\t\t\t\t\t\t\t\t                    <div class="list-email-info-title"><i class="pub-icon go-icon"></i>'+e[s].subject+'</div>\t\t\t\t\t\t\t\t                    <div class="list-email-info-content">'+e[s].content+"</div>\t\t\t\t\t\t\t\t                </div>\t\t\t\t\t\t\t\t            </li>");$(".come-go-email-list").empty().append(a)}}}),i},isRead:function(t,i){var e={ids:[t],value:i},a="data="+JSON.stringify(e);return $.ajax({url:Base.sitUrl+"/api/email/outbox/v1/read",type:"POST",data:a,success:function(t){t.success||$.unLogin(t)}}),e}};a.comeGoList(i)})});