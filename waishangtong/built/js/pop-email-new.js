require(["common"],function(){require(["maintab","ZeroClipboard","ueditorLang","blockUI","jqform","ztree"],function(maintab,ZeroClipboard){function dataOrg(){var e;return $.ajax({type:"POST",url:Base.sitUrl+"/api/disk/v1/all/visible/file/list",dataType:"json",async:!1,success:function(a){return a.success?void(e=a.data):void $.Alert(a.message)}}),e}function zTreeCloud(){for(var e=new Array,a=dataOrg(),t=0;t<a.length;t++){if(1==a[t].type)var n="pIcon",i=!1;else var n="",i=!0;e[t]={id:a[t].id,pId:a[t].pid,name:a[t].name,type:a[t].type,url:a[t].file,open:!1,nocheck:i,iconSkin:n}}$.fn.zTree.init($("#treeDemoAdd"),setting,e)}function buildAddressJson(e,a){for(var t=$("#"+e).find(".addrcontainer").find(".one"),n=0;n<t.length;n++){var i=0,d=t.eq(n).attr("data-id");"undefined"!=d&&null!=d&&""!=d&&(i=parseInt(d));var s=t.eq(n).find("b").html(),l=t.eq(n).find("span").text(),o=l.substring(1,l.length-2);a.push({name:s,email:o,id:i})}}function newEmailInfomation(e){newEmailObj.arr=[],newEmailObj.ccarr=[],newEmailObj.bccarr=[],buildAddressJson("divtxt",newEmailObj.arr),buildAddressJson("carbonCopy",newEmailObj.ccarr),buildAddressJson("blindCarbonCopy",newEmailObj.bccarr);var a=$("#sendTheme").val(),t=$("#added-files>li"),n=[],i=!0,d={content:UE.getEditor("sendEditor").getContent(),subject:a};if($("#priority").prop("checked")&&(d.priority=1),$("#readReturn").prop("checked")&&(d.readReturn=!0),$("#tracking").prop("checked")&&(d.tracking=!0),newEmailObj.arr.length>0?d.tos=newEmailObj.arr:void 0==e&&($.Alert("请输入收件人！"),i=!1),newEmailObj.ccarr.length>0&&(d.ccs=newEmailObj.ccarr),newEmailObj.bccarr.length>0&&(d.bccs=newEmailObj.bccarr),t.length>0){for(var s=0;s<t.length;s++)n.push({fileUrl:t.eq(s).attr("data-url"),filename:t.eq(s).children("span").eq(0).text()});d.attachments=n}return{flag:i,obj:d}}function modelPdtAdd(e){$.ajax({url:Base.sitUrl+"/api/export/v1/product/picture",type:"POST",data:{ids:e},beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);for(var a=e.data,t="",n=0;n<a.length;n++){var i="http://"+a[n].pictureUrl;t+='<br /><br /><br /><img src="'+i+'" style="max-width:800px"><br />';var d="http://"+a[n].pdfUrl,s='<li data-url="'+d+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+a[n].pdfName+'</span> <span class="att-size">( '+a[n].pdfSize+' )</span> <span class="removeLi">删除</span><span class="previewEml">预览</span></li>';$("#added-files").show().prepend(s)}UE.getEditor("sendEditor").execCommand("inserthtml",t),$("#myModal").modal("hide"),$("#myModal").on("hidden.bs.modal",function(e){UE.getEditor("sendEditor").focus("start")})}})}function modelquoteAdd(e){$.ajax({url:Base.sitUrl+"/api/export/v1/quotation/picture",type:"POST",data:{ids:e},beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);for(var a=e.data,t="",n=0;n<a.length;n++){var i="http://"+a[n].pictureUrl;t+='<br /><br /><br /><img src="'+i+'" style="max-width:800px"><br />';var d="http://"+a[n].pdfUrl,s='<li data-url="'+d+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+a[n].pdfName+'</span> <span class="att-size">( '+a[n].pdfSize+' )</span> <span class="removeLi">删除</span><span class="previewEml">预览</span></li>';$("#added-files").show().prepend(s)}UE.getEditor("sendEditor").execCommand("inserthtml",t),$("#myModal").modal("hide"),$("#myModal").on("hidden.bs.modal",function(e){UE.getEditor("sendEditor").focus("start")})}})}function modelpiAdd(e){$.ajax({url:Base.sitUrl+"/api/export/v1/pi/picture",type:"POST",data:{ids:e},beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);for(var a=e.data,t="",n=0;n<a.length;n++){var i="http://"+a[n].pictureUrl;t+='<br /><br /><br /><img src="'+i+'" style="max-width:800px"><br />';var d="http://"+a[n].pdfUrl,s='<li data-url="'+d+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+a[n].pdfName+'</span> <span class="att-size">( '+a[n].pdfSize+' )</span> <span class="removeLi">删除</span><span class="previewEml">预览</span></li>';$("#added-files").show().prepend(s)}UE.getEditor("sendEditor").execCommand("inserthtml",t),$("#myModal").modal("hide"),$("#myModal").on("hidden.bs.modal",function(e){UE.getEditor("sendEditor").focus("start")})}})}function newEmailfujian(e){$.ajax({url:Base.sitUrl+"/api/email/v1/to/attachment",type:"POST",dataType:"json",data:{data:e},beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data,t=a.name,n=a.url,i="http://"+n,d='<li data-url="'+i+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+t+'</span><span class="removeLi">删除</span><span class="previewEml">预览</span></li>';$("#added-files").show().prepend(d)}})}function sign(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/signature/get",dataType:"json",type:"POST",async:!1,success:function(e){if(!e.success)return void $.Alert(e.message);var a=e.data;if(null!==a&&1==a.isUsing){var t=a.signature.replace(/&#39;/g,'"');UE.getEditor("sendEditor").ready(function(){UE.getEditor("sendEditor").setContent('<hr style="width:210px;margin-top:12px;background-color:#b5c4df;float:left;height:1px;border:none;"></br><p></p>'+t,!0),startContent=UE.getEditor("sendEditor").getContent(),startTheme=$("#sendTheme").val()})}}})}function settingEmail(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/config/get",dataType:"json",async:!1,type:"POST",success:function(e){if(!e.success)return void $.Alert(e.message);var a=e.data;if(a){var t=a.defaultTemplate;0==a.defaultCcOpend&&""!=a.defaultCc&&$("#carbonCopy").find(".addrcontainer").append('<div class="addr-outer"><div class="one" contenteditable="false" data-type="0"><b></b><span>&lt;'+a.defaultCc+"&gt;</span><span class=fh>;<span><div></div>"),0==a.defaultBccOpend&&""!=a.defaultBcc&&$("#blindCarbonCopy").find(".addrcontainer").append('<div class="addr-outer"><div class="one" contenteditable="false" data-type="0"><b></b><span>&lt;'+a.defaultBcc+"&gt;</span><span class=fh>;<span><div></div>"),$.ajax({url:Base.sitUrl+"/api/org/v1/org/template/list",dataType:"json",type:"POST",async:!1,success:function(e){if(!e.success)return void $.Alert(e.message);for(var a=e.data,n=0;n<a.length;n++)if(t==a[n].id){var i=a[n].template.replace(/&#39;/g,'"');UE.getEditor("sendEditor").ready(function(){UE.getEditor("sendEditor").setContent(i,!0),startContent=UE.getEditor("sendEditor").getContent(),startTheme=$("#sendTheme").val()})}sign()}}),""!==a?UE.getEditor("sendEditor").ready(function(){UE.getEditor("sendEditor").execCommand("forecolor",a.fontColour),UE.getEditor("sendEditor").execCommand("fontsize",a.fontSize),UE.getEditor("sendEditor").execCommand("fontfamily",a.fontStyle)}):UE.getEditor("sendEditor").ready(function(){UE.getEditor("sendEditor").execCommand("forecolor","#000"),UE.getEditor("sendEditor").execCommand("fontsize","14px"),UE.getEditor("sendEditor").execCommand("fontfamily","宋体")})}}})}function pdt1(){$.ajax({url:Base.sitUrl+"/api/product/v1/product/type/sublist?pid=0",type:"GET",dataType:"json",success:function(e){if(!e.success)return void $.unLogin(e);for(var a=e.data,t="",n=0;n<a.length;n++)t+='<option value="'+a[n].id+'">'+a[n].name+"</option>";$("#pdtSelect1").empty().append('<option value="">全部</option>').append(t)}})}function pdtGroup(){$.ajax({url:Base.sitUrl+"/api/product/v1/product/catelog/list",type:"GET",dataType:"json",success:function(e){if(!e.success)return void $.unLogin(e);for(var a=e.data,t="",n=0;n<a.length;n++)t+='<option value="'+a[n].id+'">'+a[n].name+"</option>";$("#pdtGroup").empty().append('<option value="">全部</option>').append(t)}})}function showbtn(){for(var e=0;e<$(".add-files").find("span.data-code").length;e++){var a=$(".add-files").find("span.data-code").eq(e).attr("data-code"),t=parent.parent.$.menuPower(a);1!==t&&$(".add-files").find("span.data-code").eq(e).addClass("btnRemove")}var n=$("#personalMaillist").attr("data-code"),i=$("#companyMaillist").attr("data-code"),d=top.$.menuPower(n),s=top.$.menuPower(i);1==d&&1==s?($("#personalMaillist").addClass("btnRemove"),$("#companyMaillist").addClass("btnRemove")):1==d?$("#personalMaillist").addClass("btnRemove"):1==s&&$("#companyMaillist").addClass("btnRemove"),$(".btnRemove").remove()}maintab.init();var startContent,startTheme;window.ZeroClipboard=ZeroClipboard;var emailId=$.GetQueryString("id"),hflx=$.GetQueryString("type"),typeCloud=$.GetQueryString("typeCloud"),typeTask=$.GetQueryString("typeTask"),emailTask=$.GetQueryString("emailTask"),modelType=$.GetQueryString("modelType"),customerName=$.GetQueryString("name"),modelsId=parseInt($.GetQueryString("ids"));99==modelType?modelPdtAdd(modelsId):100==modelType?modelquoteAdd(modelsId):101==modelType&&modelpiAdd(modelsId);var setting={view:{selectedMulti:!1},check:{enable:!0},data:{simpleData:{enable:!0}},callback:{beforeDrag:!1}};$(".divtxt").on("click",function(e){$.EventFn(e);var a=$(this).attr("id");if("carbonCopy"==a){newEmailObj.clickRecord=1;var t=e.target;e.target===this?$(this).find(".inputaddress").focus():$(".addr-outer").each(function(){if(t===this){var e='<div class="addr-edit"><input type="text" /></div>';$(this).append(e).find("input").focus()}})}else if("blindCarbonCopy"==a){newEmailObj.clickRecord=2;var t=e.target;e.target===this?$(this).find(".inputaddress").focus():$(".addr-outer").each(function(){if(t===this){var e='<div class="addr-edit"><input type="text" /></div>';$(this).append(e).find("input").focus()}})}else{newEmailObj.clickRecord=0;var t=e.target;e.target===this?$(this).find(".inputaddress").focus():$(".addr-outer").each(function(){if(t===this){var e='<div class="addr-edit"><input type="text" /></div>';$(this).append(e).find("input").focus()}})}}),$(".input-group").on("dblclick",".one",function(e){$.EventFn(e);var a=$(this).closest(".one"),t=a.attr("data-type"),n=a.attr("data-id"),i=newEmailObj.arr,d=[];1==t?a.attr("contentEditable","true"):2==t?a.attr("contentEditable","true"):a.attr("contentEditable","true");for(var s=0;s<i.length;s++)i[s].id!=n&&d.push(i[s]);1==t?(newEmailObj.bccarr=d,$("#carbonCopy").val("")):2==t?(newEmailObj.ccarr=d,$("#blindCarbonCopy").val("")):($("#divtxt").val(""),newEmailObj.arr=d)}),$("#added-files").on("click",">li>.dels-file",function(e){$.EventFn(e),$(this).parent().remove()}),$(".sentbox-right").on("click",">.ess>.essy>ul>li",function(e){$.EventFn(e);var a=$(this).children("span"),t=a.eq(1).attr("data-email");if(1==newEmailObj.clickRecord){var n=$("#carbonCopy").val(),i="";null==n||""==n?(n=$("#carbonCopy").val(t+";"),i='<div class="addr-outer"><div class="one" contenteditable="false" data-type="1" data-id="'+$(this).attr("data-id")+'"><b>'+a.eq(0).text()+"</b><span>&lt;"+a.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"):n.indexOf(t)==-1&&(n=$("#carbonCopy").val(n+t+";"),i='<div class="addr-outer"><div class="one" contenteditable="false" data-type="1" data-id="'+$(this).attr("data-id")+'"><b>'+a.eq(0).text()+"</b><span>&lt;"+a.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"),$("#carbonCopy").find(".addrcontainer").append(i)}else if(2==newEmailObj.clickRecord){var n=$("#blindCarbonCopy").val(),i="";null==n||""==n?(n=$("#blindCarbonCopy").val(t+";"),i='<div class="addr-outer"><div class="one" contenteditable="false" data-type="2" data-id="'+$(this).attr("data-id")+'"><b>'+a.eq(0).text()+"</b><span>&lt;"+a.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"):n.indexOf(t)==-1&&(n=$("#blindCarbonCopy").val(n+t+";"),i='<div class="addr-outer"><div class="one" contenteditable="false" data-type="2" data-id="'+$(this).attr("data-id")+'"><b>'+a.eq(0).text()+"</b><span>&lt;"+a.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"),$("#blindCarbonCopy").find(".addrcontainer").append(i)}else{var n=$("#divtxt").val(),i="";null==n||""==n?(n=$("#divtxt").val(t+";"),i='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b>'+a.eq(0).text()+"</b><span>&lt;"+a.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"):n.indexOf(t)==-1&&(n=$("#divtxt").val(n+t+";"),i='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b>'+a.eq(0).text()+"</b><span>&lt;"+a.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"),$("#divtxt").find(".addrcontainer").append(i)}}),$("body").on("click",function(e){"block"==$(".receptetips").css("display")&&$(".receptetips").hide()}),$(".input-group").on("click",".receptetips>li",function(e){$.EventFn(e);var a=$(this).closest("td").find(".receptetips"),t=$(this).closest("td").find(".inputaddress"),n=$(this).children("span"),i=n.eq(1).attr("data-email");if(1==newEmailObj.clickRecord){var d=$("#carbonCopy").val(),s="";null==d||""==d?($("#carbonCopy").val(i+";"),s='<div class="addr-outer"><div class="one" contenteditable="false" data-type="1" data-id="'+$(this).attr("data-id")+'"><b>'+n.eq(0).text()+"</b><span>&lt;"+n.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"):d.indexOf(i)==-1&&($("#carbonCopy").val(d+i+";"),s='<div class="addr-outer"><div class="one" contenteditable="false" data-type="1" data-id="'+$(this).attr("data-id")+'"><b>'+n.eq(0).text()+"</b><span>&lt;"+n.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"),t.val(""),$("#carbonCopy").find(".addrcontainer").append(s),a.hide()}else if(2==newEmailObj.clickRecord){var d=$("#blindCarbonCopy").val(),s="";null==d||""==d?($("#blindCarbonCopy").val(i+";"),s='<div class="addr-outer"><div class="one" contenteditable="false" data-type="2" data-id="'+$(this).attr("data-id")+'"><b>'+n.eq(0).text()+"</b><span>&lt;"+n.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"):d.indexOf(i)==-1&&($("#blindCarbonCopy").val(d+i+";"),s='<div class="addr-outer"><div class="one" contenteditable="false" data-type="2" data-id="'+$(this).attr("data-id")+'"><b>'+n.eq(0).text()+"</b><span>&lt;"+n.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"),t.val(""),$("#blindCarbonCopy").find(".addrcontainer").append(s),a.hide()}else{t.val("");var d=$("#divtxt").val(),s="";null==d||""==d?($("#divtxt").val(i+";"),s='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b>'+n.eq(0).text()+"</b><span>&lt;"+n.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"):d.indexOf(i)==-1&&($("#divtxt").val(d+i+";"),s='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b>'+n.eq(0).text()+"</b><span>&lt;"+n.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"),$("#divtxt").find(".addrcontainer").append(s),a.hide()}});var reg=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;$(".input-group").on("blur",".inputaddress",function(e){var a=$(this).val(),t="";if(null!=a&&""!=a){if(!reg.test(a))return void(null!=a&&""!=a&&(t='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b></b><span class="emailError">&lt;'+a+"&gt;</span><span class=fh>;<span><div></div>",$(this).parent(".addressinput").parent(".divtxt").find(".addrcontainer").append(t),$(this).val("")));t='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b></b><span>&lt;'+a+"&gt;</span><span class=fh>;<span><div></div>",$(this).parent(".addressinput").parent(".divtxt").find(".addrcontainer").append(t),$(this).val("")}}),$(".input-group").on("keyup",".inputaddress",function(e){var a=$(this).closest(".divtxt").parent("td").find(".receptetips");if("186"==e.keyCode||"9"==e.keyCode){var t=$(this).val();if(!reg.test(t))return void(null!=t&&""!=t&&(n='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b></b><span class="emailError">&lt;'+t+"&gt;</span><span class=fh>;<span><div></div>",$(this).parent(".addressinput").parent(".divtxt").find(".addrcontainer").append(n),$(this).val(""),a.hide()));var n="";t=t.substring(0,t.length-1),null!=t&&""!=t&&(n='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b></b><span>&lt;'+t+"&gt;</span><span class=fh>;<span><div></div>",$(this).parent(".addressinput").parent(".divtxt").find(".addrcontainer").append(n),$(this).val(""),a.hide())}else if("40"==e.keyCode&&"block"==$(".receptetips").css("display")){if($(".receptetips li.active").index()==$(".receptetips li").length-1)return;$(".receptetips li.active").removeClass("active").next("li").addClass("active")}else if("38"==e.keyCode&&"block"==$(".receptetips").css("display")){if(0==$(".receptetips li.active").index())return;$(".receptetips li.active").removeClass("active").prev("li").addClass("active")}else if("13"==e.keyCode&&"block"==$(".receptetips").css("display")){var a=$(".receptetips li.active").closest("td").find(".receptetips"),i=$(".receptetips li.active").closest("td").find(".inputaddress"),d=$(".receptetips li.active").children("span"),s=d.eq(1).attr("data-email");i.val("");var l=$(this).closest(".divtxt").val(),n="";null==l||""==l?($(this).closest(".divtxt").val(s+";"),n='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b>'+d.eq(0).text()+"</b><span>&lt;"+d.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"):l.indexOf(s)==-1&&($(this).closest(".divtxt").val(l+s+";"),n='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b>'+d.eq(0).text()+"</b><span>&lt;"+d.eq(1).attr("data-email")+"&gt;</span><span class=fh>;<span><div></div>"),$(this).closest(".divtxt").find(".addrcontainer").append(n),a.hide()}else if("13"==e.keyCode){var t=$(this).val();if(!reg.test(t))return void(null!=t&&""!=t&&(n='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b></b><span class="emailError">&lt;'+t+"&gt;</span><span class=fh>;<span><div></div>",$(this).parent(".addressinput").parent(".divtxt").find(".addrcontainer").append(n),$(this).val(""),a.hide()));var n="";null!==t&&(n+='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+$(this).attr("data-id")+'"><b></b><span>&lt;'+t+"&gt;</span><span class=fh>;<span><div></div>",$(this).closest(".divtxt").find(".addrcontainer").append(n),$(this).val(""),a.hide())}}),$(".input-group").on("keydown",".addr-edit input",function(e){$.EventFn(e),"8"==event.keyCode&&$(this).closest(".addr-outer").remove()}),$(".input-group").on("keydown",".inputaddress",function(e){if("8"==e.keyCode){var a=$(this).parent(".addressinput").prev(".addrcontainer").find(".one:last"),t=a.attr("data-id"),n=a.attr("data-type"),i=newEmailObj.arr,d=[];1==n?(null!=$(this).val()&&""!=$(this).val()||a.parent().remove(),i=newEmailObj.bccarr):2==n?(null!=$(this).val()&&""!=$(this).val()||a.parent().remove(),i=newEmailObj.ccarr):null!=$(this).val()&&""!=$(this).val()||a.parent().remove();for(var s=0;s<i.length;s++)i[s].id!=t&&d.push(i[s]);1==n?(newEmailObj.bccarr=d,$("#carbonCopy").val("")):2==n?(newEmailObj.ccarr=d,$("#blindCarbonCopy").val("")):($("#divtxt").val(""),newEmailObj.arr=d)}}),$(".input-group").on("focus",".inputaddress",function(e){$.EventFn(e);var a=$(this).closest("td").find(".receptetips"),t=newEmailObj.tipslist.unique();if(0==a.children("li").length){for(var n="",i=0;i<t.length;i++)n+='<li data-id="'+t[i].value+'">                                <span>'+t[i].name+'</span>                                <span data-email="'+t[i].value+'">('+t[i].value+")</span>                            </li>";a.append(n)}}),$(".input-group").on("input",".inputaddress",function(){for(var e=newEmailObj.tipslist,a=[],t=$(this).closest(".divtxt").parent("td").find(".receptetips"),n=0;n<e.length;n++)e[n].name.indexOf($(this).val())!=-1&&a.push(e[n]);if(a.length>0){for(var i="",d=0;d<a.length;d++){if(0==d)var s="active";else var s="";i+='<li class="'+s+'">                                <span>'+a[d].name+'</span>                                <span data-email="'+a[d].value+'">< '+a[d].value+" ></span>                            </li>"}t.empty().append(i).show()}else t.hide()}),$(".sentbox-left").on("click","#shoujianren-title",function(e){$.EventFn(e),$(".csAndMs").slideToggle("slow"),$(".down-zk-icon").toggleClass("up-zk-icon")}),$("#sendEmail").on("click",function(e){if($.EventFn(e),$("#divtxt").find(".emailError").length>0)return void $.Alert("邮箱格式有误");var a=newEmailInfomation();a.flag&&newEmailObj.sendEmail(a.obj)}),$("#saveDrafts").on("click",function(e){$.EventFn(e);var a=newEmailInfomation(12);a.flag&&newEmailObj.saveDrafts(a.obj)}),$(".add-attachment").on("click",function(){$("input[name=upFiles]").click()}),$("input[name=upFiles]").on("change",function(e){$.EventFn(e);var a=newEmailObj.fileLimit($(this));a.flag&&newEmailObj.uploadFujian(a.name,a.size)}),$(".add-images").click(function(){$("input[name=upImgs]").click()}),$("input[name=upImgs]").on("change",function(e){$.EventFn(e);var a=newEmailObj.fileLimit($(this));a.flag&&newEmailObj.uploadImg(a.name)}),$("#emailContacts>li").on("click",function(e){if($.EventFn(e),!$(this).hasClass("current")){$(this).addClass("current").siblings().removeClass("current");var a=$(this).index();$(".rightShowList").eq(a).addClass("activities").siblings().removeClass("activities")}}),$("#search-input").on("input",function(e){$.EventFn(e);var a=$("#search-input").val(),t=$(this).closest(".sentbox-right").find(".search-list"),n=t.children(".essy").children("#search-list"),i=newEmailObj.tipslist.unique(),d=[];if(a.length>0){$("#c-search-btn").addClass("clear-icon-email").removeClass("search-icon-email"),$("#emailContacts, #content").hide(),t.show();for(var s=0;s<i.length;s++)i[s].name.indexOf(a)==-1&&i[s].value.indexOf(a)==-1||d.push(i[s]);if(d.length>0){for(var l="",o=0;o<d.length;o++)l+="<li>                                    <span>"+d[o].name+'</span>                                    <span data-email="'+d[o].value+'">('+d[o].value+"&gt;</span>                                </li>";n.empty().append(l)}else l="<li>没有找到该联系人！</li>",n.empty().append(l)}else $("#emailContacts,#content").show(),$("#c-search-btn").addClass("search-icon-email").removeClass("clear-icon-email"),t.hide()}),$(".sentbox-right").on("click",".clear-icon-email",function(e){$.EventFn(e),$("#search-input").val(""),$("#c-search-btn").addClass("search-icon-email").removeClass("clear-icon-email"),$(this).closest(".sentbox-right").find(".search-list").hide(),$("#emailContacts,#content").show()}),$(".add-files").on("click",".add-text",function(){pageObj.currentPage=1,newEmailObj.fastText(),$("#myModalLabel").empty().text("选择快速文本"),$(".modal-footer .btn:last-child").attr("id","textBtn"),$("#treeDemoAdd, #myModal .page, #myModal .form-group").hide(),$("#myModal .modelDwon, #myModal .pageText").show()}),$(".add-files").on("click",".add-cloud",function(){pageObj.currentPage=1,zTreeCloud(),$("#myModalLabel").empty().text("选择云文件"),$(".modal-footer .btn:last-child").attr("id","cloudBtn"),$("#treeDemoAdd").show(),$("#myModal .modelDwon, #myModal .page, #myModal .form-group").hide()}),$(".add-files").on("click",".add-model",function(e){pageObj.currentPage=1,newEmailObj.insertModel(),$("#myModalLabel").empty().text("选择模板"),$(".modal-footer .btn:last-child").attr("id","modelBtn"),$("#modelInput").show().siblings(".form-group").hide(),$("#treeDemoAdd, #myModal .page").hide(),$("#myModal .modelDwon, #myModal .pageMod").show()}),$(".add-files").on("click",".add-PI",function(e){pageObj.currentPage=1,newEmailObj.insertModelPi(),$("#myModalLabel").empty().text("选择PI模板"),$(".modal-footer .btn:last-child").attr("id","piBtn"),$("#piInput").show().siblings(".form-group").hide(),$("#myModal .page, #treeDemoAdd").hide(),$("#myModal .pagePi, #myModal .modelDwon").show()}),$(".add-files").on("click",".add-quotation",function(e){pageObj.currentPage=1,newEmailObj.insertModel3(),$("#myModalLabel").empty().text("选择报价单"),$(".modal-footer .btn:last-child").attr("id","quoteBtn"),$("#quoteInput").show().siblings(".form-group").hide(),$("#myModal .page, #treeDemoAdd").hide(),$("#myModal .pageQuo, #myModal .modelDwon").show()}),$(".add-files").on("click",".add-product",function(e){pageObj.currentPage=1,newEmailObj.insertModelPdt(),pdt1(),pdtGroup(),$("#myModalLabel").empty().text("选择产品"),$(".modal-footer .btn:last-child").attr("id","pdtBtn"),$("#pdtInput1").show().siblings(".form-group").hide(),$("#pdtInput2, #pdtInput3").css("display","inline-block"),$("#myModal .page, #treeDemoAdd").hide(),$("#myModal .pagePdt, #myModal .modelDwon").show()}),$(".modal-footer .btn:last-child").on("click",function(e){$.EventFn(e);var a=$(this).attr("id");if("pdtBtn"==a){for(var t=new Array,n=$("#myModal .modelDwon").find("input[type=checkbox]:checked").length,i=0;i<n;i++){var d=$("#myModal .modelDwon").find("input[type=checkbox]:checked").eq(i).parents("li").attr("data-id");d=parseInt(d),t+=d+","}t=t.substring(0,t.length-1),modelPdtAdd(t)}else if("quoteBtn"==a){for(var t=new Array,n=$("#myModal .modelDwon").find("input[type=checkbox]:checked").length,i=0;i<n;i++){var d=$("#myModal .modelDwon").find("input[type=checkbox]:checked").eq(i).parents("li").attr("data-id");d=parseInt(d),t+=d+","}t=t.substring(0,t.length-1),modelquoteAdd(t)}else if("piBtn"==a){for(var t=new Array,n=$("#myModal .modelDwon").find("input[type=checkbox]:checked").length,i=0;i<n;i++){var d=$("#myModal .modelDwon").find("input[type=checkbox]:checked").eq(i).parents("li").attr("data-id");d=parseInt(d),t+=d+","}t=t.substring(0,t.length-1),modelpiAdd(t)}else if("modelBtn"==a){var d=$("#myModal .modelDwon").find("input[type=checkbox]:checked").parents("li").attr("data-value");UE.getEditor("sendEditor").execCommand("inserthtml",d),$("#myModal").modal("hide")}else if("textBtn"==a){var d=$("#myModal .modelDwon").find("input[type=checkbox]:checked").parents("li").attr("data-value");UE.getEditor("sendEditor").execCommand("inserthtml",d),$("#myModal").modal("hide")}else if("cloudBtn"==a){var s=$.fn.zTree.getZTreeObj("treeDemoAdd"),l=s.getCheckedNodes(!0),o="";if($("#added-files").find("li").length>0)for(var i=0;i<l.length;i++){for(var r,c=0;c<$("#added-files").find("li").length;c++){var p=$("#added-files").find("li").eq(c).attr("data-url");p==l[i].url&&(r=1)}1==r?(o+="",r=0):o+='<li data-url="'+l[i].url+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+l[i].name+'</span> <span class="att-size"></span> <span class="removeLi">删除</span><span class="previewEml">预览</span></li>'}else for(var i=0;i<l.length;i++){var p=$(".added-files").find("li").eq(c).attr("data-url");o+=p!==l[i].url?'<li data-url="'+l[i].url+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+l[i].name+'</span> <span class="att-size"></span> <span class="removeLi">删除</span><span class="previewEml">预览</span></li>':""}$("#added-files").show().prepend(o),$("#myModal").modal("hide")}});var pageObj={homepage:1,lastpage:null,currentPage:1,pageSize:8},newEmailObj={searchContacts:[],tipslist:[],arr:[],ccarr:[],bccarr:[],clickRecord:0,addressList:function(){var e=$("#search-input").val()||"",a=Base.sitUrl+"/api/addressList/v1/quickList";e&&(a+="?keyword="+e),$.ajax({url:a,type:"GET",success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data,t="";if(a.length>0){for(var n=0;n<a.length;n++)newEmailObj.tipslist.push(a[n]),t+='<li data-id="'+a[n].value+'"><span>'+a[n].name+'</span><span data-email="'+a[n].value+'">&lt;'+a[n].value+"&gt;</span></li>";$("#personalMaillist").append(t)}}})},contactsList:function(){var e=$("#search-input").val()||"",a=Base.sitUrl+"/api/customer/contacts/v1/quickList";e&&(a+="?keyword="+e),$.ajax({url:a,type:"GET",success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data,t="";if(a.length>0){for(var n=0;n<a.length;n++)newEmailObj.tipslist.push(a[n]),t+='<li data-id="'+a[n].value+'"><span>'+a[n].name+'</span><span data-email="'+a[n].value+'">&lt;'+a[n].value+"&gt;</span></li>";$("#companyMaillist").append(t)}}})},sendEmail:function(e){newEmailObj.operationEmail(e,"/api/email/v1/send")},saveDrafts:function(e,a){newEmailObj.operationEmail(e,"/api/email/v1/draft/save",a)},operationEmail:function(e,a,t){var n="";$.ajax({url:Base.sitUrl+a,beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},type:"POST",data:{data:JSON.stringify(e)},success:function(e){if(!e.success)return void $.unLogin(e);if("/api/email/v1/send"==a){for(var i=0;i<$(".addr-outer").length;i++){var d=$(".addr-outer").eq(i).find(".one").find("span").eq(0).text();n+=d.substring(1,d.length-1)+","}n=n.substring(0,n.length-1),$("#mainIframe",top.document).attr("src",Base.sitUrl+"/html/pop-email-success.html?id="+e.data+"&email="+n)}else"/api/email/v1/draft/save"==a&&$.Alert("保存草稿成功！","",function(){t&&$("#mainIframe",top.document).attr("src",Base.sitUrl+"/html"+t.substring(1))})}})},fastText:function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/qtexts/search",type:"POST",data:{currentPage:pageObj.currentPage,pageSize:pageObj.pageSize},success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data,t="";if(null!=a&&""!=a)for(var n=0;n<a.length;n++)t+='<li data-value="'+a[n].value+'"><input type="checkbox" id="checkbox'+n+'" name="model-checkbox">&nbsp;<label for="checkbox'+n+'" style="display: inline-block;margin-left: 5px;margin-top: 5px;width:180px;">'+a[n].name+'</label><span class="text">'+a[n].value+"</span></li>";else t+='<div class="text-center">暂无快速文本</div>';$("#myModal .modelDwon").empty().append(t);var i=a.length,d=Math.ceil(i/pageObj.pageSize);$.Page({total:i,_class:".pageText",nowNum:pageObj.currentPage,allNum:d,callback:function(e,a){pageObj.currentPage=e,newEmailObj.fastText()}})}})},insertModel:function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/templates/search",type:"POST",data:{currentPage:pageObj.currentPage,pageSize:pageObj.pageSize},success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data,t="";if(null!=a&&""!=a)for(var n=0;n<a.length;n++)t+='<li data-value="'+a[n].value+'"><input type="checkbox" id="checkbox'+n+'" name="model-checkbox">&nbsp;<label for="checkbox'+n+'" style="display: inline-block;margin-left: 5px;margin-top: 5px;">'+a[n].name+"</label></li>";else t+='<div class="text-center">暂无模板</div>';$("#myModal .modelDwon").empty().append(t);var i=e.data.totalItem||0,d=Math.ceil(i/pageObj.pageSize);$.Page({total:i,_class:".pageMod",nowNum:pageObj.currentPage,allNum:d,callback:function(e,a){pageObj.currentPage=e,newEmailObj.insertModel()}})}})},insertModelPi:function(e){$.ajax({url:Base.sitUrl+"/api/export/v1/list",type:"GET",data:{type:2,name:e,currentPage:pageObj.currentPage,pageSize:pageObj.pageSize},beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data.results,t="";if(null!=a&&""!=a)for(var n=0;n<a.length;n++)t+='<li data-id="'+a[n].id+'"><input type="checkbox" id="checkbox'+n+'" name="model-checkbox">&nbsp;<label for="checkbox'+n+'" style="display: inline-block;margin-left: 5px;margin-top: 5px;">'+a[n].name+"</label></li>";else t+='<div class="text-center">暂无PI模板</div>';$("#myModal .modelDwon").empty().append(t);var i=e.data.totalItem,d=Math.ceil(i/pageObj.pageSize);$.Page({total:i,_class:".pagePi",nowNum:pageObj.currentPage,allNum:d,callback:function(e,a){pageObj.currentPage=e,newEmailObj.insertModelPi()}})}})},insertModelPdt:function(e,a,t){$.ajax({url:Base.sitUrl+"/api/export/v1/list",type:"GET",data:{type:1,name:e,productCatelog:a,productType:t,currentPage:pageObj.currentPage,pageSize:pageObj.pageSize},beforeSend:function(e){$.BlockUI()},complete:function(e,a){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);
var a=e.data.results,t="";if(null!=a&&""!=a)for(var n=0;n<a.length;n++)t+='<li data-id="'+a[n].id+'"><input type="checkbox" id="checkbox'+n+'" name="model-checkbox">&nbsp;<label for="checkbox'+n+'" style="display: inline-block;margin-left: 5px;margin-top: 5px;width: 500px;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;">'+a[n].name+"</label></li>";else t+='<div class="text-center">暂无产品模板</div>',$(".page").hide();$("#myModal .modelDwon").empty().append(t);var i=e.data.totalItem,d=Math.ceil(i/pageObj.pageSize);$.Page({total:i,_class:".pagePdt",nowNum:pageObj.currentPage,allNum:d,callback:function(e,a){pageObj.currentPage=e,newEmailObj.insertModelPdt()}})}})},insertModel3:function(e){$.ajax({url:Base.sitUrl+"/api/export/v1/list",type:"GET",data:{type:3,name:e,currentPage:pageObj.currentPage,pageSize:pageObj.pageSize},beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data.results,t="";if(null!=a&&""!=a)for(var n=0;n<a.length;n++)t+='<li data-id="'+a[n].id+'"><input type="checkbox" id="checkbox'+n+'" name="model-checkbox">&nbsp;<label for="checkbox'+n+'" style="display: inline-block;margin-left: 5px;margin-top: 5px;">'+a[n].name+"</label></li>";else t+='<div class="text-center">暂无报价单</div>';$("#myModal .modelDwon").empty().append(t);var i=e.data.totalItem,d=Math.ceil(i/pageObj.pageSize);$.Page({total:i,_class:".pageQuo",nowNum:pageObj.currentPage,allNum:d,callback:function(e,a){pageObj.currentPage=e,newEmailObj.insertModel3()}})}})},uploadFujian:function(e,a,t){$("#form_file").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);a<1?(a=1024*a,a+="KB"):a+="MB";var n="http://"+t.data,i='<li data-url="'+n+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+e+'</span> <span class="att-size">( '+a+' )</span> <span class="removeLi">删除</span><span class="previewEml">预览</span></li>';$("#added-files").show().prepend(i)}}).submit()},uploadImg:function(e,a){$("#form_img").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var a="http://"+e.data;UE.getEditor("sendEditor").execCommand("insertimage",{src:a,width:"300"})}}).submit()},fileLimit:function(e){var a=!0,t=e.prop("files"),n=Math.round(t[0].size/1024*100)/100/1024;return n>20&&($.Alert("上传附件需小于20MB"),a=!1),{flag:a,name:t[0].name,size:n}},huifuEmail:function(e){var a={id:emailId};$.ajax({url:Base.sitUrl+"/api/email/inbox/v1/detail",type:"GET",data:a,success:function(e){if(!e.success)return void $.unLogin(e);var a=e.data,t=a.ccs,n="RE:"+a.subject,i="Fw:"+a.subject,d="",s="",l="",o="";if(t.length>0)for(var r=0;r<t.length;r++)s+=null!=t[r].name&&""!=t[r].name?'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b>'+t[r].name+"</b><span>&lt;"+t[r].value+"&gt;</span><span class=fh>;<span><div></div>":'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b></b><span>&lt;'+t[r].value+"&gt;</span><span class=fh>;<span><div></div>";for(var r=0;r<a.tos.length;r++)l+=a.tos[r].value+";";for(var r=0;r<a.froms.length;r++)o+=a.froms[r].value+";";var c='<div style="margin-top: 0px; margin-bottom: 0px; margin-left: 0.5em;"><div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm"><div style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; FONT-SIZE: 14px;FONT-FAMILY:tahoma;COLOR:#000000; BACKGROUND: #efefef; PADDING-BOTTOM: 8px; PADDING-TOP: 8px"><p></p><p></p><p style="margin:0;padding:2px 5px;background:#eee;font-size:12px"><b>From:</b>'+o+'</p><p style="margin:0;padding:2px 5px;background:#eee;font-size:12px"><b>Date:</b>'+a.sendTime+'</p><p style="margin:0;padding:2px 5px;background:#eee;font-size:12px"><b>To:</b>'+l+'</p><p style="margin:0;padding:2px 5px;background:#eee;font-size:12px"><b>Subject:</b>'+a.subject+"</p><p></p></div></div></div>";if(0==hflx)d=null!=a.froms[0].name&&""!=a.froms[0].name?'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b>'+a.froms[0].name+"</b><span>&lt;"+a.froms[0].value+"&lt;</span><span class=fh>;<span><div></div>":'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b></b><span>&lt;'+a.froms[0].value+"&gt;</span><span class=fh>;<span><div></div>",$("#divtxt").find(".addrcontainer").append(d);else if(1==hflx)d=null!=a.froms[0].name&&""!=a.froms[0].name?'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b>'+a.froms[0].name+"</b><span>&lt;"+a.froms[0].value+"&gt;</span><span class=fh>;<span><div></div>":'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b></b><span>&lt;'+a.froms[0].value+"&gt;</span><span class=fh>;<span><div></div>",$("#sendTheme").val(n),$("#divtxt").find(".addrcontainer").append(d).append(s),UE.getEditor("sendEditor").ready(function(){UE.getEditor("sendEditor").setContent(c,!0),UE.getEditor("sendEditor").setContent(a.content,!0)});else if(2==hflx)$("#sendTheme").val(i),UE.getEditor("sendEditor").ready(function(){UE.getEditor("sendEditor").setContent(c,!0),UE.getEditor("sendEditor").setContent(a.content,!0)});else if(3==hflx)d=null!=a.froms[0].name&&""!=a.froms[0].name?'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b>'+a.froms[0].name+"</b><span>&lt;"+a.froms[0].value+"&gt;</span><span class=fh>;<span><div></div>":'<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="'+emailId+'"><b></b><span>&lt;'+a.froms[0].value+"&gt;</span><span class=fh>;<span><div></div>",$("#sendTheme").val(n),$("#divtxt").find(".addrcontainer").append(d).append(s),UE.getEditor("sendEditor").ready(function(){UE.getEditor("sendEditor").setContent(a.content,!0),UE.getEditor("sendEditor").setContent(c,!0),UE.getEditor("sendEditor").setContent(a.content,!0)});else if(10==hflx){var p=$.GetQueryString("data");newEmailfujian(p)}}})}};newEmailObj.addressList(),newEmailObj.contactsList();var editerH=$("html").height()-280,editors={head:null,foot:null,type:null,createEditor:function(){var e=[["fontfamily","fontsize","forecolor","backcolor","|","bold","italic","|","underline","formatmatch","insertorderedlist","insertunorderedlist","justifyleft","justifyright","justifycenter","justifyjustify","|","link","unlink","inserttable","fullscreen","cleardoc","emotion"]];editors.main=UE.getEditor("sendEditor",{toolbars:e,autoHeightEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:editerH})}};editors.createEditor(),$("#added-files").on("click",".removeLi",function(){$(this).parents("li").remove()}),$("#added-files").on("click",".previewEml",function(){var e=$(this).parents("li").attr("data-url"),a=$(this).prev().prev().prev().text(),t=e.lastIndexOf("."),n=e.substring(t,e.length).toUpperCase();if(".PNG"==n||".JPG"==n||".JPEG"==n||".SVG"==n||".GIF"==n)var i='<img src="'+e+'" alt="" class="previewImg previewContent">';else if(".TXT"==n||".JS"==n||".CSS"==n)var i='<iframe src="'+e+'" frameborder="0" class="previewIframe previewContent"></iframe>';else{if(".DOC"!=n&&".DOCX"!=n&&".XLS"!=n&&".XLSX"!=n&&".ET"!=n&&".PPT"!=n&&".PPTX"!=n&&".WPS"!=n&&".ZIP"!=n&&".RAR"!=n&&".7Z"!=n&&".PDF"!=n)return void $.Alert(n.toLowerCase()+"格式暂不支持预览");var d=Base.sitUrl+"/api/export/v1/file/preview?data={file: '"+e+"'}",i='<iframe src="'+d+'" frameborder="0" class="previewIframe previewContent"></iframe>'}$("#preview").find("h3").text(a),$("#preview").find(".previewContent").remove(),$("#preview").append(i).show()}),$("#previewClose").on("click",function(){$("#preview").hide().find(".previewContent").remove()}),$("#piInput .btn").on("click",function(){var e=$("#piInput").find("input[type=text]").val();newEmailObj.insertModelPi(e)}),$("#piInput input").on("keyup",function(e){if("13"==e.keyCode){var a=$(this).val();newEmailObj.insertModelPi(a)}}),$("#quoteInput .btn").on("click",function(){var e=$("#quoteInput").find("input[type=text]").val();newEmailObj.insertModel3(e)}),$("#quoteInput input[type=text]").unbind("click").on("keyup",function(e){if("13"==e.keyCode){var a=$(this).val();newEmailObj.insertModel3(a)}}),$("#pdtInput1 .btn").on("click",function(){var e=$("#pdtInput1").find("input[type=text]").val();newEmailObj.insertModelPdt(e)}),$("#pdtInput1 input").on("keyup",function(e){if(13==e.keyCode){var a=$(this).val();newEmailObj.insertModelPdt(a)}}),$("#pdtGroup").on("change",function(){var e=$(this).find("option:selected").val(),a=$("#pdtInput1").find("input[type=text]").val();""==e&&(e=0),newEmailObj.insertModelPdt(a,e)}),$("#pdtSelect1,#pdtSelect2,#pdtSelect3,#pdtSelect4").on("change",function(){var e=$("#pdtGroup").find("option:selected").val(),a=$(this).find("option:selected").val(),t=$("#pdtInput1").find("input[type=text]").val();""==a&&(a=0),""==e&&(e=0),newEmailObj.insertModelPdt(t,e,a)}),$("#pdtSelect1").on("change",function(){var e=$("#pdtSelect1 option:selected").val();$.ajax({url:Base.sitUrl+"/api/product/v1/product/type/sublist?pid="+e,type:"GET",dataType:"json",success:function(a){if(!a.success)return void $.unLogin(a);for(var t=a.data,n="",i=0;i<t.length;i++)n+='<option value="'+t[i].id+'">'+t[i].name+"</option>";$("#pdtSelect2").empty().append('<option value="'+e+'">全部</option>').append(n)}})}),$("#pdtSelect2").on("change",function(){var e=$("#pdtSelect2 option:selected").val();$.ajax({url:Base.sitUrl+"/api/product/v1/product/type/sublist?pid="+e,type:"GET",dataType:"json",success:function(a){if(!a.success)return void $.unLogin(a);for(var t=a.data,n="",i=0;i<t.length;i++)n+='<option value="'+t[i].id+'">'+t[i].name+"</option>";$("#pdtSelect3").empty().append('<option value="'+e+'">全部</option>').append(n)}})}),$("#pdtSelect3").on("change",function(){var e=$("#pdtSelect3 option:selected").val();$.ajax({url:Base.sitUrl+"/api/product/v1/product/type/sublist?pid="+e,type:"GET",dataType:"json",success:function(a){if(!a.success)return void $.unLogin(a);for(var t=a.data,n="",i=0;i<t.length;i++)n+='<option value="'+t[i].id+'">'+t[i].name+"</option>";$("#pdtSelect4").empty().append('<option value="'+e+'">全部</option>').append(n)}})});var h=$(".sentbox-left").height();if($(".rightShow, .sentbox-right").height(h-40),$(".rightShow").on("click",function(){var e=$("#addEmailNew").width();if($(".sentbox-right").hasClass("none")){var a=e-220;$(".sentbox-left").animate({width:a+"px"}),$(".sentbox-right").animate({width:"180px",opacity:"1"},"fast").removeClass("none"),$(".leftIcon").css("transform","rotate(90deg)")}else{var t=e-21;$(".sentbox-left").animate({width:t+"px"}),$(".sentbox-right").animate({width:"0",opacity:"0"},"fast").addClass("none"),$(".leftIcon").css("transform","rotate(-90deg)")}}),hflx&&newEmailObj.huifuEmail(),11==typeCloud){var data=$.GetQueryString("data");data=eval("("+data+")");for(var html="",i=0;i<data.length;i++){var filename=data[i].name,url=data[i].value;html+='<li data-url="'+url+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+filename+'</span><span class="removeLi">删除</span><span class="previewEml">预览</span></li>'}$("#added-files").show().prepend(html)}if(1==typeTask&&"null"!==emailTask&&""!==emailTask){var html='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="undefined"><b></b><span>&lt;'+emailTask+'&gt;</span><span class="fh">;<span><div></div></span></span></div></div>';$("#divtxt").find(".addrcontainer").append(html)}if(""!==customerName&&null!==customerName){var html='<div class="addr-outer"><div class="one" contenteditable="false" data-type="0" data-id="undefined"><b></b><span>&lt;'+customerName+'&gt;</span><span class="fh">;<span><div></div></span></span></div></div>';$("#divtxt").find(".addrcontainer").append(html)}settingEmail();var message=location.href;message.match("showType=right")&&($(".rightShow").click(),$("body").css("background","#fff"),$("#addEmailNew").css("border-top","none")),showbtn(),window.saveDraft=function(e){var a=UE.getEditor("sendEditor").getContent(),t=$("#sendTheme").val();if(a==startContent&&startTheme==t)top.window.checkActive(e),$("#mainIframe",top.document).attr("src",Base.sitUrl+"/html"+e.substring(1));else{var n='<div id="confirm_Modal" class="modal" aria-hidden="true" role="basic" tabindex="-1" style="z-index:100001!important;"><div class="modal-dialog" style="width: 300px;margin-top:140px;"><div class="modal-content"><div class="modal-header">  <h4 class="modal-title" style="text-align:left;">提示</h4></div><div class="modal-body">是否要将此邮件保存草稿？</div><div class="modal-footer"><button class="btn btn-primary" data-dismiss="modal" id="okDopConfirmButton1" type="button">是</button><button class="btn btn-primary" data-dismiss="modal" id="destoryDopConfirmButton1" type="button">否</button><button class="btn default" type="button" id="cotinueEdit">取消</button></div></div></div></div>';$("#confirm_Modal").remove(),$("body").append(n),$("#confirm_Modal").modal("show"),$("#okDopConfirmButton1").click(function(){var a=newEmailInfomation(12);if(a.flag)return newEmailObj.operationEmail(a.obj,"/api/email/v1/draft/save",e)}),$("#cotinueEdit").click(function(){$("#confirm_Modal").modal("hide")}),$("#destoryDopConfirmButton1").click(function(){top.window.checkActive(e),$("#confirm_Modal").modal("hide"),$("#mainIframe",top.document).attr("src",Base.sitUrl+"/html"+e.substring(1))})}}})});