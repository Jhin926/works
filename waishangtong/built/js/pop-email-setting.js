require(["common"],function(){require(["maintab","ZeroClipboard","ueditorLang","blockUI","jqform","evol"],function(maintab,ZeroClipboard){function fastText(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/qtexts/search",type:"GET",success:function(e){if(!e.success)return void $.unLogin(e);for(var t=e.data,a="",i=0;i<t.length;i++)a+='<li data-value="'+t[i].value+'">'+t[i].name+"</li>";$(".textDwon").empty().append(a)}})}function uploadFujian(e){$("#form_file").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(t){if(!t.success)return void $.unLogin(t);var a="http://"+t.data,i='<li data-url="'+a+'"><i class="pub-icon fujian-excl-iocn"></i><span>'+e+'</span> <span class="file-del">删除</span></li>';$("#added-files").show(),$("#added-files").css("display","inline-block"),$("#added-files").prepend(i)}}).submit()}function uploadImg(e){$("#form_img").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var t="http://"+e.data;UE.getEditor("szidonghuifuEditor").execCommand("insertimage",{src:t,width:"300"})}}).submit()}function uploadImg1(e){$("#form_img1").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var t="http://"+e.data;UE.getEditor("modelSetEditor").execCommand("insertimage",{src:t,width:"300"})}}).submit()}function uploadImg3(e){$("#form_img3").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);var t="http://"+e.data;UE.getEditor("qianmingEditor").execCommand("insertimage",{src:t,width:"300"})}}).submit()}function insertModel(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/templates/search",type:"GET",success:function(e){if(!e.success)return void $.unLogin(e);for(var t=e.data,a="",i=0;i<t.length;i++)a+='<li data-value="'+t[i].value+'">'+t[i].name+"</li>";$(".modelDwon").empty().append(a)}})}function fileLimit(e){var t=!0,a=e.prop("files"),i=Math.round(a[0].size/1024*100)/100/1024;return i>1&&($.Alert("上传附件需小于1MB"),t=!1),{flag:t,name:a[0].name}}function normalRe(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/config/get",type:"POST",dataType:"json",cache:!1,success:function(e){if(!e.success)return void $.Alert(e.message);var t=e.data;if($.ajax({url:Base.sitUrl+"/api/email/setting/v1/templates/search",type:"POST",async:!1,dataType:"json",cache:!1,success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i='<option data-id="'+t[a].id+'" value="'+t[a].name+'">'+t[a].name+"</option>";$("#defaultTemplate").append(i)}}}),""==t||void 0==t||null==t)$("#receiveInterval").val(),$("#nickname").val(),$("#defaultCc").val(),$("#defaultBcc").val();else{$("#receiveInterval").val(t.receiveInterval),$("#font-family option[value="+t.fontStyle+"]").attr("selected","selected"),$("#font-size option[value="+t.fontSize+"]").attr("selected","selected"),$(".color-show").css("background",t.fontColour),$(".cpOther").val(t.fontColour),$("#nickname").val(t.nickname),$("#defaultCc").val(t.defaultCc),$("#defaultBcc").val(t.defaultBcc);for(var a=0;a<$("#defaultTemplate").find("option").length;a++)$("#defaultTemplate").find("option").eq(a).attr("data-id")==t.defaultTemplate&&$("#defaultTemplate").find("option").eq(a).attr("selected","selected")}}})}function groupRe(){$("#group-set ul").children("li").remove(),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/group/get",dataType:"json",type:"POST",cache:!1,success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i=(t[a].name.substring(0,1),'<li data-id="'+t[a].id+'" data-type=""><i class="iconfont group-move"></i><input type="text" class="resource-input" value="'+t[a].name+'" placeholder=""><i class="delet-icon"></i></li>');$("#group-set ul").append(i)}}})}function signRe(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/signature/get",dataType:"json",type:"POST",success:function(e){if(!e.success)return void $.Alert(e.message);var t=e.data,a=t.signature.replace(/&#39;/g,'"');$("#sign-set").attr("data-id",t.id),setContent(a),1==t.isUsing?$("#sign-checkbox").parent("span").attr("class","checked"):$("#sign-checkbox").parent("span").attr("class","")}})}function qtextRe(){$("#qtext ul").children("li").remove(),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/qtexts/search",dataType:"json",type:"POST",success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i='<li data-id="'+t[a].id+'"><input type="text" class="fasttText-t" value="'+t[a].name+'"><textarea class="fasttText" placeholder="感谢您的询盘">'+t[a].value+'</textarea><i class="delet-icon" style="top:-25px;"></i></li>';$("#qtext ul").append(i)}}})}function temRe(){$("#tem-set .table tbody tr").remove(),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/templates/search",type:"POST",dataType:"json",success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){t[a].value=t[a].value.replace(/&#39;/g,'"');var i='<tr data-id="'+t[a].id+'"><td><label class="ashen temName">'+t[a].name+'</label></td><td class="content">'+t[a].value+'</td><td><a href="#" class="ashen temClose">删除</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" class="ashen temEdit">编辑</a></td></tr>';$("#tem-set .table tbody").append(i)}}})}function blacklistRe(){$("#blacklist-set ul").children("li").remove(),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/blacklist/get",dataType:"json",type:"POST",success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i='<li data-id="'+t[a].id+'"><input type="text" class="resource-input" value="'+t[a].content+'" placeholder=""><i class="delet-icon"></i></li>';$("#blacklist-set ul").append(i)}}})}function autoresRe(){$("#auto-res .table tbody tr").remove(),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/get",type:"POST",dataType:"json",data:{executeType:2},success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i="";1==t[a].isOpen?(i="已开启",isClose="关闭"):(i="已关闭",isClose="开启");var n='<tr data-id="'+t[a].id+'"><td>'+i+'</td><td class="td-content">'+t[a].executeContent+'</td><td class="td-condition">'+t[a].condition+'</td><td class="td-conditionMeetType">'+t[a].conditionMeetType+'</td><td data-id="'+t[a].id+'" class="autoName">'+t[a].name+'</td><td><button class="btn btn-link auto-edit" type="button">修改</button><button class="btn btn-link caozuo-btn auto-close" type="button">删除</button><button class="btn btn-link caozuo-btn auto-open" type="button">'+isClose+"</button></td></tr>";$("#auto-res .table tbody").append(n)}}})}function autoEdit(e){e+="",getContent(),autoText=autoText.replace(/"/g,"&#39;");for(var t="",a=0;a<$("#auto-res .conditions").length;a++){var i=$("#auto-res .conditions").eq(a).find("input").val(),n=$("#auto-res .conditions").eq(a).find(".typeName option:selected").val(),o=$("#auto-res .conditions").eq(a).find(".isOpen option:selected").val();t+='{"name":"'+n+'","value":"'+i+'","isInclude":'+o+"},"}t=t.substring(0,t.length-1);var n=$("#auto-res-name").val(),s=$("#auto-res .select-erji option:selected").val(),l='{"id":"'+e+'","userEmail":1,"name":"'+n+'","triggerEvent": 1,"conditionMeetType":'+s+',"executeType": 2,"executeContent":"'+autoText+'","emailRuleConditions":['+t+"]}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/setting",type:"POST",dataType:"json",data:{data:l},success:function(e){return e.success?($("#add-re-one").show(),$("#add-re-two").hide(),void autoresRe()):void $.Alert(e.message)}})}function addRules(){$("#add-rule .table tbody tr").remove(),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/get",type:"POST",dataType:"json",data:{executeType:1},success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i="";1==t[a].isOpen?(i="已开启",isClose="关闭"):(i="已关闭",isClose="开启");var n='<tr data-id="'+t[a].id+'"><td>'+i+'</td><td class="td-content">'+t[a].executeContent+'</td><td class="td-condition">'+t[a].condition+'</td><td class="td-conditionMeetType">'+t[a].conditionMeetType+'</td><td data-id="'+t[a].id+'" class="autoName">'+t[a].name+'</td><td><button class="btn btn-link add-rule-edit" type="button">修改</button><button class="btn btn-link caozuo-btn auto-close" type="button">删除</button><button class="btn btn-link caozuo-btn auto-open" type="button">'+isClose+"</button></td></tr>";$("#add-rule .table tbody").append(n)}}})}function ruleEdit(e){e+="";var t="",a="";if($("#add-rule .conditions").length<1)return void $.Alert("请填写条件内容");for(var i=0;i<$("#add-rule .conditions").length;i++){var n=$("#add-rule .conditions").eq(i).find("input").val(),o=$("#add-rule .conditions").eq(i).find(".typeName option:selected").val(),s=$("#add-rule .conditions").eq(i).find(".isOpen option:selected").val();if(t+='{"name":"'+o+'","value":"'+n+'","isInclude":'+s+"},",""==n)return void $.Alert("请填写条件内容")}if($("#add-rule .select-group").length<1)return void $.Alert("请填写动作内容");for(var l=0;l<$("#add-rule .select-group").length;l++)if(a+=$("#add-rule .select-group").eq(l).find("option:selected").attr("data-id")+";",""==$("#add-rule .select-group").eq(l).find("option:selected").attr("data-id"))return void $.Alert("请填写动作内容");t=t.substring(0,t.length-1),a=a.substring(0,a.length-1);var o=$("#add-rule-name").val();if(""==o)return void $.Alert("请填写规则名称");var d=$("#add-rule .select-erji option:selected").val(),r='{"id":"'+e+'","name":"'+o+'","triggerEvent": 1,"conditionMeetType":'+d+',"executeType": 1,"executeContent":"'+a+'","emailRuleConditions":['+t+"]}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/setting",type:"POST",dataType:"json",data:{data:r},success:function(e){return e.success?($("#add-rule-one").show(),$("#add-rule-two").hide(),void addRules()):void $.Alert(e.message)}})}function getContent(){var e=[],t=[],a=[];e.push(qianming.getContent()),t.push(modelSet.getContent()),a.push(autoRes.getContent()),contentText=e.join("\n"),temText=t.join("\n"),autoText=a.join("\n")}function setContent(e){qianming.setContent(e)}function temSetContent(e){modelSet.setContent(e)}function autoResContent(e){autoRes.setContent(e)}function uploadFujianEmail(e,t,a){$("#form_fileEmail").ajaxForm({url:Base.sitUrl+"/api/file/upload",beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(i){if(!i.success)return void $.unLogin(i);var n="http://"+i.data,o='<li data-url="'+n+'"><div class="media"><div class="media-left"><img class="media-object" src="../images/excel-icon.jpg" alt="..."></div><div class="media-body"><h4 class="media-heading">'+e+'</h4><span data-size="'+a+'">'+t+'</span></div><i class="i-remove file-del"></i></div></li>';$("#uploadEmailList").prepend(o)}}).submit()}function fileLimitEmail(e){var t=!0,a=e.prop("files"),i=Math.round(a[0].size),n=Math.round(a[0].size/1024*100)/100/1024,o="MB";return n>50&&($.Alert("上传文件需小于50MB"),t=!1),n<1&&(n=Math.round(a[0].size/1024*100)/100,o="KB"),n=n.toFixed(2)+o,{flag:t,name:a[0].name,size:n,dataSize:i}}function uploadEmail(e){$.ajax({url:Base.sitUrl+"/api/email/v1/import/task/save",type:"POST",dataType:"json",data:{data:JSON.stringify(e)},beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){return e.success?(uploadEmailList(),void $("#uploadEmailList").empty()):void $.unLogin(e)}})}function uploadEmailList(){$.ajax({url:Base.sitUrl+"/api/email/v1/import/task/list",type:"POST",dataType:"json",data:{data:"{}"},beforeSend:function(){$.BlockUI()},complete:function(){$.UnblockUI()},success:function(e){if(!e.success)return void $.unLogin(e);for(var t=e.data,a="",i=0;i<t.length;i++){if(1==t[i].emailCatelog)var n="收件箱";else if(0==t[i].emailCatelog)var n="发件箱";a+='<tr data-id="'+t[i].id+'" data-emailCatelog="'+t[i].emailCatelog+'" data-url="'+t[i].url+'">                                    <td><span class="file-name ellipsis">'+t[i].fileName+"</span></td>                                    <td>"+n+"</td>                                    <td>"+t[i].status+"</td>                                    <td>"+t[i].errMsg+"</td>                                    <td>"+t[i].updateTime+"</td>                                </tr>"}$("#uploadEmailTable tbody").empty().append(a)}})}window.ZeroClipboard=ZeroClipboard;var taskId=$.GetQueryString("taskId"),targetType=0;$(".select-font-color").on("click",function(e){$(this).find(".cpOther").colorpicker({showOn:"none"}),e.stopImmediatePropagation(),$(this).find(".cpOther").colorpicker("showPalette"),$(this).find(".cpOther").on("change.color",function(e,t){$(".color-show").css("background",t)})}),$("#setLeftNav>li").bind("click",function(){if(!$(this).hasClass("current")){$(this).addClass("current").siblings().removeClass("current");var e=$(this).index();$(".rightShowList").eq(e).addClass("activities").siblings().removeClass("activities")}}),$("#add-model-btn").on("click",function(){$("#add-model-one").hide(),$("#add-model-two").show()}),$(".glyphicon-menu-left").on("click",function(){$("#add-model-one").show(),$("#add-model-two").hide()}),$("#add-rule-btn").on("click",function(){$("#add-rule-one").hide(),$("#add-rule-two").show()}),$(".glyphicon-menu-left").on("click",function(){$("#add-rule-one").show(),$("#add-rule-two").hide()}),$("#add-re-btn").on("click",function(){$("#add-re-one").hide(),$("#add-re-two").show()}),$(".glyphicon-menu-left").on("click",function(){$("#add-re-one").show(),$("#add-re-two").hide()}),$(".add-attachment").on("click",function(){return $("#form_file input[name=upFiles]").click()}),$("#form_file input[name=upFiles]").on("change",function(e){$.EventFn(e);var t=fileLimit($(this));t.flag&&uploadFujian(t.name)}),$(".add-files").on("click",".add-text",function(e){$.EventFn(e),$(".textDwon").slideToggle("slow"),fastText()}),$(".add-files").on("click",".add-text>.textDwon>li",function(e){$.EventFn(e);var t=$(this).attr("data-value");UE.getEditor("szidonghuifuEditor").execCommand("inserthtml",t),$(".textDwon").hide()}),$(document).on("click",".file-del",function(){$(this).parents("li").remove()}),$(".add-images").click(function(){$(this).parent().siblings(".form-horizontal").find("input[name=upImgs]").click(),$(this).parent().siblings(".form-horizontal").find("input[name=upImgs]").on("change",function(e){$.EventFn(e);var t=fileLimit($(this));t.flag&&uploadImg(t.name)})}),$(".add-images1").click(function(){$(this).parent().siblings(".form-horizontal").find("input[name=upImgs]").click(),$(this).parent().siblings(".form-horizontal").find("input[name=upImgs]").on("change",function(e){$.EventFn(e);var t=fileLimit($(this));t.flag&&uploadImg1(t.name)})}),$(".add-images3").click(function(){$(this).parent().siblings(".form-horizontal").find("input[name=upImgs]").click(),$(this).parent().siblings(".form-horizontal").find("input[name=upImgs]").on("change",function(e){$.EventFn(e);var t=fileLimit($(this));t.flag&&uploadImg3(t.name)})}),$(".add-files").on("click",".add-model",function(e){$.EventFn(e),$(".modelDwon").slideToggle(),insertModel()}),$(".add-files").on("click",".add-model>.modelDwon>li",function(e){$.EventFn(e);var t=$(this).attr("data-value");UE.getEditor("szidonghuifuEditor").execCommand("inserthtml",t),$(".modelDwon").hide()}),$(".add-files").on("click",".add-model1",function(e){$.EventFn(e),$(".modelDwon").slideToggle(),insertModel()}),$(".add-files").on("click",".add-model1>.modelDwon>li",function(e){$.EventFn(e);var t=$(this).attr("data-value");UE.getEditor("modelSetEditor").execCommand("inserthtml",t),$(".modelDwon").hide()});var editors={qianming:null,zidonghuifu:null,zidonghuifus:null,modelSet:null,type:null,toolbars:[["fontfamily","fontsize","forecolor","backcolor","|","bold","italic","|","underline","formatmatch","insertorderedlist","insertunorderedlist","justifyleft","justifyright","justifycenter","justifyjustify","|","link","unlink","inserttable","fullscreen","cleardoc","emotion"]],createEditor:function(){editors.qianming=UE.getEditor("qianmingEditor",{toolbars:editors.toolbars,initialFrameWidth:"100%",initialFrameHeight:200}),editors.zidonghuifus=UE.getEditor("szidonghuifuEditor",{toolbars:editors.toolbars,initialFrameWidth:"100%",initialFrameHeight:200}),editors.modelSet=UE.getEditor("modelSetEditor",{toolbars:editors.toolbars,initialFrameWidth:"100%",initialFrameHeight:200})}};editors.createEditor();var qianming=UE.getEditor("qianmingEditor",{}),modelSet=UE.getEditor("modelSetEditor",{}),autoRes=UE.getEditor("szidonghuifuEditor",{});$("#receiveInterval").bind("change",function(){var e=$(this).val();(e>60||e<5)&&($.Alert("自动接受间隔时间范围为5-60分钟"),$(this).val(""))}),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/config/get",type:"POST",dataType:"json",cache:!1,success:function(e){if(!e.success)return void $.Alert(e.message);var t=e.data;if($.ajax({url:Base.sitUrl+"/api/email/setting/v1/templates/search",type:"POST",async:!1,dataType:"json",cache:!1,success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i='<option data-id="'+t[a].id+'" value="'+t[a].name+'">'+t[a].name+"</option>";$("#defaultTemplate").append(i)}}}),""==t||void 0==t||null==t)$("#receiveInterval").val("5"),$("#nickname").val(),$("#defaultCc").val(),$("#defaultBcc").val(),$("#normolset-save").on("click",function(){var e=$("#receiveInterval").val(),t=$("#normolset .sf-set-info").find("input[name=1]:checked").attr("data-radio"),a=$("#font-family").val(),i=$("#font-size").val(),n=$(".cpOther").val(),o=$("#nickname").val(),s=$("#isSpelling").checked?1:2,l=$("#defaultCc").val(),d=$("#defaultBcc").val(),r=$("#defaultTemplate").find("option:selected").attr("data-id"),c='{"receiveInterval":'+e+',"replyForwardPrefixStyle":'+t+',"fontStyle":"'+a+'","fontSize":"'+i+'","fontColour":"'+n+'","nickname":"'+o+'","isSpelling":'+s+',"defaultCc":"'+l+'","defaultBcc":"'+d+'","defaultTemplate":'+r+"}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/config/setting",type:"POST",dataType:"json",cache:!1,data:{data:c},success:function(e){return e.success?($.Alert("保存成功！"),void normalRe()):void $.unLogin(e)}})});else{$("#receiveInterval").val(t.receiveInterval),$("#font-family option[value="+t.fontStyle+"]").attr("selected","selected"),$("#font-size option[value="+t.fontSize+"]").attr("selected","selected"),$(".color-show").css("background",t.fontColour),$(".cpOther").val(t.fontColour),$("#nickname").val(t.nickname),$("#defaultCc").val(t.defaultCc),$("#defaultBcc").val(t.defaultBcc),1==t.replyForwardPrefixStyle?($("#radio1").parent("span").attr("class","checked"),$("#radio2").parent("span").attr("class","")):($("#radio1").parent("span").attr("class",""),$("#radio2").parent("span").attr("class","checked")),1==t.isSpelling?$("#isSpelling").parent("span").attr("class","checked"):$("#isSpelling").parent("span").attr("class",""),0==t.defaultCcOpend?$("#copyTo").parent("span").attr("class","checked"):$("#copyTo").parent("span").attr("class",""),0==t.defaultBccOpend?$("#bcCopy").parent("span").attr("class","checked"):$("#bcCopy").parent("span").attr("class","");for(var a=0;a<$("#defaultTemplate").find("option").length;a++)$("#defaultTemplate").find("option").eq(a).attr("data-id")==t.defaultTemplate&&$("#defaultTemplate").find("option").eq(a).attr("selected","selected");$("#normolset-save").on("click",function(){var e=$("#receiveInterval").val(),a=$("#normolset .sf-set-info").find("input[name=1]:checked").attr("data-radio"),i=$("#font-family").val(),n=$("#font-size").val(),o=$(".cpOther").val(),s=$("#nickname").val(),l="checked"==$("#isSpelling").parent("span").attr("class")?1:2,d="checked"==$("#copyTo").parent("span").attr("class")?0:1,r="checked"==$("#bcCopy").parent("span").attr("class")?0:1,c=$("#defaultCc").val(),u=$("#defaultBcc").val(),p=$("#defaultTemplate").find("option:selected").attr("data-id"),f='{"id":'+t.id+',"receiveInterval":'+e+',"replyForwardPrefixStyle":'+a+',"fontStyle":"'+i+'","fontSize":"'+n+'","fontColour":"'+o+'","nickname":"'+s+'","isSpelling":'+l+',"defaultCc":"'+c+'","defaultBcc":"'+u+'","defaultTemplate":'+p+',"defaultCcOpend":'+d+',"defaultBccOpend":'+r+"}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/config/setting",type:"POST",dataType:"json",cache:!1,data:{data:f},success:function(e){return e.success?($.Alert("保存成功！"),void normalRe()):void $.unLogin(e)}})})}}}),$(".addGroup").on("click",function(){var e='<li data-id="" data-type="1"><i class="iconfont group-move"></i><input type="text" class="resource-input" name=""><i class="delet-icon"></li>';$(this).parent("div").prev(".blacklist").append(e)}),$("#group-set-li").on("click",function(){groupRe()}),$(document).on("click","#group-set .delet-icon",function(){var e=$(this).parent().attr("data-id");$.Confirm("确认删除？","",function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/group/delete",dataType:"json",type:"POST",data:{id:e},success:function(e){return e.success?($.Alert("删除成功！"),void groupRe()):void $.Alert(e.message)}})})}),$("#group-set-save").on("click",function(){for(var e=$("#group-set ul").children("li"),t="",a=0;a<e.length;a++){var i=e.eq(a).find("input[type=text]").val(),n=e.eq(a).attr("data-id");if(t+=""==n?'{"value": "'+i+'"},':'{"id":'+n+',"value": "'+i+'"},',""==i)return void $.Alert("名称不能为空！")}t=t.substr(0,t.length-1);var o='{"valueEnters":['+t+"]}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/group",dataType:"json",type:"POST",data:{data:o},success:function(e){return e.success?($.Alert("保存成功！"),void groupRe()):void $.Alert(e.message)}})}),$("#sign-set-li").on("click",function(){signRe()}),$("#sign-set-save").on("click",function(){var e=$("#sign-set").attr("data-id");if(""==e||null==e||void 0==e)var t="";else var t='"id":'+e+",";var a="";a="checked"==$("#sign-checkbox").parent("span").attr("class")?1:2,getContent();var i=contentText;i=i.replace(/"/g,"&#39;");var n="{"+t+'"signature":"'+i+'","isUsing":'+a+"}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/signature/setting",dataType:"json",type:"POST",data:{data:n},success:function(e){return e.success?void $.Alert("保存成功！"):void $.Alert(e.message)}})}),$("#qtextAdd").on("click",function(){var e='<li data-id=""><input type="text" class="fasttText-t" value="快速文本"><textarea class="fasttText" placeholder="感谢您的询盘"></textarea><i class="delet-icon" style="top:-25px;"></i></li>';$(this).parent("div").prev(".blacklist").append(e)}),$("#qtext-li").on("click",function(){qtextRe()}),$(document).on("click","#qtext .delet-icon",function(){var e=$(this).parent().attr("data-id");$.Confirm("确认删除？","",function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/qtext/delete",dataType:"json",type:"POST",data:{id:e},success:function(e){return e.success?($.Alert("删除成功！"),void qtextRe()):void $.Alert(e.message)}})})}),$("#qtext-save").on("click",function(){for(var e=$("#qtext ul").children("li"),t="",a=0;a<e.length;a++){var i=e.eq(a).find("input[type=text]").val();if(""==i)return void $.Alert("名称不能为空！");$.ajax({url:Base.sitUrl+"/api/email/setting/v1/qtext/is/exist",type:"POST",dataType:"json",async:!1,data:{keyword:i},success:function(n){if(!n.success)return void $.unLogin(n);if(null!=n.message)return $.Alert("快速文本名称不能相同"),!1;var o=e.eq(a).find("textarea").val(),s=e.eq(a).attr("data-id");t+=""==s?'{"name": "'+i+'","qtext":"'+o+'"},':'{"id":'+s+',"name": "'+i+'","qtext":"'+o+'"},'}})}if(t=t.substr(0,t.length-1),""==t)return void $.Alert("服务器异常");var n='{"emailQTextEnters":['+t+"]}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/qtext/setting",dataType:"json",type:"POST",data:{data:n},success:function(e){return e.success?($.Alert("保存成功！"),void qtextRe()):void $.Alert(e.message)}})}),$("#tem-li").on("click",function(){$("#add-model-one").show(),$("#add-model-two").hide(),temRe()}),$("#add-model-btn").on("click",function(){$("#tem-name").val("");var e="";temSetContent(e),$("#tem-add").on("click",function(){getContent(),temText=temText.replace(/"/g,"&#39;");var e=$("#tem-name").val(),t='{"name": "'+e+'","template": "'+temText+'"}';$.ajax({url:Base.sitUrl+"/api/email/setting/v1/template/setting",type:"POST",dataType:"json",data:{data:t},success:function(e){return e.success?($("#add-model-one").show(),$("#add-model-two").hide(),void temRe()):void $.Alert(e.message)}})})}),$(document).on("click",".temClose",function(){var e=$(this).parents("tr").attr("data-id");$.Confirm("确认删除？","",function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/template/delete",type:"POST",dataType:"json",data:{id:e},success:function(e){return e.success?void temRe():void $.Alert(e.message)}})})}),$(document).on("click",".temEdit",function(){$("#add-model-one").hide(),$("#add-model-two").show();var e=$(this).parents("tr").attr("data-id"),t=$(this).parents("tr").find(".temName").text();$("#tem-name").val(t);var a=$(this).parents("tr").find(".content").html();temSetContent(a),$("#tem-add").unbind("click").on("click",function(){getContent(),temText=temText.replace(/"/g,"&#39;");var t=$("#tem-name").val(),a='{"id":'+e+',"name": "'+t+'","template": "'+temText+'"}';$.ajax({url:Base.sitUrl+"/api/email/setting/v1/template/setting",type:"POST",dataType:"json",data:{data:a},success:function(e){return e.success?($("#add-model-one").show(),$("#add-model-two").hide(),void temRe()):void $.Alert(e.message)}})})}),$("#blacklist-set-li").on("click",function(){blacklistRe()}),$(document).on("click","#blacklist-set .delet-icon",function(){var e=$(this).parent().attr("data-id");$.Confirm("确认删除？","",function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/blacklist/delete",dataType:"json",type:"POST",data:{id:e},success:function(e){return e.success?($.Alert("删除成功！"),void blacklistRe()):void $.Alert(e.message)}})})}),$("#blacklist-set-save").on("click",function(){for(var e=$("#blacklist-set ul").children("li"),t="",a=0;a<e.length;a++){var i=e.eq(a).find("input[type=text]").val(),n=e.eq(a).attr("data-id"),o=0;if(o+="@"==i[0]?1:2,t+=""==n?'{"type": '+o+',"content":"'+i+'"},':'{"id":'+n+',"type": '+o+',"content":"'+i+'"},',""==i)return void $.Alert("名称不能为空！")}t=t.substr(0,t.length-1);var s='{"emailBlacklistEnters":['+t+"]}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/blacklist/setting",dataType:"json",type:"POST",data:{data:s},success:function(e){return e.success?($.Alert("保存成功！"),void blacklistRe()):void $.Alert(e.message)}})}),$("#auto-res-li").on("click",function(){$("#add-re-one").show(),$("#add-re-two").hide(),autoresRe()});var listConditions='<div class="sf-set-info conditions" style="margin-left:2px;"><select class="select-font typeName" style="width: 190px;margin-left:0;"><option value="from">发件人名称或邮件地址</option><option value="subject">主题</option><option value="content">全文</option><option value="to">收件人</option><option value="cc">抄送人</option></select> <select class="select-font isOpen" style="width: 100px;"><option value="1">包含</option><option value="0">不包含</option></select> <input type="text" style="width: 355px;"> <i class="delet-icon"></i></div>';$(".conditions-add").on("click",function(){$(this).parent().before(listConditions)}),$(document).on("click","#auto-res .delet-icon,#addressee-rules .delet-icon",function(){var e=$(this);$.Confirm("确认删除条件？","",function(){e.parents(".conditions").remove()})}),$(".removeAll").on("click",function(){var e=$(this);$.Confirm("确认清空条件？","",function(){e.parent().siblings(".conditions").remove()})}),$("#add-re-btn").on("click",function(){$("#auto-res-name").val("");var e="";autoResContent(e),$("#add-re-two").find(".conditions").remove(),$("#auto-res-save").unbind("click").on("click",function(){var e="";autoEdit(e)})}),$(document).on("click",".auto-close",function(){var e=$(this).parents("tr").attr("data-id");$.Confirm("确认删除？","",function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/delete",type:"POST",dataType:"json",data:{id:e},success:function(e){return e.success?void autoresRe():void $.Alert(e.message)}})})}),$(document).on("click","#auto-res .auto-open",function(){var e=$(this).parents("tr").attr("data-id"),t=$(this).text();"开启"==t?open=1:open=0;var a='{"id":'+e+',"isOpen":'+open+"}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/edit",type:"POST",dataType:"json",data:{data:a},success:function(e){return e.success?void autoresRe():void $.Alert(e.message)}})}),$(document).on("click",".auto-edit",function(){$("#add-re-one").hide(),$("#add-re-two").show();var e=$(this).parents("tr").attr("data-id"),t=$(this).parents("tr").find(".autoName").text();$("#auto-res-name").val(t);var a=$(this).parents("tr").find(".td-content").html();a=a.replace(/&#39;/g,'"'),autoResContent(a);var i=$(this).parents("tr").find(".td-condition").html(),n=JSON.parse(i),o=$(this).parents("tr").find(".td-conditionMeetType").text();$("#auto-res .select-erji option[value="+o+"]").attr("selected","selected"),$("#add-re-two").find(".conditions").remove();for(var s=0;s<n.length;s++){var l='<div class="sf-set-info conditions" style="margin-left:2px;"><select class="select-font typeName" style="width: 190px;margin-left:0;"><option value="from">发件人名称或邮件地址</option><option value="subject">主题</option><option value="content">全文</option><option value="to">收件人</option><option value="cc">抄送人</option></select> <select class="select-font isOpen" style="width: 100px;"><option value="1">包含</option><option value="0">不包含</option></select> <input type="text" style="width: 355px;" value="'+n[s].value+'"> <i class="delet-icon"></i></div>';$("#auto-res").find("#conditions-add").before(l),$("#auto-res .conditions").eq(s).find(".typeName option[value="+n[s].name+"]").attr("selected","selected"),$("#auto-res .conditions").eq(s).find(".isOpen option[value="+n[s].isInclude+"]").attr("selected","selected")}$("#auto-res-save").unbind("click").on("click",function(){autoEdit(e)})}),$("#addressee-rules-li").on("click",function(){$("#add-model-one").show(),$("#add-model-two").hide(),addRules()}),$("#add-rule-btn").on("click",function(){$("#add-rule-name").val(""),$("#add-rule-two").find(".conditions").remove(),$("#add-rule .conditions-add").parent().before(listConditions),$("#add-rule .select-group").parent().remove();var e='<div class="sf-set-info"><div type="text" style="width: 300px;float:left;margin-top:10px;border:1px solid #ddd;padding:8px;">分组到</div><select class="select-font select-group" style="width: 367px;"><option data-id="" value="0">分组到</option></select><i class="delet-icon"></i></div>';$("#add-rule .addAction").parent().before(e),$("#add-rule .select-group").find("option").remove(),$("#add-rule .select-group").append('<option data-id="" value="0">分组到</option>'),$.ajax({url:Base.sitUrl+"/api/email/setting/v1/group/get",type:"POST",dataType:"json",success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<t.length;a++){var i='<option data-id="'+t[a].id+'" value="'+t[a].name+'">'+t[a].name+"</option>";$("#add-rule .select-group").append(i)}}}),$("#addressee-rules-save").unbind("click").on("click",function(){var e="";ruleEdit(e)})}),$(document).on("click","#add-rule .select-group",function(){var e=$(this).val();e=0==e?"":$(this).val(),$(this).next("input").val(e)}),$("#add-rule .addAction").on("click",function(){var e='<div class="sf-set-info"><div type="text" style="width: 300px;float:left;margin-top:10px;border:1px solid #ddd;padding:8px;">分组到</div><select class="select-font select-group" style="width: 367px;"><option data-id="" value="0">分组到</option></select><i class="delet-icon"></i></div>';$(this).parent().before(e);var t=$(this);$.ajax({url:Base.sitUrl+"/api/email/setting/v1/group/get",type:"POST",dataType:"json",success:function(e){if(!e.success)return void $.Alert(e.message);for(var a=e.data,i=0;i<a.length;i++){var n='<option data-id="'+a[i].id+'" value="'+a[i].name+'">'+a[i].name+"</option>";t.parent().prev().find(".select-group").append(n)}}})}),$("#add-rule").on("click",".auto-close",function(){var e=$(this).parents("tr").attr("data-id");
$.Confirm("确认删除？","",function(){$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/delete",type:"POST",dataType:"json",data:{id:e},success:function(e){return e.success?void addRules():void $.Alert(e.message)}})})}),$("#add-rule").unbind("click").on("click",".delet-icon",function(){$(this).parents(".sf-set-info").remove()}),$(document).on("click","#add-rule .auto-open",function(){var e=$(this).parents("tr").attr("data-id"),t=$(this).text();"开启"==t?open=1:open=0;var a='{"id":'+e+',"isOpen":'+open+"}";$.ajax({url:Base.sitUrl+"/api/email/setting/v1/rule/edit",type:"POST",dataType:"json",data:{data:a},success:function(e){return e.success?void addRules():void $.Alert(e.message)}})}),$(document).on("click",".add-rule-edit",function(){$("#add-rule-one").hide(),$("#add-rule-two").show(),$("#add-rule .select-group").parent().remove();var id=$(this).parents("tr").attr("data-id"),name=$(this).parents("tr").find(".autoName").text();$("#add-rule-name").val(id);var condition=$(this).parents("tr").find(".td-condition").html(),conditionObj=JSON.parse(condition),content=$(this).parents("tr").find(".td-content").text();content="["+content.replace(/;/g,",")+"]",content=eval("("+content+")");for(var i=0;i<content.length;i++){var list='<div class="sf-set-info"><div type="text" style="width: 300px;float:left;margin-top:10px;border:1px solid #ddd;padding:8px;">分组到</div><select class="select-font select-group" style="width: 367px;"><option data-id="" value="0">分组到</option></select><i class="delet-icon"></i></div>';$("#add-rule .addAction").parent().before(list)}$.ajax({url:Base.sitUrl+"/api/email/setting/v1/group/get",type:"POST",dataType:"json",success:function(e){if(!e.success)return void $.Alert(e.message);for(var t=e.data,a=0;a<$("#add-rule .select-group").length;a++)for(var i=0;i<t.length;i++){var n='<option data-id="'+t[i].id+'" value="'+t[i].name+'">'+t[i].name+"</option>";$("#add-rule .select-group").eq(a).append(n),$("#add-rule .select-group").eq(a).find("option[data-id="+content[a]+"]").attr("selected","selected")}}});var conditionMeetType=$(this).parents("tr").find(".td-conditionMeetType").text();$("#add-rule .select-erji option[value="+conditionMeetType+"]").attr("selected","selected"),$("#add-rule-two").find(".conditions").remove();for(var i=0;i<conditionObj.length;i++){var listCond='<div class="sf-set-info conditions" style="margin-left:2px;"><select class="select-font typeName" style="width: 190px;margin-left:0;"><option value="from">发件人名称或邮件地址</option><option value="subject">主题</option><option value="content">全文</option><option value="to">收件人</option><option value="cc">抄送人</option></select> <select class="select-font isOpen" style="width: 100px;"><option value="1">包含</option><option value="0">不包含</option></select> <input type="text" style="width: 355px;" value="'+conditionObj[i].value+'"> <i class="delet-icon"></i></div>';$("#add-rule").find("#conditions-add").before(listCond),$("#add-rule .conditions").eq(i).find(".typeName option[value="+conditionObj[i].name+"]").attr("selected","selected"),$("#add-rule .conditions").eq(i).find(".isOpen option[value="+conditionObj[i].isInclude+"]").attr("selected","selected")}$("#addressee-rules-save").unbind("click").on("click",function(){ruleEdit(id)})}),$("#reset").bind("click",function(){$("#font-family option[value=宋体]").attr("selected",!0),$("#font-size option[value=14px]").attr("selected",!0),$(".select-font-color").find("span.color-show").css("background","rgb(0,0,0)")}),$("#emailIn-li,#uploadEmailF5").bind("click",function(){uploadEmailList()}),$("#selectDoc").on("click",function(){return $("#uploadEmailList").find("li").length>0?void $.Alert("只能单个文件上传"):$("#form_fileEmail input[name=upFiles]").click()}),$("#form_fileEmail input[name=upFiles]").on("change",function(e){$.EventFn(e);var t=fileLimitEmail($(this)),a=$("#up-filesEmail").val(),i=a.lastIndexOf("."),n=a.substring(i,a.length).toUpperCase();return".ZIP"!=n&&".EML"!=n&&".PST"!=n?($.Alert("请上传eml、pst文件或者eml文件组成的zip压缩包"),!1):void(t.flag&&uploadFujianEmail(t.name,t.size,t.dataSize))}),$("#uploadEmailSave").on("click",function(){var e=$("#boxEmail option:selected").val();if($("#uploadEmailList").find("li").length<1)$.Alert("请选择上传文件");else{var t=$("#uploadEmailList").find("li").eq(0).attr("data-url"),a=$("#uploadEmailList").find("li").eq(0).find(".media-heading").text(),i=$("#uploadEmailList").find("li").eq(0).find(".media-body span").attr("data-size"),n={filename:a,fileSize:i,emailCatelog:e,url:t};uploadEmail(n)}})})});