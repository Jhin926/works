require(["common"],function(){require(["maintab","blockUI"],function(t){var e=top.funcList;$("[data-code]").each(function(){for(var t=0;t<e.length;t++)e[t].code==$(this).attr("data-code")&&$(this).removeClass("none")}),t.init();var i=parseInt($.GetQueryString("id")),n=($.GetQueryString("type"),$("#detailPIForm"));$showbtn=$.GetQueryString("showbtn"),$showbtn||$(".pi-btn-group").show(),n.on("click",".form-group>button",function(){var e=$(this).attr("data-type");"edit"==e?t.showTab(Base.url+"/html/pop-pi-add.html?type=1&id="+i+"&v="+window.ver,"编辑PI"):"copy"==e?t.showTab(Base.url+"/html/pop-pi-add.html?type=0&id="+i+"&v="+window.ver,"新建PI"):"order"==e?t.showTab(Base.url+"/html/pop-order-add.html?piId="+i+"&v="+window.ver,"新建订单"):"export"==e&&o.toExport()});var o={getPIById:function(){$.ajax({url:Base.sitUrl+"/api/pi/v1/pi/detail",data:{id:i},type:"post",dataType:"json",success:function(t){if(!t.success)return void $.unLogin(t);var e=t.data,i=e.productPiDetails,o="";if(n.find(".pi-create").text(e.piDate||""),n.find(".quo-title>span").text(e.name),n.find(".custInfo-name").text(e.customerName||"匿名"),n.find(".custInfo-addr").text(e.toAddress),n.find(".custInfo-no").text(e.piNo),n.find(".custInfo-seller").text(e.seller),n.find(".custInfo-date").text(e.piDate||""),n.find(".p-freight").text(e.freight),n.find(".p-payment").text(e.termOfPayment),n.find(".p-td").text(e.termOfDelivery),n.find(".p-dd").text(e.dateOfDelivery),n.find(".p-total").text("$"+(e.total||0)+" USD"),n.find(".the-seller").text(e.sellerSignature),n.find(".the-buyer").text(e.buyerSignature),""!=e.companyLogo&&null!=e.companyLogo&&void 0!=e.companyLogo&&n.find(".box-pi-logo:first li:last-child").html('<img src="'+e.companyLogo+'" alt="" />'),i.length>0)for(var a=0;a<i.length;a++)o+='<ul class="items-infos">                                            <li>'+(a+1)+"</li>                                            <li>"+i[a].productName+'</li>                                            <li><img src="'+i[a].productPhoto+'" alt="产品图片" /></li>                                            <li><span class="p-unit">USD</span>&nbsp;<span class="p-cunit">$</span>                                                <span class="p-price">'+i[a].price+'</span>/<span class="p-munit">piece</span>                                            </li>                                            <li>'+i[a].orderQuantity+"</li>                                            <li>USD $"+i[a].orderQuantity*i[a].price+'</li>                                            <div class="clear"></div>                                        </ul>';else o="<ul>无产品列表</ul>";n.find(".items-title").after(o),n.find(".items-infos img").load(function(){$.cutImage(this,162,136)})}})},toExport:function(){$.ajax({url:Base.sitUrl+"/api/export/v1/pi",type:"POST",data:{id:i},dataType:"json",complete:function(t){window.location.href=Base.sitUrl+"/api/export/v1/pi?id="+i}})}};$("#pi-email").on("click",function(){t.showTab(Base.url+"/html/pop-email-new.html?showType=right&modelType=101&ids="+i+"&v="+window.ver,"发邮件")}),o.getPIById(i)})});