require(["common"],function(){require(["maintab","blockUI","datetimepickerCN"],function(e){e.init();var i=$.GetQueryString("id"),a=Number($.GetQueryString("pIdx")),l=$.GetQueryString("type"),r=$.GetQueryString("name");$("#emailgroup").find("input[type=email]").val(r),jQuery().datetimepicker&&$("#yourbirthday").datetimepicker({format:"yyyy-mm-dd",todayBtn:!1,language:"zh-CN",pickerPosition:"bottom",autoclose:!0,minView:"month"}),$("#addnewemail").on("click",function(e){$.EventFn(e);var i='<li>                            <label class="col-sm-1">邮箱</label>                            <div class="col-sm-10">                            <div>                              <p class="col-sm-11"><input class="form-control youremail" type="email" placeholder="请输入您的邮箱"></p>                              <p class="" style="cursor:pointer"><i class="delet-icon"></i></p>                            </div></div>                            <div class="clear"></div>                        </li>';$("#emailgroup").append(i)}),$("#emailgroup,#tellgroup").on("click",".delet-icon",function(e){$.EventFn(e);var i=$(this).parents("div.col-sm-10").parent("li");i.remove()}),$("#addnewtell").on("click",function(e){$.EventFn(e);var i='<li>                            <label class="col-sm-1">电话</label>                            <div class="col-sm-10">                                <div><p class="col-sm-11"><input class="form-control yourphone" placeholder="请输入电话号码"></p>                                     <p class="" style="cursor:pointer"><i class="delet-icon"></i></p>                                </div></div>                            <div class="clear"></div></li>';$("#tellgroup").append(i)});var t=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;$(".youremail").on("change",function(){var e=$(this).val();if(!t.test(e))return void $.Alert("邮箱格式有误")}),$("#newaddress").on("click",function(e){$.EventFn(e);for(var a=!0,r=$("#emailgroup").children("li"),t=$("#tellgroup").children("li"),s="",o="",c=0;c<r.length;c++)s+=r.eq(c).find(".youremail").val()+";";for(var d=0;d<t.length;d++)o+=t.eq(d).find(".yourphone").val()+";";var p={birthdayString:$("#yourbirthday").val(),remark:$("#yourbeizhu").val(),company:$("#company").val()};null!=$("#yourname").val()&&""!=$("#yourname").val()&&(p.name=$("#yourname").val()),a=$.errorsFn($("#yourname"),"请输入姓名！"),s=s.substring(0,s.length-1),null!=s&&""!=s?p.email=s:(alert("请输入邮箱！"),a=!1),p.phone=o.substring(0,o.length-1),a&&(l?n.editStatistics(i,p.name,p.email,p.company,p.phone,p.birthdayString,p.remark):n.newAddress(p.name,p.email,p.company,p.phone,p.birthdayString,p.remark))});var n={newAddress:function(e,i,a,l,r,t){var n={name:e,email:i,company:a,phone:l,birthdayString:r,remark:t};$.ajax({url:Base.sitUrl+"/api/addressList/v1/email/address/save",data:{data:JSON.stringify(n)},type:"POST",success:function(e){return e.success?($.DestroyPopInPop(),void parent.location.reload()):void $.unLogin(e)}})},editStatistics:function(e,i,l,r,t,n,s){var o={id:e,name:i,email:l,company:r,phone:t,birthdayString:n,remark:s};$.ajax({url:Base.sitUrl+"/api/addressList/v1/email/address/edit",data:{data:JSON.stringify(o)},type:"POST",success:function(e){return e.success?void $.Alert("编辑成功！","",function(){var e=$("#mainTab",parent.document).find(".currentClass").index();parent.me.refresh2(a),parent.me.closeOne(e)}):void $.unLogin(e)}})},statistics:function(){var e={id:i};$.ajax({url:Base.sitUrl+"/api/addressList/v1/email/address/detail",data:{data:JSON.stringify(e)},type:"POST",success:function(e,i){if(!e.success)return void $.unLogin(e);var a=e.data,l=a.email,i=a.phone,r="",t="";if($("#yourname").val(a.name),$("#yourbirthday").val(a.birthday),$("#yourbeizhu").val(a.remark),$("#yourphone").val(a.phone),$("#company").val(a.company),l.indexOf(";")!=-1){if(tmp=l.split(";"),tmp.length>1){for(var n=1;n<tmp.length;n++)r+='<li>                            <label class="col-sm-1">邮箱</label>                            <div class="col-sm-10">                            <div>                              <p class="col-sm-11"><input class="form-control youremail" type="email" value="'+tmp[n]+'"></p>                              <p class="col-sm-1"><i class="delet-icon"></i></p>                            </div></div>                            <div class="clear"></div>                        </li>';$("#emailgroup>li:first-child>div>.youremail").val(tmp[0])}}else $("#emailgroup>li:first-child>div>.youremail").val(l);if($("#emailgroup").append(r),null!=i&&""!=i){if(i.indexOf(";")!=-1&&(tmp2=i.split(";"),tmp2.length>1)){for(var s=1;s<tmp2.length;s++)t+='<li>                            <label class="col-sm-1">电话</label>                            <div class="col-sm-10">                                <div><p class="col-sm-11"><input class="form-control yourphone" value="'+tmp2[s]+'"></p>                                     <p class="col-sm-1"><i class="delet-icon"></i></p>                                </div></div>                            <div class="clear"></div></li>';console.log(tmp[0]),$("#tellgroup>li:first-child>div>.yourphone").val(tmp2[0])}}else $("#tellgroup>li:first-child>div>.yourphone").val(i);$("#tellgroup").append(t)}})}};l&&n.statistics()})});