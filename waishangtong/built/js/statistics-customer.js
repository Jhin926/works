require(["common"],function(){require(["maintab","blockUI","jqform"],function(t){function e(){for(var t=new Date,e=t.getFullYear(),a=(t.getMonth(),""),n="",s=2e3;s<=e;s++)a+="<option value="+s+">"+s+"年</option>";for(var s=1;s<13;s++)n+='<option value="'+s+'">'+s+"月</option>";$(".years").empty(),$(".years").append(a),$(".years").find("option[value="+e+"]").attr("selected",!0),$(".month").empty(),$(".month").append('<option value="19">全部</option>'),$(".month").append(n)}function a(){var t,e={year:2016,subyear:19};return $.ajax({url:Base.sitUrl+"/api/customer/v1/customer/number/by/status",type:"POSt",dataType:"json",async:!1,data:{data:JSON.stringify(e)},success:function(e){return e.success?void(t=e.data):void $.unLogin(e)}}),t}function n(){$("#allNum").text(l.customerTotalNum)}function s(){for(var t=l.sustomerNumberStatistics,e=new Array,a=new Array,n=new Array,s=new Array,r=0;r<t.length;r++){null==t[r].customerStatusName&&(t[r].customerStatusName="无"),e.push(t[r].customerStatusName),a.push(t[r].customerStatus),s.push(t[r].customerNum);var i={value:t[r].customerNum,name:t[r].customerStatusName};n.push(i)}var o=Math.max.apply(null,s),u=echarts.init(document.getElementById("chart1")),m={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c}"},series:[{name:"客户状态",type:"funnel",left:"10%",top:30,bottom:30,width:"80%",min:0,max:o,minSize:"1%",maxSize:"100%",sort:"descending",gap:2,label:{normal:{show:!0,position:"right"},emphasis:{textStyle:{fontSize:20}}},labelLine:{normal:{length:10,lineStyle:{width:1,type:"solid"}}},itemStyle:{normal:{borderColor:"#fff",borderWidth:1}},data:n}]};u.setOption(m)}function r(){for(var t="",e=l.sustomerNumberStatistics,a=0;a<e.length;a++)t+='<li class="charTableTitle"><span data-status="'+e[a].customerStatus+'">'+e[a].customerStatusName+"</span><span>"+e[a].customerNum+"</span></li>";$("#custStatus").empty(),$("#custStatus").append(t),e.length>7&&$("#down").show()}function i(t,e){var a={year:t,subyear:e};$.ajax({url:Base.sitUrl+"/api/customer/v1/customer/number/by/new",type:"POST",dataType:"json",data:{data:JSON.stringify(a)},success:function(t){if(!t.success)return void $.unLogin(t);for(var e=t.data,a=new Array,n=0;n<12;n++){if(void 0!==e[n])var s=e[n].dataTime.substring(5,7);else var s="0";"01"==s||"02"==s||"03"==s||"04"==s||"05"==s||"06"==s||"07"==s||"08"==s||"09"==s||"10"==s||"11"==s||"12"==s?a.push(e[n].customerNum):a.push(0)}for(var r=new Array,n=0;n<e.length;n++)r.push(e[n].customerNum);if(r.length<=12)for(var n=r.length;n<12;n++)r.push(0);var i=Math.max.apply(null,r),o=Math.round(.2*i);o<1&&(o=1);var u=echarts.init(document.getElementById("chart2")),l={tooltip:{trigger:"axis"},legend:{data:["新建客户数"]},xAxis:[{type:"category",axisLabel:{interval:0},data:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]}],yAxis:[{type:"value",name:"新建客户数",min:0,max:i,interval:o,axisLabel:{formatter:"{value}"}}],series:[{name:"新建客户数",type:"line",data:a}]};u.setOption(l)}})}function o(t,e){var a={year:t,subyear:e};$.ajax({url:Base.sitUrl+"/api/customer/v1/customer/number/by/new",type:"POST",dataType:"json",data:{data:JSON.stringify(a)},success:function(t){if(!t.success)return void $.unLogin(t);for(var e=t.data,a=new Array,n=new Array,s=0;s<e.length;s++)n.push(e[s].dataTime.substring(8,10)),a.push(e[s].customerNum);var r=Math.max.apply(null,a),i=.2*r,o=echarts.init(document.getElementById("chart2")),u={tooltip:{trigger:"axis"},legend:{data:["新建客户数"]},xAxis:[{type:"category",data:n}],yAxis:[{type:"value",name:"新建客户数",min:0,max:r,interval:i,axisLabel:{formatter:"{value}"}}],series:[{name:"新建客户数",type:"line",data:a}]};o.setOption(u)}})}function u(t,e){var t=t.toString(),e=e.toString(),a=m.currentPage.toString(),n=m.pageSize.toString(),s={year:t,subyear:e,currentPage:a,pageSize:n};$.ajax({url:Base.sitUrl+"/api/customer/v1/customer/number/by/new/rank",type:"POST",dataType:"json",data:{data:JSON.stringify(s)},success:function(t){if(!t.success)return void $.unLogin(t);var e=t.data.results;if(e.length>0){for(var a="",n=0;n<e.length;n++)a+='<li><span class="circleTop">'+e[n].userRank+"</span><span>"+e[n].userName+'</span><span class="moneyTop">'+e[n].customerNum+"</span></li>";$("#newCustRank").empty(),$("#newCustRank").append(a);var s=t.data.totalItem,r=s,i=m.pageSize,o=Math.ceil(r/i);m.lastpage=o,$(".i-content-wrapper").stop().animate({scrollTop:0},500)}else{var u='<img src="../../images/statisticsNone.png">';$("#newCustRank").empty(),$("#newCustRank").append(u)}}})}var l=a(),m={homepage:1,currentPage:1,lastpage:null,pageSize:10};$("#up a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"+=20px"}),$("#down").show(),"-20px"==$(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop")&&$(this).parent().hide()}),$("#down a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"-=20px"}),$("#up").show();var t="-"+20*(l.sustomerNumberStatistics.length-6)+"px";$(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop")==t&&$(this).parent().hide()}),$("#newCustRankDev .years").on("change",function(){var t=$(this).val(),e=$("#newCustRankDev .month").val();u(t,e)}),$("#newCustRankDev .month").on("change",function(){var t=$(this).val(),e=$("#newCustRankDev .years").val();u(e,t)}),$("#devSendS .years").on("change",function(){var t=($(this).val(),$("#devSendS .month").val());19==t?devSendNum(p,t):o(p,t)}),$("#devSendS .month").on("change",function(){var t=$(this).val();$("#devSendS .years").val();19==t?devSendNum(p,t):o(p,t)});var p=(new Date).getFullYear();e(),n(),s(),r(),i(p,19),u(p,19)})});