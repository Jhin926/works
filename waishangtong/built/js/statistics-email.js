require(["common"],function(){require(["maintab","blockUI","jqform"],function(a){function t(){for(var a=new Date,t=a.getFullYear(),e=(a.getMonth(),""),n="",i=2e3;i<=t;i++)e+="<option value="+i+">"+i+"年</option>";for(var i=1;i<13;i++)n+='<option value="'+i+'">'+i+"月</option>";$(".years").empty(),$(".years").append(e),$(".years").find("option[value="+t+"]").attr("selected",!0),$(".month").empty(),$(".month").append('<option value="19">全部</option>'),$(".month").append(n)}function e(a,t){var e={year:a,subyear:t};$.ajax({url:Base.sitUrl+"/api/email/v1/in/and/out/statistics",type:"POST",dataType:"json",async:!1,data:{data:JSON.stringify(e)},success:function(a){if(!a.success)return void $.unLogin(a);var t=a.data;i(t),o(t),s(t)}})}function n(a,t){var e={year:a,subyear:t};$.ajax({url:Base.sitUrl+"/api/email/v1/in/and/out/statistics",type:"POST",dataType:"json",async:!1,data:{data:JSON.stringify(e)},success:function(a){if(!a.success)return void $.unLogin(a);var t=a.data;r(t),o(t),s(t)}})}function i(a){if(""==a.trendsIn&&""==a.trendsOut){var t='<img src="../../images/statisticsNone.png">';$("#chart").empty(),$("#chart").append(t)}else{for(var e=a.trendsOut,n=a.trendsIn,i=new Array,r=new Array,s=0;s<12;s++){if(void 0!==e[s])var o=e[s].dataTime.substring(5,7);else var o="0";if(void 0!==n[s])var l=n[s].dataTime.substring(5,7);else var l="0";"01"==o||"02"==o||"03"==o||"04"==o||"05"==o||"06"==o||"07"==o||"08"==o||"09"==o||"10"==o||"11"==o||"12"==o?i.push(e[s].emailNum):i.push(0),"01"==l||"02"==l||"03"==l||"04"==l||"05"==l||"06"==l||"07"==l||"08"==l||"09"==l||"10"==l||"11"==l||"12"==l?r.push(n[s].emailNum):r.push(0)}for(var u=new Array,s=0;s<e.length;s++)u.push(e[s].emailNum);if(u.length<=12)for(var s=u.length;s<12;s++)u.push(0);for(var p=Math.max.apply(null,u),m=new Array,s=0;s<n.length;s++)m.push(n[s].emailNum);if(m.length<=12)for(var s=m.length;s<12;s++)m.push(0);var d=Math.max.apply(null,m);if(p>d)var h=p;else var h=d;h+=Math.round(.1*h);var c=Math.round(.2*h);c<1&&(c=1);var v=echarts.init(document.getElementById("chart")),y={tooltip:{trigger:"axis"},legend:{data:["发送数","接受数"]},xAxis:[{type:"category",axisLabel:{interval:0},data:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]}],yAxis:[{type:"value",min:0,max:h,interval:c,axisLabel:{formatter:"{value}"}}],series:[{name:"发送数",type:"line",data:i},{name:"接受数",type:"line",data:r}]};v.setOption(y)}}function r(a){if(""==a.trendsIn&&""==a.trendsOut){var t='<img src="../../images/statisticsNone.png">';$("#chart").empty(),$("#chart").append(t)}else{for(var e=a.trendsOut,n=a.trendsIn,i=new Array,r=new Array,s=new Array,o=0;o<e.length;o++)s.push(e[o].dataTime.substring(8,10)),i.push(e[o].emailNum);for(var o=0;o<n.length;o++)s.push(n[o].dataTime.substring(8,10)),r.push(n[o].emailNum);var l=Math.max.apply(null,i),u=Math.max.apply(null,r);if(u>=l)var p=u;else var p=l;var m=Math.round(.2*p),d=echarts.init(document.getElementById("chart")),h={tooltip:{trigger:"axis"},legend:{data:["发送数","接受数"]},xAxis:[{type:"category",data:s}],yAxis:[{type:"value",min:0,max:p,interval:m,axisLabel:{formatter:"{value}"}}],series:[{name:"发送数",type:"line",data:i},{name:"接受数",type:"line",data:r}]};d.setOption(h)}}function s(a){var t=a.ranks;if(""==t){var e='<img src="../../images/statisticsNone.png">';$(".chartTable").empty(),$(".chartTable").append(e)}else{for(var n="",i=0;i<t.length;i++)n+='<li><span class="circleTop">'+t[i].userRank+"</span><span>"+t[i].userName+'</span><span class="moneyTop">'+t[i].emailSendNum+"</span></li>";$(".chartTable").empty(),$(".chartTable").append(n),t.length>8&&$("#down").show()}}function o(a){var t=a;$("#dayOutboxNum").text(t.dayOutboxNum),$("#dayInboxNum").text(t.dayInboxNum),$("#inboxNum").text(t.inboxNum),$("#outboxNum").text(t.outboxNum),$("#emailOpenRate").text(t.emailOpenRate)}var l=(new Date).getFullYear();$("#up a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"+=20px"}),$("#down").show(),"-20px"==$(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop")&&$(this).parent().hide()}),$("#down a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"-=20px"}),$("#up").show();var a="-"+20*(chartDataJson.length-6)+"px";$(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop")==a&&$(this).parent().hide()}),$(".years").on("change",function(){var a=$(this).val(),t=$(".month").val();e(a,t)}),$(".month").on("change",function(){var a=$(this).val(),t=$(".years").val();19==a?e(t,a):n(t,a)}),t(),e(l,19)})});