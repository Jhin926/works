require(["common"],function(){require(["maintab","blockUI","jqform"],function(a){function e(){for(var a=new Date,e=a.getFullYear(),t=(a.getMonth(),""),n="",s=2e3;s<=e;s++)t+="<option value="+s+">"+s+"年</option>";for(var s=1;s<13;s++)n+='<option value="'+s+'">'+s+"月</option>";$("#years").empty(),$("#years").append(t),$("#years").find("option[value="+e+"]").attr("selected",!0),$("#month").empty(),$("#month").append('<option value="0">全部</option>'),$("#month").append(n)}function t(){$.ajax({url:Base.sitUrl+"/api/order/v1/order/amount",type:"GET",dataType:"json",success:function(a){return a.success?void $("#money").text("￥"+a.data.amount):void $.unLogin(a)}})}function n(){var a;return $.ajax({url:Base.sitUrl+"/api/order/v1/order/amount/count",type:"GET",dataType:"json",async:!1,success:function(e){return e.success?void(a=e.data):void $.unLogin(e)}}),a}function s(){for(var a=new Array,e=new Array,t=new Array,n=0;n<l.length;n++)t.push(l[n].month+"月"),a.push(l[n].count),e.push(l[n].amount);var s=Math.max.apply(null,a),r=Math.max.apply(null,e),i=Math.round(.2*s);i<1&&(i=1);var o=Math.round(.2*r);o<1&&(o=1);var p=echarts.init(document.getElementById("chart")),u={tooltip:{trigger:"axis"},legend:{data:["订单次数","订单金额"]},xAxis:[{type:"category",axisLabel:{interval:0},data:t}],yAxis:[{type:"value",name:"订单次数",min:0,max:s,interval:i,axisLabel:{formatter:"{value}"}},{type:"value",name:"订单金额",min:0,max:r,interval:o,axisLabel:{formatter:"{value}"}}],series:[{name:"订单次数",type:"bar",data:a},{name:"订单金额",type:"line",yAxisIndex:1,data:e}]};p.setOption(u)}function r(){for(var a="",e=0;e<l.length;e++)a+='<li class="charTableTitle"><span>'+l[e].year+"年"+l[e].month+"月</span><span>"+l[e].amount+"</span><span>"+l[e].count+"</span></li>";$(".chartTable").empty(),$(".chartTable").append(a),l.length>8&&$("#down").show()}function i(){$.ajax({url:Base.sitUrl+"/api/order/v1/order/amount/sort",type:"POST",dataType:"json",data:{currentPage:u.currentPage,pageSize:u.pageSize},success:function(a){if(!a.success)return void $.unLogin(a);var e=a.data.results;if(e.length>0){for(var t="",n=0;n<e.length;n++){var s=n+1;t+='<li><span class="circleTop">'+s+"</span><span>"+e[n].name+'</span><span class="moneyTop">￥'+e[n].amount+"元</span></li>"}$("#ulLeft").empty(),$("#ulLeft").append(t);var r=a.data.totalItem,i=r,o=u.pageSize,p=Math.ceil(i/o);u.lastpage=p,$(".i-content-wrapper").stop().animate({scrollTop:0},500)}else{var l='<img src="../../images/statisticsNone.png">';$("#ulLeft").empty(),$("#ulLeft").append(l)}}})}function o(){$.ajax({url:Base.sitUrl+"/api/order/v1/order/amount/top",type:"POST",dataType:"json",success:function(a){if(!a.success)return void $.unLogin(a);var e=a.data;if(e.length>0){var t="";if(e.length>10)var n=10;else var n=e.length;for(var s=0;s<n;s++){var r=s+1;t+='<li><span class="circleTop">'+r+"</span><span>"+e[s].name+'</span><span class="moneyTop">￥'+e[s].amount+"元</span></li>"}$("#ulRight").empty(),$("#ulRight").append(t)}else{var i='<img src="../../images/statisticsNone.png">';$("#ulRight").empty(),$("#ulRight").append(i)}}})}function p(a,e){var a=a,e=e;$.ajax({url:Base.sitUrl+"/api/order/v1/order/amount/sort",type:"GET",dataType:"json",data:{currentPage:u.currentPage,pageSize:u.pageSize,year:a,month:e},success:function(a){if(!a.success)return void $.unLogin(a);var e=a.data.results;if(e.length>0){for(var t="",n=0;n<e.length;n++){var s=n+1;t+='<li><span class="circleTop">'+s+"</span><span>"+e[n].name+'</span><span class="moneyTop">￥'+e[n].amount+"元</span></li>"}$("#ulLeft").empty(),$("#ulLeft").append(t)}else{var r='<img src="../../images/statisticsNone.png">';$("#ulLeft").empty(),$("#ulLeft").append(r)}var i=a.data.totalItem,o=i,p=u.pageSize,l=Math.ceil(o/p);u.lastpage=l,$(".i-content-wrapper").stop().animate({scrollTop:0},500)}})}var l=n(),u={homepage:1,currentPage:1,lastpage:null,pageSize:10};$("#up a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"+=40px"},"fast"),$("#down").show(),parseInt($(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop"))>=-40&&$(this).parent().hide()}),$("#down a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"-=40px"},"fast"),$("#up").show();var a="-"+40*(l.length-6);parseInt($(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop"))<=parseInt(a)&&$(this).parent().hide()}),$("#years").on("change",function(){var a=$(this).val();p(a,0)}),$("#month").on("change",function(){var a=$("#years").val(),e=$(this).val();p(a,e)}),e(),t(),s(),r(),i(),o()})});