require(["common"],function(){require(["maintab","blockUI","jqform"],function(t){function a(){for(var t=new Date,a=t.getFullYear(),e=(t.getMonth(),""),n="",i=2e3;i<=a;i++)e+="<option value="+i+">"+i+"年</option>";for(var i=1;i<13;i++)n+='<option value="'+i+'">'+i+"月</option>";$(".years").empty(),$(".years").append(e),$(".years").find("option[value="+a+"]").attr("selected",!0),$(".month").empty(),$(".month").append('<option value="0">全部</option>'),$(".month").append(n)}function e(){$.ajax({url:Base.sitUrl+"/api/product/v1/product/count",type:"GET",dataType:"json",success:function(t){return t.success?void $("#money").text(t.data):void $.unLogin(t)}})}function n(){var t;return $.ajax({url:Base.sitUrl+"/api/product/v1/product/group",type:"GET",dataType:"json",async:!1,success:function(a){return a.success?void(t=a.data):void $.unLogin(a)}}),t}function i(){for(var t=new Array,a=new Array,e=0;e<o.length;e++)if(o[e].count>0){t.push(o[e].name);var n={name:o[e].name,value:o[e].count};a.push(n)}var i=echarts.init(document.getElementById("chart")),r={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:t},series:[{name:"产品分组",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!0,position:"left"},emphasis:{show:!0,textStyle:{fontSize:"20",fontWeight:"normal"}}},labelLine:{normal:{show:!0}},data:a}]};i.setOption(r)}function r(){for(var t="",a=0;a<o.length;a++)t+='<li class="charTableTitle"><span>'+o[a].name+"</span><span>"+o[a].count+"</span></li>";$(".chartTable").empty(),$(".chartTable").append(t),o.length>7&&$("#down").show()}function s(t,a){$.ajax({url:Base.sitUrl+"/api/product/v1/group/statistics",type:"POST",dataType:"json",data:{currentPage:p.currentPage,pageSize:p.pageSize,year:t,month:a},success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results;if(a.length>0){for(var e="",n=0;n<a.length;n++)a[n].conversionRate=parseInt(a[n].conversionRate),e+='<tr data-id="'+n+'"><td>'+a[n].name+"</td><td>"+a[n].amount+"</td><td>"+a[n].orderCount+"</td><td>"+a[n].unitAmount+"</td><td>"+a[n].quotationCount+"</td><td>"+a[n].num+"</td><td>"+a[n].conversionRate+"%</td></tr>";$("#pdtGroup tbody").empty(),$("#pdtGroup tbody").append(e)}else{var i='<img src="../../images/statisticsNone.png">';$("#pdtGroup tbody").empty(),$("#pdtGroup tbody").append(i)}var r=t.data.totalItem,s=r,d=p.pageSize,o=Math.ceil(s/d);if(p.lastpage=o,o>1){var l="";l='<li><a href="javascript:;" data-page="1">&laquo;</a></li>';for(var c=0;c<o;c++)l+='<li><a href="javascript:;" data-page="'+(c+1)+'">'+(c+1)+"</a></li>";l+='<li><a href="javascript:;" data-page="'+p.lastpage+'">&raquo;</a></li>'}$("#pagination").empty(),$("#pagination").append(l),$(".i-content-wrapper").stop().animate({scrollTop:0},500),void 0==p.currentPage||1==p.currentPage?($("#pagination").children().eq(1).addClass("active"),$("#pagination").children().first().addClass("disabled").hide().children().last().removeClass("disabled").show()):p.currentPage&&p.currentPage==o?($("#pagination").children().eq(p.currentPage).addClass("active").siblings().removeClass("active"),$("#pagination").children().last().addClass("disabled").hide().children().first().removeClass("disabled").show()):p.currentPage&&p.currentPage>1&&p.currentPage<o&&$("#pagination").children().eq(p.currentPage).addClass("active").siblings().removeClass("active")}})}function d(t,a){$.ajax({url:Base.sitUrl+"/api/product/v1/product/statistics",type:"POST",dataType:"json",data:{currentPage:p.currentPage,pageSize:p.pageSize,year:t,month:a},success:function(t){if(!t.success)return void $.unLogin(t);var a=t.data.results;if(a.length>0){for(var e="",n=0;n<a.length;n++)e+='<tr data-id="'+n+'"><td>'+a[n].name+"</td><td>"+a[n].amount+"</td><td>"+a[n].orderCount+"</td><td>"+a[n].unitAmount+"</td><td>"+a[n].quotationCount+"</td><td>"+a[n].num+"</td><td>"+a[n].conversionRate+"%</td></tr>";$("#pdt tbody").empty(),$("#pdt tbody").append(e)}else{var i='<img src="../../images/statisticsNone.png">';$("#pdt tbody").empty(),$("#pdt tbody").append(i)}var r=t.data.totalItem,s=r,d=p.pageSize,o=Math.ceil(s/d);if(p.lastpage=o,o>1){var l="";l='<li><a href="javascript:;" data-page="1">&laquo;</a></li>';for(var c=0;c<o;c++)l+='<li><a href="javascript:;" data-page="'+(c+1)+'">'+(c+1)+"</a></li>";l+='<li><a href="javascript:;" data-page="'+p.lastpage+'">&raquo;</a></li>'}$("#pagination1").empty(),$("#pagination1").append(l),$(".i-content-wrapper").stop().animate({scrollTop:0},500),void 0==p.currentPage||1==p.currentPage?($("#pagination1").children().eq(1).addClass("active"),$("#pagination1").children().first().addClass("disabled").hide().children().last().removeClass("disabled").show()):p.currentPage&&p.currentPage==o?($("#pagination1").children().eq(p.currentPage).addClass("active").siblings().removeClass("active"),$("#pagination").children().last().addClass("disabled").hide().children().first().removeClass("disabled").show()):p.currentPage&&p.currentPage>1&&p.currentPage<o&&$("#pagination1").children().eq(p.currentPage).addClass("active").siblings().removeClass("active")}})}var o=n(),l=$(".page-content"),p={homepage:1,currentPage:1,lastpage:null,pageSize:5};l.on("click","#pagination>li",function(t){var a=t||window.event;a.preventDefault(),$(this).hasClass("active")||$(this).hasClass("disabled")||(p.currentPage=parseInt($(this).children().attr("data-page")),quoObj.filter(),$(this).addClass("active").siblings().removeClass("active"))}),$("#up a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"+=30px"},"fast"),$("#down").show(),parseInt($(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop"))>=-30&&$(this).parent().hide()}),$("#down a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"-=30px"},"fast"),$("#up").show();var t=($(".bodyRight").find("ul li").length,parseInt(30*(o.length-7))),a="-"+t;parseInt($(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop"))<=parseInt(a)&&$(this).parent().hide()}),$("#pagination").delegate("li","click",function(t){var a=t||window.event;if(a.preventDefault(),!$(this).hasClass("active")&&!$(this).hasClass("disabled")){p.currentPage=$(this).children().attr("data-page");var e=$("#pdtGroup").find(".years").val(),n=$("#pdtGroup").find(".month").val();s(e,n),$(this).addClass("active").siblings().removeClass("active")}}),$("#pagination1").delegate("li","click",function(t){var a=t||window.event;if(a.preventDefault(),!$(this).hasClass("active")&&!$(this).hasClass("disabled")){p.currentPage=$(this).children().attr("data-page");var e=$("#pdt").find(".years").val(),n=$("#pdt").find(".month").val();d(e,n),$(this).addClass("active").siblings().removeClass("active")}}),$("#pdtGroup .years").on("change",function(){var t=$(this).val(),a=$("#pdtGroup .month").val();s(t,a)}),$("#pdtGroup .month").on("change",function(){var t=$(this).val(),a=$("#pdtGroup .years").val();s(a,t)}),$("#pdt .years").on("change",function(){var t=$(this).val(),a=$("#pdtGroup .month").val();d(t,a)}),$("#pdt .month").on("change",function(){var t=$(this).val(),a=$("#pdtGroup .years").val();d(a,t)}),a(),e(),i(),r(),s(0,0),d(0,0),$(document).ready(function(){$(".table1 thead th").unbind("click").on("click",function(t){function a(t,a){return t-a}$.EventFn(t);var e=$(this).index()+1,n=new Array,i=$(".table1 tbody tr"),r="";if(1!=e&&2!=e){for(var s=0;s<i.length;s++)r+=parseInt($(".table1 tbody tr").eq(s).find("td:nth-child("+e+")").text())+"."+$(".table1 tbody tr").eq(s).attr("data-id")+",";r=r.substring(0,r.length-1),n=r.split(","),n=n.sort(a);var d;if($(this).hasClass("up")){$(this).removeClass("up"),$(this).find(".i-jiantou").css("transform","rotate(0deg)");for(var o=i.length,s=0;s<o;s++)for(var l=0;l<o;l++){var p=o-s,c=n[s].substring(n[s].search(/\./)+1,n[s].length);$(".table1 tbody tr").eq(l).attr("data-id")==c&&(d+='<tr data-id="'+$(".table1 tbody tr").eq(l).attr("data-id")+'">'+$(".table1 tbody tr").eq(l).html()+"</tr>")}$(".table1 tbody").empty(),$(".table1 tbody").append(d)}else{$(this).addClass("up"),$(this).find(".i-jiantou").css("transform","rotate(180deg)");for(var o=i.length,s=0;s<o;s++)for(var l=0;l<o;l++){var p=o-s,c=n[p-1].substring(n[p-1].search(/\./)+1,n[p-1].length);$(".table1 tbody tr").eq(l).attr("data-id")==c&&(d+='<tr data-id="'+$(".table1 tbody tr").eq(l).attr("data-id")+'">'+$(".table1 tbody tr").eq(l).html()+"</tr>")}$(".table1 tbody").empty(),$(".table1 tbody").append(d)}}}),$(".table2 thead th").unbind("click").on("click",function(t){function a(t,a){return t-a}$.EventFn(t);var e=$(this).index()+1,n=new Array,i=$(".table2 tbody tr"),r="";if(1!=e&&2!=e){for(var s=0;s<i.length;s++)r+=parseInt($(".table2 tbody tr").eq(s).find("td:nth-child("+e+")").text())+"."+$(".table2 tbody tr").eq(s).attr("data-id")+",";r=r.substring(0,r.length-1),n=r.split(","),n=n.sort(a);var d;if($(this).hasClass("up")){$(this).removeClass("up"),$(this).find(".i-jiantou").css("transform","rotate(0deg)");for(var o=i.length,s=0;s<o;s++)for(var l=0;l<o;l++){var p=o-s,c=n[s].substring(n[s].search(/\./)+1,n[s].length);$(".table2 tbody tr").eq(l).attr("data-id")==c&&(d+='<tr data-id="'+$(".table2 tbody tr").eq(l).attr("data-id")+'">'+$(".table2 tbody tr").eq(l).html()+"</tr>")}$(".table2 tbody").empty(),$(".table2 tbody").append(d)}else{$(this).addClass("up"),$(this).find(".i-jiantou").css("transform","rotate(180deg)");for(var o=i.length,s=0;s<o;s++)for(var l=0;l<o;l++){var p=o-s,c=n[p-1].substring(n[p-1].search(/\./)+1,n[p-1].length);$(".table2 tbody tr").eq(l).attr("data-id")==c&&(d+='<tr data-id="'+$(".table2 tbody tr").eq(l).attr("data-id")+'">'+$(".table2 tbody tr").eq(l).html()+"</tr>")}$(".table2 tbody").empty(),$(".table2 tbody").append(d)}}})})})});