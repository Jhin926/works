require(["common"],function(){require(["maintab","blockUI","jqform"],function(a){function e(){for(var a=new Date,e=a.getFullYear(),t=(a.getMonth(),""),n="",i=2e3;i<=e;i++)t+="<option value="+i+">"+i+"年</option>";for(var i=1;i<13;i++)n+='<option value="'+i+'">'+i+"月</option>";$("#years").empty(),$("#years").append(t),$("#years").find("option[value="+e+"]").attr("selected",!0),$("#month").empty(),$("#month").append('<option value="0">全部</option>'),$("#month").append(n)}function t(){$.ajax({url:Base.sitUrl+"/api/pi/v1/pi/amount",type:"GET",dataType:"json",success:function(a){return a.success?void(null!==a.data&&""!==a.data&&$("#money").text(a.data.amount)):void $.unLogin(a)}})}function n(){var a;return $.ajax({url:Base.sitUrl+"/api/pi/v1/pi/amount/count",type:"GET",dataType:"json",async:!1,success:function(e){return e.success?void(a=e.data):void $.unLogin(e)}}),a}function i(){for(var a=new Array,e=new Array,t=new Array,n=0;n<l.length;n++)t.push(l[n].month+"月"),a.push(l[n].count),e.push(l[n].amount);var i=Math.max.apply(null,a),s=Math.max.apply(null,e),p=Math.round(.2*i);p<1&&(p=1);var r=Math.round(.2*s);r<1&&(r=1);var o=echarts.init(document.getElementById("chart")),u={tooltip:{trigger:"axis"},legend:{data:["PI次数","PI金额"]},xAxis:[{type:"category",axisLabel:{interval:0},data:t}],yAxis:[{type:"value",name:"PI次数",min:0,max:i,interval:p,axisLabel:{formatter:"{value}"}},{type:"value",name:"PI金额",min:0,max:s,interval:r,axisLabel:{formatter:"{value}"}}],series:[{name:"PI次数",type:"bar",data:a},{name:"PI金额",type:"line",yAxisIndex:1,data:e}]};o.setOption(u)}function s(){for(var a="",e=l.length-1;e>=0;e--)a+='<li class="charTableTitle"><span>'+l[e].year+"年"+l[e].month+"月</span><span>"+l[e].amount+"</span><span>"+l[e].count+"</span></li>";$(".chartTable").empty(),$(".chartTable").append(a),l.length>8&&$("#down").show()}function p(){$.ajax({url:Base.sitUrl+"/api/pi/v1/pi/amount/sort",type:"POST",dataType:"json",data:{currentPage:u.currentPage,pageSize:u.pageSize},success:function(a){if(!a.success)return void $.unLogin(a);var e=a.data.results;if(e.length>0){for(var t="",n=0;n<e.length;n++){var i=n+1;t+='<li><span class="circleTop">'+i+"</span><span>"+e[n].name+'</span><span class="moneyTop">￥'+e[n].amount+"元</span></li>"}$("#ulLeft").empty(),$("#ulLeft").append(t)}else{var s='<img src="../../images/statisticsNone.png">';$("#ulLeft").empty(),$("#ulLeft").append(s)}var p=a.data.totalItem,r=p,o=u.pageSize,l=Math.ceil(r/o);u.lastpage=l,$(".i-content-wrapper").stop().animate({scrollTop:0},500)}})}function r(){$.ajax({url:Base.sitUrl+"/api/pi/v1/pi/amount/top",type:"POST",dataType:"json",success:function(a){if(!a.success)return void $.unLogin(a);var e=a.data;if(e.length>0){var t="";if(e.length>10)var n=10;else var n=e.length;for(var i=0;i<n;i++){var s=i+1;t+='<li><span class="circleTop">'+s+"</span><span>"+e[i].name+'</span><span class="moneyTop">￥'+e[i].amount+"元</span></li>"}$("#ulRight").empty(),$("#ulRight").append(t)}else{var p='<img src="../../images/statisticsNone.png">';$("#ulRight").empty(),$("#ulRight").append(p)}}})}function o(a,e){var a=a,e=e;$.ajax({url:Base.sitUrl+"/api/pi/v1/pi/amount/sort",type:"GET",dataType:"json",data:{currentPage:u.currentPage,pageSize:u.pageSize,year:a,month:e},success:function(a){if(!a.success)return void $.unLogin(a);var e=a.data.results;if(e.length>0){for(var t="",n=0;n<e.length;n++){var i=n+1;t+='<li><span class="circleTop">'+i+"</span><span>"+e[n].name+'</span><span class="moneyTop">'+e[n].count+"</span></li>"}$("#ulLeft").empty(),$("#ulLeft").append(t)}else{var s='<img src="../../images/statisticsNone.png">';$("#ulLeft").empty(),$("#ulLeft").append(s)}var p=a.data.totalItem,r=p,o=u.pageSize,l=Math.ceil(r/o);u.lastpage=l,$(".i-content-wrapper").stop().animate({scrollTop:0},500)}})}var l=n(),u=($(".page-content"),{homepage:1,currentPage:1,lastpage:null,pageSize:10});$("#up a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"+=40px"},"fast"),$("#down").show(),parseInt($(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop"))>=-40&&$(this).parent().hide()}),$("#down a").bind("click",function(){$(this).parents(".bodyRight").find("ul li").eq(0).animate({marginTop:"-=40px"},"fast"),$("#up").show();var a="-"+40*(l.length-6);parseInt($(this).parents(".bodyRight").find("ul li").eq(0).css("marginTop"))<=parseInt(a)&&$(this).parent().hide()}),$("#years").on("change",function(){var a=$(this).val();o(a,0)}),$("#month").on("change",function(){var a=$("#years").val(),e=$(this).val();o(a,e)}),e(),t(),i(),s(),p(),r()})});