require(["common"],function(){require(["ztree","maintab","setpassword","validationLang","rsa"],function(e,i,n){function a(e,i){return!i.isParent}function t(e){}function s(e,i){}function o(){$.ajax({url:Base.sitUrl+"/api/user/v1/account/binding/list",type:"POST",dataType:"json",success:function(e){if(!e.success)return void $.unLogin(e);var i=e.data;$("#emailAccount").find(".binding-user").remove();for(var n=0;n<i.length;n++)if(1==i[n].type&&1==i[n].isBinding){$("#emailLink").hide(),$("#emailAccount").show();var a='<div class="binding-user"><span class="binding-user-name" data-id="'+i[n].accountId+'">'+i[n].accountName+"</span></div>";$("#emailAccount").find("#emailUnbinding").before(a)}}})}function c(){$.ajax({url:Base.sitUrl+"/api/user/email/v1/unbinding",type:"POST",dataType:"json",data:{type:1},success:function(e){return e.success?($("#emailLink").show(),$("#emailAccount").hide(),void o()):void $.Alert(!e.message)}})}function r(){$.ajax({url:Base.sitUrl+"/api/facebook/detail",type:"POST",dataType:"json",data:{id:$("#pageLeftUserName",parent.document).attr("data-id")},success:function(e){if(!e.success)return void $.Alert(!e.message);var i=e.data;if(null!==i&&""!==i&&void 0!==i){var n='<div class="binding-user"><span class="binding-user-name" data-id="'+i.id+'" data-fbid="'+i.facebookId+'">'+i.email+'</span></div><a href="#" class="close" id="fbbinding1" style="color:blue;opacity:.65;font-size:12px;top:15px;">解绑</a>';$("#facebookBtn").parent().hide(),$("#facebookBtn").parent().before(n),$("#facebook").hide(),$(".facebook").show()}}})}function d(){var e=$("#pageLeftUserName",parent.document).attr("data-id"),i={userId:parseInt(e),type:1};$.ajax({url:Base.sitUrl+"/api/social/unbinding",type:"POST",dataType:"json",data:{data:JSON.stringify(i)},success:function(e){return e.success?($("#fbLink").show(),$("#fbAccount").hide(),void r()):void $.Alert(!e.message)}})}i.init(),n.init();var u={view:{showIcon:a},data:{simpleData:{enable:!0}}},f=[{name:"常用功能",open:!0,children:[{name:"CRM功能",children:[{name:"客户",children:[{name:"查看客户列表"},{name:"编辑客户"},{name:"删除客户"},{name:"查看客户详情"}]},{name:"邮件",children:[{name:"查看邮件列表"},{name:"查看邮件详情"}]},{name:"商机"},{name:"任务"}]},{name:"系统功能",children:[{name:"组织架构"},{name:"角色管理"}]}]}];$.fn.zTree.init($("#roleTree"),u,f);t("param"),$("#twitter").click(function(){s("socialAuth_twitter","t")}),$(document).on("click","#sideMenu li",function(){"none"==$(this).find(".sub-menu").css("display")?($(this).find(".sub-menu").show(),$(this).find(".s-menuUp").css("transform","rotate(180deg)")):($(this).find(".sub-menu").hide(),$(this).siblings().find("ul").hide(),$(this).find(".s-menuUp").css("transform","rotate(0deg)"))}),$("#sideFooter .side-footer-btn").on("click",function(){"none"==$(this).parent().find(".side-footer-pop").css("display")?($(this).parent().find(".side-footer-pop").show(),$(this).parent().find(".side-footer-pop li").eq(0).hide()):$(this).parent().find(".side-footer-pop").hide()}),$("#emailUnbinding").on("click",function(){$.Confirm("确认解除绑定？","",function(){c()})}),o(),$("#facebookBtn").bind("click",function(){var e="https://graph.facebook.com/oauth/authorize?client_id=1695631794021366&display=page&redirect_uri="+Base.sitUrl+"/html/main.html&scope=public_profile,publish_stream,email,user_birthday,user_photos,friends_photos";parent.location.href=e}),$(document).on("click","#fbbinding1",function(){$.Confirm("确认解除绑定？","",function(){d()})}),r()})});